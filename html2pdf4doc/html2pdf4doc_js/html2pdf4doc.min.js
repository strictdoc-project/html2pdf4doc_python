/*! Version: 0.3.0 */
var HTML2PDF4DOC;(()=>{"use strict";var e={d:(t,i)=>{for(var n in i)e.o(i,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{init:()=>Dn});var i={};e.r(i),e.d(i,{log:()=>R,logGroup:()=>D,logGroupEnd:()=>v,strictAssert:()=>x});var n={};e.r(n),e.d(n,{isAfterContentFlowStart:()=>Z,isComplexTextBlock:()=>X,isContentFlowEnd:()=>J,isContentFlowStart:()=>Y,isFlexRow:()=>ge,isForcedPageBreak:()=>ne,isFullySPlitted:()=>de,isGrid:()=>se,isGridAutoFlowRow:()=>ce,isIMG:()=>$,isInline:()=>oe,isInlineBlock:()=>re,isLiNode:()=>j,isNeutral:()=>z,isNoBreak:()=>ee,isNoHanging:()=>te,isOBJECT:()=>W,isPRE:()=>he,isPageStartElement:()=>K,isSTYLE:()=>L,isSVG:()=>G,isSelectorMatching:()=>H,isSignificantTextNode:()=>I,isSlice:()=>ie,isSlough:()=>pe,isSyntheticTextWrapper:()=>Q,isTableLikeNode:()=>le,isTableNode:()=>ae,isWrappedTextGroup:()=>q,isWrappedTextLine:()=>U,isWrappedTextNode:()=>V});var o={};e.r(o),e.d(o,{insertStyle:()=>ue});var r={};e.r(r),e.d(r,{isFirstChildOfFirstChild:()=>fe,isLastChildOfLastChild:()=>me,isLineChanged:()=>be,isLineKept:()=>we,resolveFlowElement:()=>Me,setInitStyle:()=>Se});var s={};e.r(s),e.d(s,{getBottom:()=>Ee,getBottomWithMargin:()=>De,getContentHeightByProbe:()=>Ie,getEmptyNodeHeightByProbe:()=>Fe,getHeightWithMargin:()=>ve,getLineHeight:()=>Be,getMaxWidth:()=>xe,getNormalizedBottomWithMargin:()=>Oe,getNormalizedTop:()=>ye,getTableEmptyRowHeight:()=>Ne,getTableEntries:()=>He,getTableRowHeight:()=>ke,getTableRowShellHeightByTD:()=>Ae,getTop:()=>Te,getTopForPageStartCandidate:()=>Ce,getTopWithMargin:()=>Re});var l={};e.r(l),e.d(l,{create:()=>Le,createComplexTextBlock:()=>qe,createForcedPageBreak:()=>Ze,createNeutral:()=>$e,createNeutralBlock:()=>Ge,createPrintPageBreak:()=>Ue,createSignpost:()=>Je,createSliceWrapper:()=>Qe,createTable:()=>Xe,createTestNodeFrom:()=>Ke,createTextGroup:()=>ze,createTextLine:()=>je,createTextNodeWrapper:()=>We,createWithFlagNoBreak:()=>Ve,createWord:()=>Ye});var a={};e.r(a),e.d(a,{prepareSplittedNode:()=>nt,splitByWordsGreedyWithSpacesFilter:()=>it,splitTextByLinesGreedy:()=>et,splitTextByWordsGreedy:()=>tt});var h={};e.r(h),e.d(h,{markBottomCut:()=>_t,markCleanBottomCut:()=>pt,markCleanTopCut:()=>dt,markPageEndElement:()=>gt,markPageStartElement:()=>ht,markProcessed:()=>rt,markSliceCuts:()=>ft,markSliceCutsInRows:()=>mt,markTopCut:()=>ut,setFlagNoBreak:()=>st,setFlagNoHanging:()=>lt,setFlagSlice:()=>at,unmarkPageStartElement:()=>ct});var c={};e.r(c),e.d(c,{wrapNodeChildrenWithNeutralBlock:()=>bt});var g={};e.r(g),e.d(g,{copyNodeWidth:()=>Ct,estimateInlineImgGapBelow:()=>Tt,fitElementWithinBoundaries:()=>St,fitElementWithinHeight:()=>Mt,lockNodesWidths:()=>Ot,lockTableWidths:()=>yt,scaleCellsToHeight:()=>Pt});var d={};e.r(d),e.d(d,{findAllForcedPageBreakInside:()=>Nt,findBetterForcedPageStarter:()=>Dt,findBetterPageStart:()=>vt,findFirstChildParent:()=>Ft,findFirstChildParentFromPage:()=>Rt,findLastChildParent:()=>Bt,findPreviousNonHangingsFromPage:()=>xt,findSuitableNonHangingPageStart:()=>kt});var p={};e.r(p),e.d(p,{getFirstChildrenChain:()=>jt,getLastChildrenChain:()=>zt,getPreparedChildren:()=>Gt,getSplitChildren:()=>Wt});var u={};e.r(u),e.d(u,{isReplacedElement:()=>Qt,resolveReplacedElement:()=>ei});var _={};e.r(_),e.d(_,{cloneAndCleanOutsideRange:()=>ai,getSplitPoints:()=>ii,getSplitPointsPerCells:()=>ni,isFirstSliceEmpty:()=>li,normalizeContentCuts:()=>ri,sliceNodeBySplitPoints:()=>oi,sliceNodeContentBySplitPoints:()=>si});var f={};e.r(f),e.d(f,{shouldSkipFlowElement:()=>pi});var m={};e.r(m),e.d(m,{buildRowSlices:()=>_i,evaluateRowSplitPlacement:()=>mi,paginationBuildBalancedRowSlices:()=>fi,replaceCurrentRowsAfterRowSplit:()=>bi,sliceCellsBySplitPoints:()=>ui});var b={};e.r(b),e.d(b,{paginationApplyFullPageScaling:()=>Pi,paginationScaleCellsToHeight:()=>Si,paginationShouldScaleFullPage:()=>Mi});var w={};e.r(w),e.d(w,{applyRowSlicesToEntriesAfterRowSplit:()=>Ci,computeRowFlags:()=>yi});var S={};e.r(S),e.d(S,{paginationRefreshRowsAfterSplit:()=>Ti,validateSplitterAdapter:()=>Oi});var M={};e.r(M),e.d(M,{paginationComputeCellShellHeights:()=>Ei});var P={};e.r(P),e.d(P,{handleRowOverflow:()=>Ri,handleRowSplitFailure:()=>xi,scaleRowCellsToHeight:()=>vi});var C={};e.r(C),e.d(C,{absorbShortTrailingSliceIfFits:()=>Bi,calculateFinalPartReclaimedHeight:()=>Fi});var y={};e.r(y),e.d(y,{paginationBuildRowEvaluationContext:()=>Ni,paginationCanAbsorbLastRow:()=>Ai});var O={};e.r(O),e.d(O,{paginationCalculateRowSplitBudget:()=>Gi,paginationHandleRowSlicesPlacement:()=>Ui,paginationProcessRowSplitResult:()=>zi,paginationResolveAlreadySlicedRow:()=>$i,paginationResolveOverflowingRow:()=>Ii,paginationResolveRowWithRowspan:()=>Li,paginationResolveSplittableRow:()=>Vi,paginationSplitRow:()=>Wi});const T={init:"[html2pdf]",root:"html2pdf-root",paperFlow:"html2pdf-paper-flow",contentFlow:"html2pdf-content-flow",overlayFlow:"html2pdf-overlay-flow",pageDivider:"html2pdf-page",pageStartMarker:"[html2pdf-page-start]",pageEndMarker:"[html2pdf-page-end]",contentFlowStart:"html2pdf-content-flow-start",contentFlowEnd:"html2pdf-content-flow-end",style:"[html2pdf-style]",frontpageTemplate:"[html2pdf-frontpage]",headerTemplate:"[html2pdf-header]",footerTemplate:"[html2pdf-footer]",frontpageElement:"html2pdf-frontpage",frontpageContent:"html2pdf-frontpage-content",headerContent:"html2pdf-header",footerContent:"html2pdf-footer",pageNumberRoot:"[html2pdf-page-number]",pageNumberCurrent:"[html2pdf-page-number-current]",pageNumberTotal:"[html2pdf-page-number-total]",pageChrome:"html2pdf-page-chrome",pageBodySpacer:"html2pdf-page-body-spacer",pageHeader:"html2pdf-page-header",pageFooter:"html2pdf-page-footer",printPageBreak:"html2pdf-print-page-break",runningSafety:"html2pdf-print-running",virtualPaper:"html2pdf-virtual-paper",virtualPaperTopMargin:"html2pdf-virtual-paper-margin-top",virtualPaperBottomMargin:"html2pdf-virtual-paper-margin-bottom",virtualPaperGap:"html2pdf-virtual-paper-gap",printIgnore:"[html2pdf-print-ignore]",printHide:"[html2pdf-print-hide]",neutral:"html2pdf-neutral",word:"html2pdf-word",textNode:"html2pdf-text-node",textLine:"html2pdf-text-line",textGroup:"html2pdf-text-group",complexTextBlock:"html2pdf-complex-text-block",printForcedPageBreak:"html2pdf-print-forced-page-break",split:"[html2pdf-split]",processed:"[html2pdf-processed]",flagNoBreak:"[html2pdf-flag-no-break]",flagNoHanging:"[html2pdf-flag-no-hanging]",flagSlice:"[html2pdf-flag-slice]",topCutPart:".html2pdf-top-cut",bottomCutPart:".html2pdf-bottom-cut",cleanTopCut:".html2pdf-clean-top-cut",cleanBottomCut:".html2pdf-clean-bottom-cut",tocPageNumber:"html2pdf-toc-page-number"},E="background:#eee;color:#888;padding: 0 1px 0 0;";function D(e,t="",i=!1){"boolean"==typeof t&&(i=t,t=""),!0===i?this._debug._&&console.groupCollapsed(`%c${e}`,t):this._debug._&&console.group(`%c${e}`,t)}function v(e){this._debug._&&console.log(`%c ‚ñ≤ ${e} `,E),this._debug._&&console.groupEnd()}function R(e,...t){this._debug._&&console.log(`[${e}]`,...t)}function x(e,...t){this._assert&&console.assert(e,"‚õî",...t)}class F{constructor({DOM:e,config:t}){this.document=e,this.body=e.body,this._debug=t.debugMode?{...t.debugConfig.DOM}:{},this._assert=!!t.consoleAssert,Object.assign(this,i)}createElement(e){return this.document.createElement(e)}createDocumentFragment(){return this.document.createDocumentFragment()}cloneNode(e){return e?.cloneNode(!0)}cloneNodeWrapper(e){return e?.cloneNode(!1)}insertBefore(e,...t){const i=t.filter((e=>null!=e));e.before(...i)}insertAfter(e,...t){const i=t.filter((e=>null!=e));e.after(...i)}insertAtEnd(e,...t){const i=t.filter((e=>null!=e));e.append(...i)}insertAtStart(e,...t){const i=t.filter((e=>null!=e));e.prepend(...i)}insertInsteadOf(e,...t){this.insertBefore(e,...t),e.remove()}wrap(e,t){return e.before(t),t.append(e),t}moveContent(e,t){for(;e.firstChild;)t.append(e.firstChild);this.strictAssert(""===this.getInnerHTML(e))}moveRowContent(e,t){if(!e||!t)return void(this._debug._&&console.warn("moveRowContent(): sourceTR or targetTR is missing"));const i=this.getElementTagName(e),n=this.getElementTagName(t);this.strictAssert("TR"===i,`moveRowContent(): source is not TR, got ${i}`),this.strictAssert("TR"===n,`moveRowContent(): target is not TR, got ${n}`);const o=[...this.getChildren(e)],r=[...this.getChildren(t)];o.length!==r.length&&this._debug._&&console.warn(`moveRowContent(): cells count mismatch: ${o.length} (source) vs ${r.length} (target)`);const s=Math.min(o.length,r.length);for(let e=0;e<s;e++)this.moveContent(o[e],r[e])}replaceNodeContentsWith(e,...t){this.setInnerHTML(e,""),this.insertAtEnd(e,...t)}removeNode(e){e.remove()}getAll(e,t=this.document){return this.strictAssert(e),"string"==typeof e&&(e=e.split(",").filter(Boolean)),this.strictAssert(Array.isArray(e),"Selectors must be provided as an array or string (one selector or multiple selectors, separated by commas). Now the selectors are:",e),this.strictAssert(e.length>0,"getAll(selectors), selectors:",e),1===e.length?[...this.getAllElements(e[0],t)]:[...e].flatMap((e=>[...this.getAllElements(e,t)]))}getElement(e,t=this.document){return this.strictAssert(e),t.querySelector(e)}getAllElements(e,t=this.document){return this.strictAssert(e),t.querySelectorAll(e)}getElementById(e,t=this.document){return t.getElementById(e)}getRightNeighbor(e){return e.nextElementSibling}getLeftNeighbor(e){return e.previousElementSibling}getParentNode(e){return e.parentElement}getNodeValue(e){return e.nodeValue}getLastElementChild(e){return e.lastElementChild}getFirstElementChild(e){return e.firstElementChild}getChildNodes(e){return e.childNodes}getChildren(e){return e.children}getElementOffsetParent(e){return e.offsetParent}getComputedStyle(e){return window.getComputedStyle(e)}getElementBCR(e){return e.getBoundingClientRect()}getElementOffsetLeft(e){return e?.offsetLeft}getElementOffsetHeight(e){return e?.offsetHeight}getElementOffsetWidth(e){return e?.offsetWidth}getElementOffsetTop(e){return e?.offsetTop}getElementOffsetBottom(e){return e?.offsetTop+e?.offsetHeight||void 0}getElementTagName(e){return e.tagName}getDataId(e){return e.dataset.id}getAttribute(e,t){if(!e||!t)return void(this._debug._&&console.warn("getAttribute() must have 2 params"));const i=t.charAt(0);if("."!==i&&"#"!==i||this.log("getAttribute",`you're really sure ${t} is attribute selector?`),"["===i){this.strictAssert("]"===t.at(-1),`the ${t} selector is not OK.`);const i=t.substring(1,t.length-1);return e.getAttribute(i)}e.getAttribute(t)}setAttribute(e,t,i){if(!e||!t)return void(this._debug._&&console.warn("setAttribute() must have 2 params"));const n=t.charAt(0);if("."!==n)if("#"!==n)if("["!==n)this.log("setAttribute",`you're really sure ${t} is a selector?`);else{this.strictAssert("]"===t.at(-1),`the ${t} selector is not OK.`);const n=t.substring(1,t.length-1);e.setAttribute(n,i||"")}else{const i=t.substring(1);e.id=i}else{const i=t.substring(1);e.classList.add(i)}}setStyles(e,t){Object.entries(t).forEach((([t,i])=>{Array.isArray(i)?this.setStyle(e,t,i[0],i[1]||""):this.setStyle(e,t,i)}))}setStyle(e,t,i,n=""){const o=this._toKebab(t);null==i||""===i?e.style.removeProperty(o):e.style.setProperty(o,String(i),n)}_toKebab=e=>{if(e.includes("-"))return e;const t=e.match(/^(webkit|moz|ms|o)(?=[A-Z])/);return t&&(e="-"+t[1]+"-"+e.slice(t[1].length)),e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()))};addClasses(e,...t){e.classList.add(...t)}removeAttribute(e,t){if(!e||!t)return void(this._debug._&&console.warn("removeAttribute() must have 2 params"));const i=t.charAt(0);if(this.strictAssert(i.match(/[a-zA-Z#\[\.]/),`removeAttribute() expects a valid selector, but received ${t}`),"."!==i)if("#"!==i)if("["!==i)e.removeAttribute(attr);else{this.strictAssert("]"===t.at(-1),`the ${t} selector is not OK.`);const i=t.substring(1,t.length-1);e.removeAttribute(i)}else{const i=t.substring(1);e.removeAttribute(i)}else{const i=t.substring(1);e.classList.remove(i)}}removeAllAttributes(e){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name)}removeClasses(e,...t){e.classList.remove(...t)}removeAllClasses(e){e.classList=""}removeAllStyles(e){e.style=""}getInnerHTML(e){if("string"==typeof e){const t=this.document.querySelector(e);return t?t.innerHTML:void 0}return e.innerHTML}setInnerHTML(e,t){if("string"==typeof e){const i=this.document.querySelector(e);i&&(i.innerHTML=t)}e.innerHTML=t}isDocumentBody(e){return"BODY"===e.tagName}isTextNode(e){return e.nodeType===Node.TEXT_NODE}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}hasClass(e,t){return e.classList.contains(t)}hasID(e,t){return e.id===t}hasAttribute(e,t){return e.hasAttribute(t)}}class B{constructor(e){this.config=e,this._printWidth=parseFloat(this.config.paperWidth),this._printLeft=parseFloat(this.config.printLeftMargin),this._printRight=parseFloat(this.config.printRightMargin),this._printContentWidth=this._printWidth-this._printLeft-this._printRight+"px",this._flowPreviewPaddingBottom="100px",this._chromeBorderSafeSpace="2px",this._ensureBFC="display: flow-root",this.charWidth="10px"}create(){return this._pageRule()+this._layoutStyles().screen+this._layoutStyles().print+this._chromeStyles().screen+this._chromeStyles().print+this._serviceElementsStyle().screen+this._serviceElementsStyle().print+this._cutEdgeStyle()+(this.config.debugMode?this._testScreenOnlyStyle():"")}_pageRule(){return`@page {\n  size: A4;\n  size: ${`${this.config.paperWidth} ${this.config.paperHeight}`};\n  margin-left: ${this.config.printLeftMargin};\n  margin-right: ${this.config.printRightMargin};\n  margin-top: ${this.config.printTopMargin};\n  margin-bottom: 0;\n}`}_layoutStyles(){return{screen:`\n${T.root} {\n  --paper-color: ${this.config.paperColor};\n  display: flow-root;\n  position: relative;\n  z-index: 1;\n  width: ${this._printContentWidth};\n  margin: 0 auto;\n  font-size: ${this.config.printFontSize};\n  padding-bottom: ${this._flowPreviewPaddingBottom};\n}\n\n${T.contentFlow} {\n  display: block;\n}\n\n${T.paperFlow} {\n  display: block;\n  position: absolute;\n  width: 100%;\n  z-index: -1;\n  padding-bottom: ${this._flowPreviewPaddingBottom};\n  pointer-events: none;\n}\n\n${T.overlayFlow} {\n  display: block;\n  position: absolute;\n  width: 100%;\n  z-index: 2147483647;\n  padding-bottom: ${this._flowPreviewPaddingBottom};\n  pointer-events: none;\n}\n\n${T.virtualPaper} {\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: minmax(min-content, max-content) minmax(min-content, max-content) 1fr minmax(min-content, max-content) minmax(min-content, max-content);\n  place-items: stretch stretch;\n  place-content: stretch stretch;\n  width: ${this._printContentWidth};\n  height: ${this.config.paperHeight};\n  font-size: ${this.config.printFontSize};\n}\n\n${T.virtualPaper}::before {\n  position: absolute;\n  content: '';\n  width: ${this.config.paperWidth};\n  height: ${this.config.paperHeight};\n  left: -${this.config.printLeftMargin};\n  background: var(--paper-color, white);\n  box-shadow: rgba(0, 0, 0, 0.1) 2px 2px 12px 0px;\n  z-index: -1;\n}\n\n${T.pageChrome} {\n  display: block;\n  pointer-events: none;\n}\n\n${T.pageBodySpacer} {\n  display: block;\n  pointer-events: none;\n}\n\n${T.pageFooter},\n${T.pageHeader} {\n  display: block;\n  position: relative;\n  pointer-events: auto;\n}\n\n${T.pageFooter}::before,\n${T.pageHeader}::before {\n  content: '';\n  position: absolute;\n  inset: 0;\n  z-index: -1;\n  background: var(--paper-color, white);\n}\n\n${T.pageFooter}::before {\n  top: ${this._chromeBorderSafeSpace};\n}\n\n${T.pageHeader}::before {\n  bottom: ${this._chromeBorderSafeSpace};\n}\n\n${T.virtualPaperTopMargin} {\n  display: block;\n  height: ${this.config.printTopMargin};\n}\n\n${T.virtualPaperBottomMargin} {\n  display: block;\n  height: ${this.config.printBottomMargin};\n}\n\n${T.virtualPaperGap} {\n  display: block;\n  padding-top: ${this.config.virtualPagesGap};\n}\n\n${T.contentFlowStart},\n${T.contentFlowEnd},\n${T.pageDivider},\n${T.runningSafety} {\n  ${this._ensureBFC};\n}\n    `,print:`\n@media print {\n\n  ${T.root},\n  ${T.overlayFlow},\n  ${T.paperFlow} {\n    padding: 0;\n  }\n\n  ${T.paperFlow},\n  ${T.printHide} {\n    display: none !important;\n  }\n\n  ${T.printIgnore} {\n    display: contents !important;\n  }\n\n  ${T.virtualPaperTopMargin},\n  ${T.virtualPaperBottomMargin},\n  ${T.virtualPaperGap} {\n    display: none !important;\n  }\n\n  ${T.pageChrome},\n  ${T.frontpageElement},\n  ${T.pageBodySpacer} {\n    break-inside: avoid;\n  }\n}\n    `}}_chromeStyles(){return{screen:`\n${T.headerContent},\n${T.footerContent} {\n  display: block;\n  font-size: small;\n}\n\n${T.headerContent} p,\n${T.footerContent} p {\n  margin: 0;\n}\n\n${T.headerContent} {\n  padding-bottom: ${this.config.headerMargin};\n  padding-top: 10px; /* for page numbers */\n}\n\n${T.footerContent} {\n  padding-top: ${this.config.footerMargin};\n  min-height: 32px; /* for page numbers */\n}\n\n${T.tocPageNumber} {\n  min-width: 3ch;\n  display: flex;\n  justify-content: flex-end;\n  align-items: baseline;\n}\n\n${T.pageNumberRoot} {\n  display: flex;\n  column-gap: 2px;\n  position: absolute;\n  right: 0;\n  text-align: right;\n  line-height: 1;\n}\n\n${T.headerContent} ${T.pageNumberRoot} {\n  top: 0;\n}\n\n${T.footerContent} ${T.pageNumberRoot} {\n  bottom: 0;\n}\n    `,print:""}}_cutEdgeStyle(){return`\n${T.topCutPart} {\n  margin-top: 0 !important;\n}\n${T.bottomCutPart} {\n  margin-bottom: 0 !important;\n}\n${T.cleanTopCut} {\n  margin-top: 0 !important;\n  padding-top: 0 !important;\n  border-top: none !important;\n}\n${T.cleanBottomCut} {\n  margin-bottom: 0 !important;\n  padding-bottom: 0 !important;\n  border-bottom: none !important;\n}\n    `}_serviceElementsStyle(){const e="display: inline";return{screen:`\n.null {\n  display: inline;\n  padding: 0;\n  margin: 0;\n  font: 0;\n  color: transparent;\n  line-height: 0;\n  border: none;\n  outline: none;\n  background: none;\n  background-color: transparent;\n}\n\n${T.word},\n${T.textNode},\n${T.textLine},\n${T.textGroup},\n${T.neutral},\n${T.neutral} span {\n  display: inline;\n  padding: 0;\n  margin: 0;\n  font: inherit;\n  color: inherit;\n  line-height: inherit;\n  background: none;\n  background-color: transparent;\n}\n\n${T.textGroup} {\n  display: block;\n}\n\n${T.textLine} {\n  display: inline-block;\n}\n\n${T.textGroup} ${T.textLine} {\n  ${e};\n}\n\n${T.complexTextBlock} {\n  display: block;\n}\n\n${T.complexTextBlock} ${T.complexTextBlock} {\n  ${e};\n}\n\n${T.printPageBreak} {\n  ${this._ensureBFC};\n}\n\n${T.printForcedPageBreak} {\n  display: block;\n  visibility: hidden;\n  height: 0;\n  overflow: hidden;\n}\n    `,print:`\n@media print {\n\n  ${T.printPageBreak} {\n    break-after: page;\n  }\n\n  ${T.textLine} {\n    ${e};\n  }\n}\n    `}}_testScreenOnlyStyle(){return`\n/* DEBUG PREVIEW */\n@media screen {\n\n  ${T.contentFlow} {\n    background:repeating-linear-gradient(\n      -45deg,\n      rgba(222, 222, 222, .1),\n      rgba(222, 222, 222, .1) 10px,\n      rgba(222, 222, 222, .2) 10px,\n      rgba(222, 222, 222, .2) 20px\n    );\n  }\n\n  ${T.overlayFlow} {\n    background:repeating-linear-gradient(\n      45deg,\n      rgba(222, 222, 222, 0),\n      rgba(222, 222, 222, 0) 18px,\n      rgba(0, 166, 255, 0.05) 18px,\n      rgba(0, 166, 255, 0.05) 20px\n    );\n  }\n\n  ${T.virtualPaperGap} {\n    background: #ff000020;\n  }\n\n  ${T.pageFooter},\n  ${T.pageHeader} {\n    background: #fff1ff99;\n  }\n  ${T.pageBodySpacer} {\n    background: #ffee0020;\n  }\n  ${T.runningSafety} {\n    background: #f200ff;\n    outline: 0.1px dashed #f200ff88;\n  }\n  ${T.frontpageElement} {\n    background: #00fcff20;\n  }\n\n  ${T.neutral} {\n    background: #00ffee10;\n  }\n\n  ${T.textNode} {\n    background: #00ff0010;\n  }\n\n  ${T.textGroup},\n  ${T.textLine} {\n    background: #0000ff08;\n  }\n}\n    `}}class k{constructor({config:e,DOM:t,node:n,selector:o}){this.success=!1,this._assert=!!e.consoleAssert,Object.assign(this,i),this.root,this.paperFlow,this.contentFlow,this.overlayFlow,this.frontpageTemplate,this.headerTemplate,this.footerTemplate,this._initialRoot,this._contentRoot,this._config=e,this._debug=e.debugMode?{...e.debugConfig.layout}:{},this._assert=!!e.consoleAssert,this._DOM=t,this._selector=o,this._node=n,this._customInitialRootSelector=e.initialRoot,this._defaultInitialRootSelector=o.init}create(){if(this._getTemplates(),this._insertStyle(),this._DOM.getElement(`style${this._selector.style}`)){if(this._createLayout(),this._DOM.getParentNode(this.root)!==this._initialRoot||this._DOM.getElementOffsetParent(this.paperFlow)!==this.root||this._DOM.getElementOffsetParent(this.contentFlow)!==this.root||this._DOM.getElementOffsetParent(this.overlayFlow)!==this.root)return this.strictAssert(this._DOM.getParentNode(this.root)===this._initialRoot,"Failed to insert the layout root into the DOM."),this.strictAssert(this._DOM.getElementOffsetParent(this.paperFlow)===this.root,"Failed to insert the paperFlow element into the DOM."),void this.strictAssert(this._DOM.getElementOffsetParent(this.contentFlow)===this.root,"Failed to insert the contentFlow element into the DOM.");this.success=!0}else console.error("Failed to add print styles into the DOM.")}_getTemplates(){this.strictAssert(this._selector.frontpageTemplate,"frontpageTemplate selector is missing"),this.strictAssert(this._selector.headerTemplate,"headerTemplate selector is missing"),this.strictAssert(this._selector.footerTemplate,"footerTemplate selector is missing"),this.frontpageTemplate=this._DOM.getInnerHTML(this._selector.frontpageTemplate),this.headerTemplate=this._DOM.getInnerHTML(this._selector.headerTemplate),this.footerTemplate=this._DOM.getInnerHTML(this._selector.footerTemplate)}_insertStyle(){this._node.insertStyle(new B(this._config).create())}_createLayout(){this._getInitialRoot(),this._initialRoot?(this.log("create Layout","initial root:",this._initialRoot),this._createRoot(),this._createPaperFlow(),this._createContentFlow(),this._createOverlayFlow(),this._DOM.moveContent(this._initialRoot,this.contentFlow),this._DOM.insertAtEnd(this._initialRoot,this.root),this._DOM.insertAtEnd(this.root,this.paperFlow,this.overlayFlow,this.contentFlow),this._insertContentFlowStartAndEnd(this.contentFlow),this._ignoreUnprintableEnvironment(this.root)):console.error("Failed to initialize the root element.")}_insertContentFlowStartAndEnd(e){const t=this._node.create(this._selector.contentFlowStart),i=this._node.create(this._selector.contentFlowEnd);return this._DOM.insertAtStart(e,t),this._DOM.insertAtEnd(e,i),{contentFlowStart:t,contentFlowEnd:i}}_getInitialRoot(){let e=this._customInitialRootSelector?this._DOM.getElement(this._customInitialRootSelector):this._DOM.getElement(this._defaultInitialRootSelector);if(!e){if(!this._DOM.body)return void console.error("We expected to find the BODY tag.");e=this._DOM.body,console.warn(`The printable area is currently unspecified and encompasses the entire contents of the BODY tag. To restrict the printed content to a specific area, include ${this._defaultInitialRootSelector} in the root element of the desired printing area.`)}return this._initialRoot=e,e}_createRoot(){const e=this._node.create(this._selector.root);return this._DOM.setStyles(e,{visibility:"hidden"}),this.root=e,e}_createPaperFlow(){const e=this._node.create(this._selector.paperFlow);return this.paperFlow=e,e}_createOverlayFlow(){const e=this._node.create(this._selector.overlayFlow);return this.overlayFlow=e,e}_createContentFlow(){const e=this._node.create(this._selector.contentFlow);return this.contentFlow=e,e}_ignoreUnprintableEnvironment(e){if(e===this._DOM.body)return void this.strictAssert(!1,"misshapen root");let t=this._DOM.getParentNode(e);this._DOM.setAttribute(t,this._selector.printIgnore),this._DOM.getChildNodes(t).forEach((t=>{if(t!==e&&this._DOM.isElementNode(t))this._DOM.setAttribute(t,this._selector.printHide);else{if(!this._node.isSignificantTextNode(t))return;{const e=this._node.createTextNodeWrapper();this._DOM.wrap(t,e),this._DOM.setAttribute(e,this._selector.printHide)}}})),this._DOM.isDocumentBody(t)||this._ignoreUnprintableEnvironment(t)}}function N(e){return function(t){return t._config.debugMode&&t._debug[e]}}const A=N("selectors");function H(e,t){if(!e||!t)return void(A(this)&&console.warn("isSelectorMatching() must have 2 params","\n element: ",e,"\n selector: ",t));const i=t.charAt(0);if("."===i){const i=t.substring(1);return this._DOM.hasClass(e,i)}if("#"===i){const i=t.substring(1);return this._DOM.hasID(e,i)}if("["===i){this.strictAssert("]"===t.at(-1),`the ${t} selector is not OK.`);const i=t.substring(1,t.length-1);return this._DOM.hasAttribute(e,i)}return this._DOM.getElementTagName(e)===t.toUpperCase()}function I(e){return!!this._DOM.isTextNode(e)&&this._DOM.getNodeValue(e).trim().length>0}function L(e){return"STYLE"===this._DOM.getElementTagName(e)}function $(e){return"IMG"===this._DOM.getElementTagName(e)}function G(e){return"svg"===this._DOM.getElementTagName(e)}function W(e){return"OBJECT"===this._DOM.getElementTagName(e)}function j(e){return"LI"===this._DOM.getElementTagName(e)}function z(e){return this.isSelectorMatching(e,this._selector.neutral)}function V(e){return this.isSelectorMatching(e,this._selector.textNode)}function U(e){return this.isSelectorMatching(e,this._selector.textLine)}function q(e){return this.isSelectorMatching(e,this._selector.textGroup)}function K(e){return this.isSelectorMatching(e,this._selector.pageStartMarker)}function Y(e){return this.isSelectorMatching(e,this._selector.contentFlowStart)}function Z(e){const t=this._DOM.getLeftNeighbor(e);return this.isSelectorMatching(t,this._selector.contentFlowStart)}function J(e){return this.isSelectorMatching(e,this._selector.contentFlowEnd)}function X(e){return this.isSelectorMatching(e,this._selector.complexTextBlock)}function Q(e){return this.isComplexTextBlock(e)||this.isWrappedTextNode(e)||this.isWrappedTextLine(e)||this.isWrappedTextGroup(e)}function ee(e,t){return this.isSelectorMatching(e,this._selector.flagNoBreak)||this.isWrappedTextLine(e)||this.isWrappedTextGroup(e)||this.isInlineBlock(e,t)||this.notSolved(e)}function te(e){return this.isSelectorMatching(e,this._selector.flagNoHanging)}function ie(e){return this.isSelectorMatching(e,this._selector.flagSlice)}function ne(e){return this.isSelectorMatching(e,this._selector.printForcedPageBreak)}function oe(e,t){if(!(e instanceof HTMLElement))return;const i=(t||this._DOM.getComputedStyle(e)).display;return"inline"===i||"inline-block"===i||"inline-table"===i||"inline-flex"===i||"inline-grid"===i}function re(e,t){if(!(e instanceof HTMLElement))return;const i=(t||this._DOM.getComputedStyle(e)).display;return"inline-block"===i||"inline-table"===i||"inline-flex"===i||"inline-grid"===i}function se(e,t){if(!(e instanceof HTMLElement))return;return"grid"===(t||this._DOM.getComputedStyle(e)).display}function le(e,t){if(!(e instanceof HTMLElement))return;const i=t||this._DOM.getComputedStyle(e);return"TABLE"!==this._DOM.getElementTagName(e)&&["table"].includes(i.display)}function ae(e,t){if(!(e instanceof HTMLElement))return;const i=t||this._DOM.getComputedStyle(e);return"TABLE"===this._DOM.getElementTagName(e)||["table"].includes(i.display)}function he(e,t){if(!(e instanceof HTMLElement))return;const i=t||this._DOM.getComputedStyle(e);return["block"].includes(i.display)&&["pre","pre-wrap","pre-line","break-spaces","nowrap"].includes(i.whiteSpace)}function ce(e,t){if(!(e instanceof HTMLElement))return;const i=t||this._DOM.getComputedStyle(e),n=i.display,o=i.gridAutoFlow;return("grid"===n||"inline-grid"===n)&&"row"===o}function ge(e,t){if(!(e instanceof HTMLElement))return;const i=t||this._DOM.getComputedStyle(e),n=i.display;if("flex"!==n&&"inline-flex"!==n)return!1;return(i.flexDirection||"").startsWith("row")}function de(e,t){const i=t||this._DOM.getComputedStyle(e);return this.isPRE(e,i)||this.isTableNode(e,i)||this.isTableLikeNode(e,i)||this.isGridAutoFlowRow(e,i)}function pe(e){return this._DOM.hasAttribute(e,"slough-node")}function ue(e,t=""){const i=this._DOM.getElement("head"),n=this._DOM.body;if(!i&&!n)return void console.error("Check the structure of your document. We didn`t find HEAD and BODY tags. HTML2PDF4DOC expects valid HTML.");const o=this.create("style",e);o?(this._DOM.setAttribute(o,this._selector.style,t),i?this._DOM.insertAtEnd(i,o):n?this._DOM.insertBefore(n,o):this.strictAssert(!1,"We expected to find the HEAD and BODY tags.")):console.error("Failed to create print styles")}const _e=N("positioning");function fe(e,t){if(!e||!this._DOM.getParentNode(e))return!1;let i=e;for(;this._DOM.getParentNode(i)&&i!==t;){if(this._DOM.getFirstElementChild(this._DOM.getParentNode(i))!==i)return!1;i=this._DOM.getParentNode(i)}return i===t}function me(e,t){if(!e||!this._DOM.getParentNode(e))return!1;let i=e;for(;this._DOM.getParentNode(i)&&i!==t;){if(this._DOM.getParentNode(i)===t){let e=this._DOM.getRightNeighbor(i);for(;!this._DOM.getElementOffsetHeight(e)&&!this._DOM.getElementOffsetWidth(e);)if(e=this._DOM.getRightNeighbor(e),this.isContentFlowEnd(e))return!0;return this.isContentFlowEnd(e)}if(this._DOM.getLastElementChild(this._DOM.getParentNode(i))!==i)return!1;i=this._DOM.getParentNode(i)}return i===t}function be(e,t){return this._DOM.getElementOffsetTop(t)-this._DOM.getElementOffsetBottom(e)>-2}function we(e,t){const i=this._DOM.getElementOffsetBottom(e),n=this._DOM.getElementOffsetTop(t),o=i-n,r=o>=2;return _e(this)&&console.group("isLineKept?"),_e(this)&&console.log("\n",r,"\n","\n currentBottom",i,[e],"\n nextTop",n,[t],"\n delta",o),_e(this)&&console.groupEnd("isLineKept?"),r}function Se(e,t,i){const n="[init-position]",o="[init-vertical-align]",r="relative",s=i||this._DOM.getComputedStyle(t),l=s.position,a=s.verticalAlign;if(e)l!=r&&(this._DOM.setStyles(t,{position:r}),this._DOM.setAttribute(t,n,l)),"top"!=a&&(this._DOM.setStyles(t,{"vertical-align":"top"}),this._DOM.setAttribute(t,o,a));else{const e=this._DOM.getAttribute(t,n),i=this._DOM.getAttribute(t,o);e&&(this._DOM.setStyles(t,{position:e}),this._DOM.removeAttribute(t,n)),i&&(this._DOM.setStyles(t,{"vertical-align":i}),this._DOM.removeAttribute(t,o))}}function Me(e,{prefer:t="self"}={}){if(!e)return null;const i=e=>"last"===t?this._DOM.getLastElementChild(e):"first"===t||"self"===t?this._DOM.getFirstElementChild(e):null,n=new Set;let o=e;for(;o&&!n.has(o);){n.add(o);if(this._DOM.getElementOffsetParent(o))return o;const e=this._DOM.getComputedStyle(o);if(!e)return null;const t=e.display,r=e.visibility,s=e.position;if("none"===t||"collapse"===r||"fixed"===s)return null;if("contents"!==t)return null;{const e=i.call(this,o);if(!e)return null;o=e}}return null}const Pe=N("getters");function Ce(e,t){return this.getTop(e,t)}function ye(e,t,i){const n=i||this._DOM.getComputedStyle(t),o=parseFloat(n.paddingTop)||0;return this.getTop(e,t)-o}function Oe(e,t,i){const n=i||this._DOM.getComputedStyle(t),o=parseFloat(n.paddingTop)||0;return this.getBottomWithMargin(e,t)-o}function Te(e,t=null,i=0){if(!e)return void(Pe(this)&&console.warn("element must be provided, but was received:",e,"\nThe function returned:",void 0));if(null===t)return this._DOM.getElementOffsetTop(e);if(!t)return void(Pe(this)&&console.warn("root must be provided, but was received:",t,"\nThe function returned:",void 0));const n=this._DOM.getElementOffsetParent(e);if(!n)return void(Pe(this)&&console.warn("Element has no offset parent.","\n element:",[e],"\n offsetParent:",n,"\n The function returned:",void 0));const o=this._DOM.getElementOffsetTop(e);return n===t?o+i:this.getTop(n,t,i+o)}function Ee(e,t=null){if(e){if(null===t)return this._DOM.getElementOffsetBottom(e);if(t)return this.getTop(e,t)+this._DOM.getElementOffsetHeight(e);Pe(this)&&console.warn("root must be provided, but was received:",t,"\nThe function returned:",void 0)}else Pe(this)&&console.warn("element must be provided, but was received:",e,"\nThe function returned:",void 0)}function De(e,t){if(!e)return;const i=this.getBottom(e,t);let n;const o=this.createNeutralBlock();this._DOM.insertAfter(e,o);const r=this.getTop(o,t);this._DOM.removeNode(o);if(r>=i)n=r;else{n=i+parseInt(this._DOM.getComputedStyle(e).marginBottom)}return n}function ve(e){const t=parseInt(this._DOM.getComputedStyle(e).marginTop),i=parseInt(this._DOM.getComputedStyle(e).marginBottom);return this._DOM.getElementOffsetHeight(e)+t+i}function Re(e,t){const i=parseInt(this._DOM.getComputedStyle(e).marginTop);return this.getTop(e,t)-i}function xe(e){const t=this.create();this._DOM.insertAtEnd(e,t);const i=this._DOM.getElementOffsetWidth(t);return this._DOM.removeNode(t),i}function Fe(e,t="",i=!0){const n=this.create();i&&this._DOM.setStyles(n,{overflow:"auto"});const o=this._DOM.cloneNodeWrapper(e);this._DOM.setInnerHTML(o,t),this._DOM.insertAtEnd(n,o),this._DOM.insertBefore(e,n);const r=this._DOM.getElementOffsetHeight(n);return this._DOM.removeNode(n),r}function Be(e){const t=this.createNeutral();this._DOM.setInnerHTML(t,"!"),this._DOM.setStyles(t,{display:"block"}),this._DOM.insertAtEnd(e,t);const i=this._DOM.getElementOffsetHeight(t);return this._DOM.removeNode(t),i}function ke(e,t=0){const i=this._DOM.getElementOffsetTop(e),n=this._DOM.cloneNode(e),o="!<br />".repeat(t);[...n.children].forEach((e=>this._DOM.setInnerHTML(e,o))),this._DOM.insertBefore(e,n);const r=this._DOM.getElementOffsetTop(e);return this._DOM.removeNode(n),r-i}function Ne(e){const t=this._DOM.getElementOffsetTop(e),i=this._DOM.cloneNodeWrapper(e);this._DOM.insertBefore(e,i);const n=this._DOM.getElementOffsetTop(e);return this._DOM.removeNode(i),n-t}function Ae(e){const t=this._DOM.getElementOffsetTop(e),i=this._DOM.cloneNodeWrapper(e),n=e.children.length,o=[...e.children];this._DOM.insertBefore(e,i);const r=[];for(let s=0;s<n;s++){const l=[];for(let e=0;e<n;e++){let t;e===s?(t=this._DOM.cloneNodeWrapper(o[e]),this._DOM.setInnerHTML(t,"")):(t=document.createElement("td"),this._DOM.setInnerHTML(t,""),this._DOM.setStyles(t,{padding:"0",border:"none",verticalAlign:"top",lineHeight:"0",minHeight:"0",fontSize:"0"})),l.push(t)}this._DOM.insertAtEnd(i,...l);const a=this._DOM.getElementOffsetTop(e)-t;r.push(a),l.forEach((e=>this._DOM.removeNode(e)))}return this._DOM.removeNode(i),r}function He(e){if(!(e instanceof HTMLElement)||"TABLE"!==e.tagName)throw new Error("Expected a <table> element.");const t=[...e.children].reduce(((e,t)=>{const i=t.tagName;return"TBODY"===i?{...e,rows:[...e.rows,...t.children]}:"CAPTION"===i?(this.setFlagNoBreak(t),{...e,caption:t}):"COLGROUP"===i?(this.setFlagNoBreak(t),{...e,colgroup:t}):"THEAD"===i?(this.setFlagNoBreak(t),{...e,thead:t}):"TFOOT"===i?(this.setFlagNoBreak(t),{...e,tfoot:t}):"TR"===i?{...e,rows:[...e.rows,...t]}:(Pe(this)&&t&&console.warn("unexpected:",t),{...e,unexpected:[...e.unexpected,...t]})}),{caption:null,thead:null,tfoot:null,rows:[],unexpected:[]});return t.unexpected.length>0&&Pe(this)&&console.warn(`something unexpected is found in the table ${e}`),t}function Ie(e,t){const i=t||this._DOM.getComputedStyle(e),n=this.createNeutralBlock();this._DOM.setStyles(n,{display:"block",padding:"0",margin:"0",border:"0",height:"0",clear:"both",visibility:"hidden",contain:"layout"}),this._DOM.insertAtEnd(e,n);const o=this.getNormalizedTop(n,e,i);return this._DOM.removeNode(n),o}N("creators");function Le(e,t){let i;if(e){const t=e.charAt(0);if(t.match(/[#\[\.]/))i=this._DOM.createElement("div"),this._DOM.setAttribute(i,e);else{if(!t.match(/[a-zA-Z]/))return void this.strictAssert(!1,"Expected valid html selector ot tag name, but received:",e);i=this._DOM.createElement(e)}}else i=this._DOM.createElement("div");return t&&this._DOM.setInnerHTML(i,t),i}function $e(){return this.create(this._selector.neutral)}function Ge(){const e=this.createNeutral();return e.style.display="block",e.style.clear="both",e}function We(){return this.create(this._selector.textNode)}function je(){return this.create(this._selector.textLine)}function ze(){return this.create(this._selector.textGroup)}function Ve(e){const t=this.create(this._selector.flagNoBreak);return e&&this._DOM.setStyles(t,e),t}function Ue(){return this.create(this._selector.printPageBreak)}function qe(){return this.create(this._selector.complexTextBlock)}function Ke(e){const t=this._DOM.cloneNodeWrapper(e);return this._DOM.setAttribute(t,".test-node"),this._DOM.setStyles(t,{position:"absolute",background:"rgb(255 239 177)",width:this.getMaxWidth(e)+"px"}),t}function Ye(e,t){const i=this.create(this._selector.word);return this._DOM.setInnerHTML(i,e),i.dataset.index=t,i}function Ze(){return this.create(this._selector.printForcedPageBreak)}function Je(e,t){if(!t)return null;const i=this.create();return this._DOM.setStyles(i,{display:"flex",flexWrap:"nowrap",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:"8px",fontFamily:"sans-serif",letterSpacing:"1px",textTransform:"uppercase",height:t+"px"}),e&&this._DOM.setInnerHTML(i,e),this.setFlagNoBreak(i),i}function Xe({wrapper:e,caption:t,colgroup:i,thead:n,tfoot:o,tbody:r}){const s=e||this.create("table"),l=this.create("TBODY");return t&&this._DOM.insertAtEnd(s,t),i&&this._DOM.insertAtEnd(s,i),n&&this._DOM.insertAtEnd(s,n),r&&this._DOM.insertAtEnd(l,...r),this._DOM.insertAtEnd(s,l),o&&this._DOM.insertAtEnd(s,o),s}function Qe(e){const t=this._DOM.cloneNodeWrapper(e);return this.unmarkPageStartElement(t),this.setFlagNoBreak(t),t}N("splitters");function et(e){return e.split(/(?<=\n)/)}function tt(e){return(this._DOM.getNodeValue(e)||this._DOM.getInnerHTML(e)).split(/(?<=\s|-)/)}function it(e){return(this._DOM.getNodeValue(e)||this._DOM.getInnerHTML(e)).trim().split(/(?<=\s|-)/).filter((e=>" "!=e))}function nt(e){const t=e,i=this.splitTextByWordsGreedy(e),n=i.map((e=>{const t=this._DOM.createElement("span");return this._DOM.setInnerHTML(t,e+" "),t})),o=this.createTestNodeFrom(e);return this._DOM.insertAtEnd(o,...n),this._DOM.insertAtEnd(e,o),{splittedNode:t,nodeWords:i,nodeWordItems:n}}const ot=N("markers");function rt(e,t){this._markupDebugMode&&this._DOM.setAttribute(e,this._selector.processed,"üè∑Ô∏è "+t)}function st(e){this._DOM.setAttribute(e,this._selector.flagNoBreak)}function lt(e,t){this._DOM.setAttribute(e,this._selector.flagNoHanging,t)}function at(e){this._DOM.setAttribute(e,this._selector.flagSlice)}function ht(e,t){this._DOM.setAttribute(e,this._selector.pageStartMarker,t)}function ct(e){this._DOM.removeAttribute(e,this._selector.pageStartMarker)}function gt(e,t){this._DOM.setAttribute(e,this._selector.pageEndMarker,t)}function dt(e){ot(this)&&console.log("[mark ‚ä§ cut]",e),e&&this._DOM.setAttribute(e,this._selector.cleanTopCut)}function pt(e){ot(this)&&console.log("[mark ‚ä• cut]",e),e&&this._DOM.setAttribute(e,this._selector.cleanBottomCut)}function ut(e){ot(this)&&console.log("[mark ‚ä§ cut]",e),e&&this._DOM.setAttribute(e,this._selector.topCutPart)}function _t(e){ot(this)&&console.log("[mark ‚ä• cut]",e),e&&this._DOM.setAttribute(e,this._selector.bottomCutPart)}function ft(e){if(e&&e.length)if(1!==e.length)for(let t=0;t<e.length;t++){const i=t>0,n=t<e.length-1,o=e[t];ot(this)&&console.log("[markSliceCuts] slice",t,o),i&&(ot(this)&&console.log("[markSliceCuts] slice üñçÔ∏è ‚ä•",o),this.markTopCut(o)),n&&(ot(this)&&console.log("[markSliceCuts] slice üñçÔ∏è ‚ä§",o),this.markBottomCut(o))}else ot(this)&&console.log("%c[markSliceCuts] There is no cuts in one slice. Doing nothing.","color:blue");else ot(this)&&console.log("%c[markSliceCuts] Slices were not passed. Doing nothing.","color:red")}function mt(e){if(ot(this)&&console.log("[markSliceCutsInRows] rows",e),e&&e.length)for(let t=0;t<e.length;t++){const i=e[t],n=t>0,o=t<e.length-1;let r,s;if(ot(this)&&console.log("[markSliceCutsInRows] row",t,i),i instanceof HTMLElement?(ot(this)&&console.log("%c[markSliceCutsInRows] It is a <TR>","color:blue",i),r=i,s=[...this._DOM.getChildren(i)]):Array.isArray(i)?(ot(this)&&console.log("%c[markSliceCutsInRows] It is an Array","color:blue",i),r=void 0,s=i):this.strictAssert(0,"we expected TR or an array of elements!"),!r&&!s.length){ot(this)&&console.log("%c[markSliceCutsInRows] There was no split","color:red",{rowWrapper:r,cellWrappers:s});break}n&&(r&&(ot(this)&&console.log("[markSliceCutsInRows] rowWrapper ‚ä•",r),this.markTopCut(r)),s.forEach((e=>{ot(this)&&console.log("[markSliceCutsInRows] cell üñçÔ∏è ‚ä•",e),this.markTopCut(e)}))),o&&(r&&(ot(this)&&console.log("[markSliceCutsInRows] rowWrapper ‚ä§",r),this.markBottomCut(r)),s.forEach((e=>{ot(this)&&console.log("[markSliceCutsInRows] cell üñçÔ∏è ‚ä§",e),this.markBottomCut(e)})))}else ot(this)&&console.log("%c[markSliceCutsInRows] The rows were not passed. Doing nothing.","color:red")}N("wrappers");function bt(e){const t=this._DOM.getChildren(e),i=this.createNeutralBlock();return this._DOM.insertAtStart(i,...t),this._DOM.insertAtStart(e,i),i}const wt=N("fitters");function St({element:e,height:t,width:i,vspace:n,hspace:o}){const r=n/t,s=o/i,l=r<s?r:s,a=Math.trunc(t*l),h=Math.trunc(i*l);this._DOM.setStyles(e,{height:a+"px",width:h+"px"}),this._DOM.setAttribute(e,"height",`${a}px`),this._DOM.setAttribute(e,"width",`${h}px`)}function Mt(e,t){const i=this._DOM.getElementOffsetHeight(e);if(i<=t)return;const n=t/i;e.style.transformOrigin="top left",e.style.transform=`scale(${n})`;const o=this.createNeutral();o.style.display="inline-block",o.style.verticalAlign="top",o.style.width="100%",o.style.height=t+"px",this._DOM.wrap(e,o),wt(this)&&console.warn(`%c Scaled element to fit target height: ${t}px`,"color:orange; font-weight:bold;",`scale: ${n}`,e)}function Pt(e,t,i){const n=Array.isArray(i)?i:new Array(e.length).fill(0);let o=!1;for(let r=0;r<e.length;r++){const s=e[r],l=n[r]||0,a=Math.max(0,t-l);if(a<=0)continue;const h=1===this._DOM.getChildren(s).length,c=this._DOM.getFirstElementChild(s);let g,d=null;if(h&&c&&this.isNeutral(c))d=c,g=this._DOM.getElementOffsetHeight(d)||0;else if(i){const e=this._DOM.getElementOffsetHeight(s)||0;g=Math.max(0,e-l)}else g=this.getContentHeightByProbe(s);g>a&&(d||(d=this.wrapNodeChildrenWithNeutralBlock(s),g=this._DOM.getElementOffsetHeight(d)||g),this.fitElementWithinHeight(d,a),o=!0,wt(this)&&console.warn("üí¢ scaleCellsToHeight: resized cell content",{cell:s,target:a}))}return o}function Ct(e,t){this._DOM.setStyles(e,{"box-sizing":"border-box",width:`${this._DOM.getElementOffsetWidth(t)}px`,"min-width":`${this._DOM.getElementOffsetWidth(t)}px`})}function yt(e){this.copyNodeWidth(e,e),this._DOM.getAll("td",e).forEach((e=>this.copyNodeWidth(e,e)))}function Ot(e){Array.isArray(e)&&e.forEach((e=>{e&&this.copyNodeWidth(e,e)}))}function Tt(e,t={}){const{descentRatio:i=.22,normalLH:n=1.2,safety:o=1}=t,r=getComputedStyle(e),s=parseFloat(r.fontSize)||0;let l;if("normal"!==r.lineHeight&&r.lineHeight){const e=parseFloat(r.lineHeight);l=Number.isFinite(e)?e:n*s}else l=n*s;const a=(Math.max(0,(l-s)/2)+i*s)*o;return Math.ceil(a)}const Et=N("pageBreaks");function Dt(e,t){let i=e;for(;;){const e=this.findFirstChildParent(i,t);if(e&&e!==i){i=e;continue}const n=Lt.call(this,i,"findBetterForcedPageStarter:left");if(!n||!this.isNoHanging(n))break;i=n}return i}function vt(e,t,i){Et(this)&&console.group("‚ûó findBetterPageStart");let n=!1,o=!1,r=!1;const s=this.getTop(t,i);Et(this)&&console.log("Start calculations:",{pageStart:e,lastPageStart:t,root:i,topLimit:s});const l=this.findFirstChildParentFromPage(e,s,i);let a;if(l)a=l;else{a=this.getTop(e,i)<s?t:e}Et(this)&&console.log("betterCandidate:",a);let h=a;for(;;){const e=this.findPreviousNonHangingsFromPage(h,s,i);if(void 0===e){Et(this)&&console.warn("ü´• previousCandidate",e),n=!0;break}if(Et(this)&&console.log("‚Ä¢ previousCandidate",{previousCandidate:e}),e){h=e;continue}Et(this)&&console.log("‚Ä¢ update currentCandidate",{previousCandidate:e});const t=this.findFirstChildParentFromPage(h,s,i);if(void 0===t){Et(this)&&console.warn("ü´• firstChildParent",t),n=!0;break}if(Et(this)&&console.log("‚Ä¢ firstChildParent",{firstChildParent:t}),!t){Et(this)&&console.log("‚Ä¢ update currentCandidate",{firstChildParent:t});break}h=t}(h==t||this.getTop(h,i)<s)&&(o=!0,Et(this)&&console.log("‚òùÔ∏è Top page limit has been reached",h));const c=Lt.call(this,h,"findBetterPageStart:leftCheck");c==t&&(r=!0,Et(this)&&console.log("üëà Left limit has been reached (left neighbor is the last page start)",c,a));let g=h;if(n||o?g=a:!r||h!==a&&h!==t||(g=a),this.getTop(g,i)<s&&(g=t),this.isAfterContentFlowStart(g)&&(g=e),this.shouldSkipFlowElement(g,{context:"findBetterPageStart:result"})){let e=t;if(a!==g){const t=this.shouldSkipFlowElement(a,{context:"findBetterPageStart:fallback"})?null:a;t&&(e=t)}g=e}if(!this._DOM.getElementOffsetParent(g)){const e=this.resolveFlowElement(g,{prefer:"first"});e&&(g=e)}return Et(this)&&console.log({interruptedWithUndefined:n,interruptedWithLimit:o,pageStart:e,betterCandidate:a,currentCandidate:h,reachedLeftLimit:r,result:g}),Et(this)&&console.log("‚ûó end, return:",g),Et(this)&&console.groupEnd(),g}function Rt(e,t,i){Et(this)&&console.group("‚¨Ü findFirstChildParentFromPage"),Et(this)&&console.log({element:e,topLimit:t,root:i});let n=null,o=e,r=!1;for(;;){const e=At.call(this,o,"findFirstChildParentFromPage:parent");if(!e||e===i)break;const s=Ht.call(this,e,"findFirstChildParentFromPage:firstChild");if(!s){o=e;continue}if(s!==o){Et(this)&&console.log("parent is NOT the First Child",{parent:e});break}const l=this.resolveFlowElement(e,{prefer:"first"});if(!l){o=e;continue}if(l===o){o=e;continue}const a=this.isPageStartElement(e)||this.isPageStartElement(l),h=this.getTop(l,i);if(a||h<t){Et(this)&&console.warn("ü´• findFirstChildParentFromPage // interruptedByPageStart"),r=!0;break}Et(this)&&console.log({parent:e}),n=l,o=e}return Et(this)&&console.groupEnd("‚¨Ü findFirstChildParentFromPage"),r?void 0:n}function xt(e,t,i){Et(this)&&console.group("‚¨Ö findPreviousNonHangingsFromPage");let n=null,o=e,r=!1;for(;;){const e=Lt.call(this,o,"findPreviousNonHangingsFromPage:left");if(Et(this)&&console.log({interruptedByPageStart:r,topLimit:t,prev:e,current:o}),!e||e===o)break;if(!this.isNoHanging(e))break;const s=e;let l=this.resolveFlowElement(e,{prefer:"last"});if(!l){o=s;continue}for(;l&&this.shouldSkipFlowElement(l,{context:"findPreviousNonHangingsFromPage:flow"});)l=this.resolveFlowElement(this._DOM.getLeftNeighbor(l),{prefer:"last"});if(!l){o=s;continue}const a=this.isPageStartElement(s)||this.isPageStartElement(l),h=this.getTop(l,i);if(a||h<t){r=!0;break}n=s,o=s}const s=r?void 0:n;return Et(this)&&console.log("%cres","color:orange;background:cyan;font-weight:bold",s),Et(this)&&console.groupEnd("‚¨Ö findPreviousNonHangingsFromPage"),s}function Ft(e,t){let i=At.call(this,e,"findFirstChildParent:parent"),n=null;for(;i&&i!==t;){const t=Ht.call(this,i,"findFirstChildParent:firstChild");if(t){if(e!==t)return n;n=i,e=i,i=At.call(this,e,"findFirstChildParent:parent")}else i=At.call(this,i,"findFirstChildParent:parent")}return n}function Bt(e,t){let i=At.call(this,e,"findLastChildParent:parent"),n=null;for(;i&&i!==t;){const t=It.call(this,i,"findLastChildParent:lastChild");if(t){if(e!==t)return n;n=i,e=i,i=At.call(this,e,"findLastChildParent:parent")}else i=At.call(this,i,"findLastChildParent:parent")}return n}function kt(e,t){let i=e,n=null;for(;;){let e=this._DOM.getLastElementChild(i);for(;e&&this.shouldSkipFlowElement(e,{context:"findSuitableNonHangingPageStart:descend"});)e=this._DOM.getLeftNeighbor(e);if(!e)break;if(this.isNoHanging(e)){n=e;break}i=e}if(n)for(i=n;i&&i!==e;){let t=this._DOM.getParentNode(i);for(;t&&this.shouldSkipFlowElement(t,{context:"findSuitableNonHangingPageStart:ascend"});)t=this._DOM.getParentNode(t);if(!t||t===e)break;let o=this._DOM.getFirstElementChild(t);for(;o&&this.shouldSkipFlowElement(o,{context:"findSuitableNonHangingPageStart:ascendFirst"});)o=this._DOM.getRightNeighbor(o);if(!o||o!==i)break;n=t,i=t}else n=e;return this.getTop(n)>t?n:null}function Nt(e){return this._DOM.getAll(this._selector.printForcedPageBreak,e)}function At(e,t){let i=this._DOM.getParentNode(e);for(;i&&this.shouldSkipFlowElement(i,{context:t});)i=this._DOM.getParentNode(i);return i}function Ht(e,t){let i=this._DOM.getFirstElementChild(e);for(;i&&this.shouldSkipFlowElement(i,{context:t});)i=this._DOM.getRightNeighbor(i);return i}function It(e,t){let i=this._DOM.getLastElementChild(e);for(;i&&this.shouldSkipFlowElement(i,{context:t});)i=this._DOM.getLeftNeighbor(i);return i}function Lt(e,t){let i=this._DOM.getLeftNeighbor(e);for(;i&&this.shouldSkipFlowElement(i,{context:t});)i=this._DOM.getLeftNeighbor(i);return i}const $t=N("children");function Gt(e){$t(this)&&console.group("üö∏ getPreparedChildren of",e);let t=[];if(this.isComplexTextBlock(e))t=[...this._DOM.getChildren(e)],$t(this)&&console.info("üö∏ getPreparedChildren: return children for complexTextBlock",t);else{if(!Yt.call(this,e))return $t(this)&&console.info("ü™≤ getPreparedChildren: empty node, skip & return []",e),[];{$t(this)&&console.groupCollapsed("‚öóÔ∏èüö∏ distill children"),t=[...this._DOM.getChildNodes(e)].reduce(((e,t)=>{if(this.isSTYLE(t))return $t(this)&&console.info("üö∏ (getPreparedChildren) ignore STYLE",[t]),e;if(this.isSignificantTextNode(t)){const i=this.createTextNodeWrapper();return this._DOM.wrap(t,i),e.push(i),$t(this)&&console.info("üö∏ (getPreparedChildren) wrap and return TEXT NODE",[t]),e}if(this._DOM.isElementNode(t)){if(this.shouldSkipFlowElement(t,{context:"getPreparedChildren"}))return e;if(!this._DOM.getElementOffsetParent(t)){const i=this.getPreparedChildren(t);return i.length>0&&e.push(...i),$t(this)&&console.info("%cüö∏ (getPreparedChildren) * no offset parent ‚Äî unwrapped","color:green",i,[t]),e}return e.push(t),$t(this)&&console.info("üö∏ (getPreparedChildren) * normal node",[t]),e}return $t(this)&&console.info("%cüö∏ (getPreparedChildren) IGNORE whitespace / comment ...","color:red",[t]),e}),[]),$t(this)&&console.groupEnd("‚öóÔ∏èüö∏ distill children"),$t(this)&&console.info("üö∏ distilled children",t);const i=Kt.call(this,t),n=this.isInline(e);i&&($t(this)&&console.info("üö∏ isVerticalFlowDisrupted in children of element",[e]),n?($t(this)&&console.info("üéíüö∏ parent element is inline wrapper",[e]),t=[Ut.call(this,e)]):t=Vt.call(this,t))}}return $t(this)&&console.groupEnd("üö∏ getPreparedChildren of"),$t(this)&&console.info("üö∏ getPreparedChildren:",t),t}function Wt(e,t,i,n){let o=[];if(this.isNoBreak(e))return $t(this)&&console.info("üß° isNoBreak",e),[];if(this.isComplexTextBlock(e))return $t(this)&&console.info("üíö ComplexTextBlock",e),this._paragraph.split(e)||[];if(this.isWrappedTextNode(e))return $t(this)&&console.info("üíö TextNode",e),this._paragraph.split(e)||[];if(!Yt.call(this,e))return $t(this)&&console.info("ü™≤ getSplitChildren: empty node, return []",e),[];const r=this._DOM.getComputedStyle(e);if(this.isTableLikeNode(e,r))$t(this)&&console.info("üíö TABLE like",e),o=this._tableLike.split(e,t,i,n,r)||[];else if(this.isTableNode(e,r))$t(this)&&console.info("üíö TABLE",e),o=this._table.split(e,t,i,n)||[];else if(this.isPRE(e,r))$t(this)&&console.info("üíö PRE",e),o=this._pre.split(e,t,i,n,r)||[];else if(this.isFlexRow(e,r)){$t(this)&&console.info("ü©∑ Flex ROW",e);let t=this.getPreparedChildren(e);o=qt.call(this,t)}else this.isGridAutoFlowRow(e,r)?($t(this)&&console.info("üíú GRID"),o=this._grid.split(e,t,i,n)||[]):($t(this)&&console.info("üíö found some node - use main this.getPreparedChildren() for:",e),o=this.getPreparedChildren(e));return o}function jt(e){const t=[];if(!e||!this||!this._DOM)return t;let i=e;for(;i;){let e=this._DOM.getFirstElementChild(i);for(;e&&this.shouldSkipFlowElement(e,{context:"getFirstChildren:firstChild"});)e=this._DOM.getRightNeighbor(e);if(!e)break;if(this.isSyntheticTextWrapper(e))break;t.push(e),i=e}return t}function zt(e){const t=[];if(!e||!this||!this._DOM)return t;let i=e;for(;i;){let e=this._DOM.getLastElementChild(i);for(;e&&this.shouldSkipFlowElement(e,{context:"getLastChildren:lastChild"});)e=this._DOM.getLeftNeighbor(e);if(!e)break;if(this.isSyntheticTextWrapper(e))break;t.push(e),i=e}return t}function Vt(e){let t=null;const i=[];return e.forEach((e=>{this.isInline(e)?(t||(t=Ut.call(this,e),i.push(t)),this._DOM.insertAtEnd(t,e)):(t=null,i.push(e))})),i}function Ut(e){const t=this.createComplexTextBlock();return this._DOM.wrap(e,t),t}function qt(e){const t=e.filter((e=>this._DOM.getElementOffsetHeight(e)>0));return t.length>0?t:e}function Kt(e){return e.some(((e,t,i)=>{const n=e,o=i[t+1];if(!o)return!1;return this._DOM.getElementOffsetBottom(n)>this._DOM.getElementOffsetTop(o)}))}function Yt(e){let t=e.firstChild;for(;t;){if(this._DOM.isElementNode(t)){if(!this.shouldSkipFlowElement(t,{context:"hasRenderableChild"}))return!0}else if(this.isSignificantTextNode(t))return!0;t=t.nextSibling}return!1}const Zt=N("media"),Jt=new Set(["IMG","SVG","OBJECT","EMBED","IFRAME","VIDEO","AUDIO","CANVAS"]);function Xt(e,t="self"){return"last"===t?this._DOM.getLastElementChild(e):this._DOM.getFirstElementChild(e)}function Qt(e){if(!e)return!1;const t=this._DOM.getElementTagName(e);if(!t)return!1;if("INPUT"===t){return"image"===(this._DOM.getAttribute(e,"type")||"").toLowerCase()}return Jt.has(t)}function ei(e,{prefer:t="self"}={}){if(!e)return null;const i=new Set;let n=e;for(;n&&!i.has(n);){if(i.add(n),this.isReplacedElement(n))return n;if("function"==typeof this.resolveFlowElement){const e=this.resolveFlowElement(n,{prefer:t});if(e&&e!==n){if(this.isReplacedElement(e))return e;n=e;continue}}const e=[...this._DOM.getChildren(n)].filter((e=>{const t=this._DOM.getComputedStyle(e)?.display;return"none"!==t}));if(1!==e.length)return Zt(this)&&console.info("üß≠ resolveReplacedElement: branching or empty wrapper",n,e),null;n=Xt.call(this,n,t)||e[0]}return null}const ti=N("slicers");function ii({rootNode:e,rootComputedStyle:t,children:i,firstPartHeight:n,fullPageHeight:o,firstChild:r,points:s=[]}){if(!i.length)return ti(this)&&console.log("üß∂ [getSplitPoints] %c has no children, early returns []","font-weight:bold",{rootNode:e}),[];const l=t=>{const i=this.findBetterPageStart(t,s.at(-1),e,e);return s.length||i!==r?(ti(this)&&console.log("%c üßºüßºüßºüßº push(point) in registerPoint()","color:violet",{point:i,points:s,firstChild:r},s.length),s.push(i),!1):(ti(this)&&console.log("%c !points.length && point === children[0] && children[1]","color:red"),ti(this)&&console.log("%c üÖæÔ∏è push(null) in registerPoint()","color:red"),s.push(null),!0)};ti(this)&&console.group("üß∂ getSplitPoints"),ti(this)&&console.log("points.length",s.length);const a=t||this._DOM.getComputedStyle(e),h=new WeakMap,c=e=>{let t=h.get(e);return t||(t=Object.create(null),h.set(e,t)),t},g=t=>{if(!t)return NaN;const i=c(t);return"top"in i||(i.top=this.getNormalizedTop(t,e,a)),i.top},d=t=>{if(!t)return NaN;const i=c(t);return"bottomWithMargin"in i||(i.bottomWithMargin=this.getNormalizedBottomWithMargin(t,e,a)),i.bottomWithMargin},p=e=>{if(!e)return 0;const t=c(e);return"offsetHeight"in t||(t.offsetHeight=this._DOM.getElementOffsetHeight(e)),t.offsetHeight};this.setInitStyle(!0,e,a);let u=!1;const _=()=>(u||(u=!0,ti(this)&&console.groupEnd(`walking through ${i.length} children`),this.setInitStyle(!1,e,t),ti(this)&&console.groupEnd("getSplitPoints")),s);ti(this)&&console.group(`walking through ${i.length} children`,i);for(let t=0;t<i.length;t++){let h,c;if(0===s.length)h=n,c=n;else if(null===s.at(-1))h=o,c=o;else{const e=g(s.at(-1));if(!Number.isFinite(e))return ti(this)&&console.warn("üõë [getSplitPoints] non-finite anchorTop ‚Äî aborting slice computation",{anchor:s.at(-1),anchorTop:e,fullPageHeight:o}),_();h=e+o,c=o}const u=i[t],f=i[t-1],m=i[t+1];let b;ti(this)&&console.log({currentElement:u,previousElement:f,nextElement:m});let w=!1;if(m&&(b=g(m),Number.isFinite(b)?w=!0:ti(this)&&console.warn("[getSplitPoints] nextElementTop is not finite",{nextElement:m,nextElementTop:b})),this.isForcedPageBreak(u)){const e=l(u);if(ti(this)&&console.warn("üçé",[u],"isForcedPageBreak"),e)return _();continue}let S,M=!1;if(m&&w&&b<=h){if(S=d(u),S<=h){ti(this)&&console.log("[getSplitPoints]",t,`current fits tail window: nextTop ${b} <= ${h}, currentBottom ${S} <= ${h}`);continue}ti(this)&&console.log("[getSplitPoints] nextTop <= floater but currentBottom overflow",{currentElement:u,currentElementBottom:S,floater:h,nextElement:m,nextElementTop:b}),M=!0}if(!M&&m&&(!w||b>h))if(ti(this)&&console.log("[getSplitPoints]",`next overtook the floater : (nextElementTop) ${b} > ${h}`,{currentElement:u},"does current overflow? let's check.",{isNextElementTopFinite:w}),(this.isSVG(u)||this.isIMG(u))&&ti(this)&&console.log("%cIMAGE","color:red;text-weight:bold"),S=d(u),S<=h){if(w){ti(this)&&console.log("[getSplitPoints]",`current fits: (currentElementBottom) ${S} <= ${h}, üçé register nextElement as Point.`,{currentElement:u,nextElement:m});if(l(m))return ti(this)&&console.log("%cNULL CASE, return","color:red;text-weight:bold"),_();continue}ti(this)&&console.log("[getSplitPoints] nextElementTop not finite and current fits tail window",{currentElementBottom:S,floater:h,nextElement:m})}else ti(this)&&console.log(`üî™ü•í try to split overflowing current: (currentElementBottom > ) ${S} > ${h}`,{currentElement:u}),M=!0;if(!m){ti(this)&&console.log("%c[getSplitPoints] !nextElement","color:red"),ti(this)&&console.log("%c[getSplitPoints] * Try to split it. üî™ü•í","color:blue"),S=S??d(u);let t=u;if(u.parentElement&&e.contains(u.parentElement)){let i=u.parentElement;for(;i&&e.contains(i)&&i!==e&&!this._DOM.getRightNeighbor(i);)t=i,i=i.parentElement}const i=t===u?S:d(t);if(i<=h){ti(this)&&console.log("%c üçï [getSplitPoints] !nextElement branch fits with container shell","color:violet",{currentElementBottom:S,containerBottom:i,floater:h,containerElement:t});continue}M=!0}if(!M)continue;let P=[];const C=this.getSplitChildren(u,n,o,e);if(C.length){if(P=ii.call(this,{rootNode:e,rootComputedStyle:a,children:C,firstPartHeight:n,fullPageHeight:o,firstChild:r,points:s}),0===P.length){const e=Math.max(n,o),t=p(u),i=t>e&&(!P.length||1===P.length&&null===P[0]);if(ti(this)&&console.log("room (Math.max)",e),i){if(ti(this)&&console.warn("%c‚ö†Ô∏è UNSPLITTABLE OVERSIZED ELEMENT ‚Äî SCALE IT","color:white; background:red; font-weight:bold;",u,`height: ${t}`),!s.length&&u===r)return ti(this)&&console.warn("üÖæÔ∏è (1) points.push(null) in isUnbreakableOversized"),s.push(null),_();if(m){if(l(m))return _()}}else if(l(u))return _()}}else{ti(this)&&console.log("üçé currentElementChildren.length == 0");const e=p(u);if(e>c&&(!P.length||1===P.length&&null===P[0])){if(ti(this)&&console.warn("%c‚ö†Ô∏è UNSPLITTABLE OVERSIZED ELEMENT ‚Äî SCALE IT","color:white; background:red; font-weight:bold;",u,`height: ${e}`),ti(this)&&console.warn("üÖæÔ∏è (2) points.push(null) in isUnbreakableOversized"),!s.length&&u===r)return s.push(null),_();if(m){ti(this)&&console.warn("üÖæÔ∏èüÖæÔ∏èüÖæÔ∏èüÖæÔ∏èüÖæÔ∏èüÖæÔ∏èüÖæÔ∏èüÖæÔ∏è registerPoint(nextElement)");if(l(m))return _()}}else{if(l(u))return _()}}}return _()}function ni(e,t,i,n,o){ti(this)&&console.group("[‚úñÔ∏è] getSplitPointsPerCells");const r=e.map(((e,r)=>{ti(this)&&console.group(`(‚Ä¢) Split CELL.${r} in:`,o);let s=[];const l=i-(t[r]||0),a=n-(t[r]||0);let h=this.getSplitChildren(e,l,a,o);if(h.length){const t=h[0];ti(this)&&console.log("firstChild",t),s=this.getSplitPoints({rootNode:e,children:h,firstPartHeight:l,fullPageHeight:a,firstChild:t})}else ti(this)&&console.log(`(‚Ä¢) empty cell #${r}`);return ti(this)&&console.log(`(‚Ä¢) return splitPoints for CELL#${r}`,s),ti(this)&&console.groupEnd(),s})),s=r.some(li);ti(this)&&console.log("üßΩüßΩüßΩüßΩüßΩüßΩüßΩ isFirstPartEmptyInAnyCell",s);let l=r,a=!1;if(s){l=e.map(((e,r)=>{ti(this)&&console.group(`(‚Ä¢‚Ä¢) Split CELL.${r} in:`,o);const s=i-(t[r]||0),l=n-(t[r]||0),a=this.getSplitChildren(e,s,l,o),h=a[0];ti(this)&&console.log("firstChild",h);let c=[];return a.length&&(c=this.getSplitPoints({rootNode:e,children:a,firstPartHeight:l,fullPageHeight:l,firstChild:h})),ti(this)&&console.log(`(‚Ä¢‚Ä¢) return splitPoints for CELL#${r}`,c),ti(this)&&console.groupEnd(),c})),ti(this)&&console.log("[‚Ä¢‚Ä¢] splitPointsPerCell",l);for(let e=0;e<l.length;e++){const t=l[e];li(t)&&1===t.length&&(ti(this)&&console.log("üßΩüßΩüßΩüßΩüßΩüßΩüßΩ needsScalingInFullPage",l[e]),l[e]=[],a=!0)}}return ti(this)&&console.groupEnd("[‚úñÔ∏è] getSplitPointsPerCells"),{splitPointsPerCell:l,isFirstPartEmptyInAnyCell:s,needsScalingInFullPage:a}}function oi({index:e,rootNode:t,splitPoints:i}){ti(this)&&console.group(`üî™ (${e}) sliceNodeBySplitPoints`,i);const n=[];i.length>0&&this.strictAssert(i.every((e=>null!==e)),"sliceNodeBySplitPoints: splitPoints contains null ‚Äî sanitize upstream before slicing"),this.strictAssert(i.every((e=>!e||e.nodeType===Node.ELEMENT_NODE&&(t===e||t.contains(e)))),"sliceNodeBySplitPoints: split point is not an Element within rootNode");for(let e=0;e<=i.length;e++){const o=i[e-1]??null,r=i[e]??null,s=this.cloneAndCleanOutsideRange(t,o,r);this.normalizeContentCuts({slice:s,top:null!==o,bottom:null!==r}),this._DOM.getChildNodes(s).length>0&&n.push(s)}return ti(this)&&console.log(n),ti(this)&&console.groupEnd(`üî™ (${e}) sliceNodeBySplitPoints`),n}function ri({slice:e,top:t=!1,bottom:i=!1}){if(e){if(t){const t=[...this.getFirstChildrenChain(e)];t.forEach((e=>this.markCleanTopCut(e))),ti(this)&&console.log("[normalizeContentCuts] topChain üëó",t)}if(i){const t=[...this.getLastChildrenChain(e)];t.forEach((e=>this.markCleanBottomCut(e))),ti(this)&&console.log("[normalizeContentCuts] bottomChain üëó",t)}}else ti(this)&&console.log("[normalizeContentCuts] no slice has been passed; return")}function si({index:e,rootNode:t,splitPoints:i}){ti(this)&&console.group(`üî™ (${e}) sliceNodeContentBySplitPoints`);const n=[];for(let e=0;e<=i.length;e++){const o=i[e-1]??null,r=i[e]??null,s=this.cloneAndCleanOutsideRange(t,o,r);ti(this)&&console.log({slice:s});const l=this.createNeutralBlock();for(;s.firstChild;)l.appendChild(s.firstChild);l.childNodes.length>0&&n.push(l)}return ti(this)&&console.log(n),ti(this)&&console.groupEnd(`üî™ (${e}) sliceNodeContentBySplitPoints`),n}function li(e){return!!Array.isArray(e)&&(e.length>0&&null===e[0])}function ai(e,t,i){t&&t.setAttribute("split","start"),i&&i.setAttribute("split","end");let n=e.cloneNode(!0);if(t){let t=n.querySelector('[split="start"]'),i=t.previousElementSibling;for(;i;){let e=i;i=i.previousElementSibling,e.remove()}let o=t.parentElement;for(;o&&o!==e;){let e=o.previousElementSibling;for(;e;){let t=e;e=e.previousElementSibling,t.remove()}o=o.parentElement}t.removeAttribute("split")}if(i){let t=n.querySelector('[split="end"]'),i=t.nextElementSibling;for(;i;){let e=i;i=i.nextElementSibling,e.remove()}let o=t.parentElement;for(;o&&o!==e;){let e=o.nextElementSibling;for(;e;){let t=e;e=e.nextElementSibling,t.remove()}o=o.parentElement}t.remove()}return t&&t.removeAttribute("split"),i&&i.removeAttribute("split"),n}const hi=N("flowfilters"),ci="__html2pdfFlowFilter",gi=[{test:e=>"none"===e.display,cache:{reason:"display:none",message:"* display:none ‚Äî skipped"}},{test:e=>"absolute"===e.position,cache:{reason:"position:absolute",message:"* position:absolute ‚Äî skipped"}},{test:e=>"fixed"===e.position,cache:{reason:"position:fixed",message:"* position:fixed ‚Äî skipped"}},{test:e=>"collapse"===e.visibility,cache:{reason:"visibility:collapse",message:"* visibility:collapse ‚Äî skipped"}}];function di(e,t,i,n,{cached:o}={cached:!1}){if(!hi(e))return;const r=t?`(${t}) `:"",s=o?" (cached)":"";console.info(`üö∏ ${r}${i.message}${s}`,[n])}function pi(e,{context:t="",computedStyle:i}={}){if(!(e&&this&&this._DOM&&this._DOM.isElementNode(e)))return!1;const n=e[ci];if(n)return di(this,t,n,e,{cached:!0}),!0;const o=i??this._DOM.getComputedStyle(e);if(!o)return!1;for(const i of gi)if(i.test(o))return e[ci]=i.cache,di(this,t,i.cache,e),!0;return!1}N("pagination");function ui({cells:e,splitPointsPerCell:t,sliceCell:i}){return t.map(((t,n)=>{const o=e[n];return i({cell:o,index:n,splitPoints:t})}))}function _i({originalRow:e,originalCells:t,slicedCellsPerOriginal:i,beginRow:n,cloneCellFallback:o,handleCell:r,finalizeRow:s}){const l=Math.max(...i.map((e=>e.length))),a=[];for(let h=0;h<l;h++){const l=n({originalRow:e,sliceIndex:h});t.forEach(((e,t)=>{const n=i[t][h]||o(e);r({context:l,cellClone:n,originalCell:e,cellIndex:t})})),a.push(s({context:l}))}return a}function fi({originalRow:e,originalCells:t,splitPointsPerCell:i,sliceCell:n,beginRow:o,cloneCellFallback:r,handleCell:s,finalizeRow:l}){if(!Array.isArray(i)||!i.length)return[];const a=this.sliceCellsBySplitPoints({cells:t,splitPointsPerCell:i,sliceCell:n});return this.buildRowSlices({originalRow:e,originalCells:t,slicedCellsPerOriginal:a,beginRow:o,cloneCellFallback:r,handleCell:s,finalizeRow:l})}function mi({usedRemainingWindow:e,isFirstPartEmpty:t,firstSliceTop:i,firstSliceBottom:n,pageBottom:o,epsilon:r=.5}){return{placeOnCurrentPage:e&&!t,remainingWindowSpace:Math.max(0,o-i),exceedsWindow:n>o+r}}function bi({currentRows:e,index:t,rowSlices:i}){return Array.isArray(e)?(e.splice(t,1,...i),e):[]}const wi=N("pagination");function Si({cells:e,targetHeight:t,shells:i}){return!!(Array.isArray(e)&&e.length&&t>0)&&this.scaleCellsToHeight(e,t,i)}function Mi({needsScalingInFullPage:e,cells:t}){return Boolean(e&&Array.isArray(t)&&t.length)}function Pi({needsScalingInFullPage:e,scaleCallback:t,payload:i}){if(!e)return!1;if("function"!=typeof t)return!1;const n=t(i||{});return!n&&this&&this._debug&&this._debug._&&wi(this)&&console.warn("[pagination.scaling] requested full-page scaling but callback reported no change",i),Boolean(n)}N("pagination");function Ci(e,t,i){e&&Array.isArray(e.rows)&&e.rows.splice(t,1,...i)}function yi({rows:e,DOM:t,cellTagFilter:i,guardCallback:n}){if(!Array.isArray(e))return{};let o=!1,r=!1,s=!1,l=null;e.forEach((e=>{const n=Array.isArray(e)?e:Array.from(t.getChildren(e)||[]);null==l&&(l=n.length),n.length!==l&&(s=!0),n.forEach((e=>{const n=t.getElementTagName(e);if(!i||i(n,e)){const t=parseInt(e.getAttribute?.("rowspan"));Number.isFinite(t)&&t>1&&(o=!0);const i=parseInt(e.getAttribute?.("colspan"));Number.isFinite(i)&&i>1&&(r=!0)}}))}));const a={hasRowspan:o,hasColspan:r,inconsistentCells:s};return n?.(a),a}N("pagination");function Oi(e){if(!e||"object"!=typeof e)throw new Error("splitter kernel adapter must be an object.");if(!e.rows||"object"!=typeof e.rows)throw new Error("splitter kernel adapter must expose a rows provider.");if("function"!=typeof e.rows.replaceRow)throw new Error("splitter kernel adapter rows.replaceRow must be a function.")}function Ti(e,{rowIndex:t,rowSlices:i}){Oi(e);const n=Number.isFinite(t)?t:0,o=Array.isArray(i)?i:[],r=e.rows;r.replaceRow({rowIndex:n,rowSlices:o}),r.syncEntries?.({rowIndex:n,rowSlices:o});const s=e.guards?.getConfig?.({rowIndex:n,rowSlices:o})??r.getGuardConfig?.({rowIndex:n,rowSlices:o})??null;let l=null;if(s){const t={rows:s.rows,DOM:s.DOM||this._DOM,cellTagFilter:s.cellTagFilter,guardCallback:s.guardCallback};Array.isArray(t.rows)&&t.DOM&&(l=this.computeRowFlags(t),e.guards?.onFlags?.({flags:l,rowIndex:n,rowSlices:o}))}return e.metrics?.refresh?.({rowIndex:n,rowSlices:o,flags:l}),r.onRowsChanged?.({rowIndex:n,rowSlices:o,flags:l}),{flags:l}}N("pagination");function Ei({cells:e}){return Array.isArray(e)&&e.length?e.map((e=>{if(!e)return 0;const t=this._DOM.getComputedStyle(e),i=(parseFloat(t?.paddingTop)||0)+(parseFloat(t?.paddingBottom)||0)+(parseFloat(t?.borderTopWidth)||0)+(parseFloat(t?.borderBottomWidth)||0);return Number.isFinite(i)?Math.max(0,i):0})):[]}const Di=N("pagination");function vi({ownerLabel:e,DOM:t,row:i,targetHeight:n,cachedShells:o,getRowShellHeightsCallback:r,scaleCellsToHeightCallback:s}){if(e||Di(this)&&console.warn("[scaleRowCellsToHeight] üë§ Owner wanted!",{owner:e}),!i)return Di(this)&&console.warn("[pagination.overflow] Missing row for scaling.",{owner:e}),!1;if("function"!=typeof s)return Di(this)&&console.warn("[pagination.overflow] scaleCellsToHeight callback is required.",{owner:e}),!1;const l=t,a=l&&"function"==typeof l.getChildren?l.getChildren(i):null;return s(a?[...a]:[],n,Array.isArray(o)?o:"function"==typeof r?r(i):[])}function Ri({ownerLabel:e,rowIndex:t,row:i,availableRowHeight:n,fullPageHeight:o,splitStartRowIndexes:r,reasonTail:s,reasonFull:l,registerPageStartCallback:a,scaleProblematicCellsCallback:h,debugLogger:c}){return e||Di(this)&&console.warn("[handleRowOverflow] üë§ Owner wanted!",{owner:e}),Array.isArray(r)?"function"!=typeof a?(Di(this)&&console.warn("[pagination.overflow] registerPageStart callback is required.",{owner:e}),t):n<o?(a(t,r,s),t-1):("function"==typeof c&&c("‚ö†Ô∏è Full-page overflow: scaling row before moving",{owner:e,rowIndex:t,reasonFull:l}),"function"==typeof h?h(i,o):Di(this)&&console.warn("[pagination.overflow] scaleProblematicCells callback is missing.",{owner:e,rowIndex:t}),a(t,r,l),t-1):(Di(this)&&console.warn("[pagination.overflow] splitStartRowIndexes must be an array.",{owner:e}),t)}function xi(e){const{ownerLabel:t,rowIndex:i,row:n,availableRowHeight:o}=e;return t||Di(this)&&console.warn("[handleRowSplitFailure] üë§ Owner wanted!",{owner:t}),(!Number.isFinite(o)||o<0)&&Di(this)&&console.warn("[pagination.overflow] availableRowHeight is missing or negative.",{owner:t,rowIndex:i,availableRowHeight:o}),n?Ri(e):(Di(this)&&console.warn("[pagination.overflow] Missing row in split failure handler.",{owner:t,rowIndex:i}),i)}N("pagination");function Fi({signpostHeight:e=0,tfootHeight:t=0}={}){const i=Number.isFinite(e)?e:0,n=Number.isFinite(t)?t:0;return Math.max(0,i)+Math.max(0,n)}function Bi({slices:e,extraCapacity:t=0,ownerLabel:i="table",debug:n}){if(!Array.isArray(e)||e.length<2)return void(n&&n._&&console.warn(`[${i}.shortTail] Expected at least two slices to evaluate tail absorption, got:`,e?.length));const o=e.at(-1);if(!o)return void(n&&n._&&console.warn(`[${i}.shortTail] Missing tail slice for absorption check.`));const r=this?._DOM;if(!r)return void(n&&n._&&console.warn(`[${i}.shortTail] Missing DOM facade on Node instance.`));const s=r.getElementOffsetHeight(o)||0,l=Number.isFinite(t)?t:0;if(s<=l){n&&n._&&console.log("ü´ü Short tail absorbed last slice",{ownerLabel:i,tailHeight:s,reservedCapacity:l});const t=e.at(-2);t&&r.moveRowContent(o,t),r.removeNode(o),e.pop()}}const ki=N("pagination");function Ni({rows:e,rowIndex:t,table:i,splitBottom:n}){if(!Array.isArray(e))return null;const o=e[t];if(!o)return null;const r=this.getTop(o,i),s=this.getBottom(o,i),l=e[t+1],a=l?this.getTop(l,i):s,h=a-n;return{rowIndex:t,row:o,rowTop:r,rowBottom:s,nextMarker:a,delta:h,tailWindowHeight:n-r,isLastRow:!l,fitsCurrentWindow:h<=0}}function Ai({evaluation:e,extraCapacity:t,splitBottom:i,debug:n}){if(!e||!e.isLastRow)return!1;const o=e.rowBottom-i;return ki(this)&&console.log("ü´ü last-row-extra-check",{overflow:o,extraCapacity:t,rowBottom:e.rowBottom,splitBottom:i}),o<=t}const Hi=N("pagination");function Ii({evaluation:e,utils:t={},handlers:i={}}){if(!e||!e.row)return e?.rowIndex??0;const{rowHasSpan:n=(()=>!1),isSlice:o=(()=>!1)}=t,{handleRowWithRowspan:r=(()=>e.rowIndex),handleSplittableRow:s=(()=>e.rowIndex),handleAlreadySlicedRow:l=(()=>e.rowIndex)}=i,{row:a}=e;return n(a,e)?r({evaluation:e}):o(a,e)?l({evaluation:e}):s({evaluation:e})}function Li({evaluation:e,splitStartRowIndexes:t,fullPageHeight:i,resolveOverflow:n,debug:o,afterResolve:r}){const{rowIndex:s,tailWindowHeight:l}=e;Hi(this)&&console.log("%c ‚ö†Ô∏è Row has ROWSPAN; use conservative fallback (no slicing)","color:DarkOrange; font-weight:bold");const a=n({rowIndex:s,evaluation:e,availableRowHeight:l,splitStartRowIndexes:t,fullPageHeight:i});return r?.({evaluation:e,tailWindowHeight:l,fullPageHeight:i,result:a}),a}function $i({evaluation:e,splitStartRowIndexes:t,resolveSplitFailure:i,fullPageHeight:n,debug:o}){const{rowIndex:r,row:s,tailWindowHeight:l,delta:a}=e;return Hi(this)&&console.log(`%c Row # ${r} is slice! but don't fit`,"color:DarkOrange; font-weight:bold",s),Hi(this)&&console.warn("%c SUPER BIG","background:red;color:white",a,{part:n}),i({evaluation:e,splitStartRowIndexes:t,availableRowHeight:l,fullPageHeight:n})}function Gi({tailWindowHeight:e,minMeaningfulRowSpace:t,fullPartHeight:i,debug:n}){return e<t?(n&&n._&&console.log(`%c ${e} < ${t} %c (remainingPageSpace < minMeaningfulRowSpace) ‚Üí use full-page budget for the first part`,"color:red; font-weight:bold; background:#F1E9D2",""),{firstPartHeight:i,insufficientRemainingWindow:!0}):{firstPartHeight:e,insufficientRemainingWindow:!1}}function Wi({rowIndex:e,row:t,firstPartHeight:i,fullPageHeight:n,debug:o,decorateRowSlice:r,rowAdapter:s}){if(!t)return{newRows:[],isFirstPartEmptyInAnyTD:!1,needsScalingInFullPage:!1};const l=s??ji.call(this,{row:t,rowIndex:e,decorateRowSlice:r}),a=l.getParentContainer?.({row:t,rowIndex:e})??t,h=l.getOriginalCells?.({row:t,rowIndex:e})??[];if(!Array.isArray(h)||0===h.length)return{newRows:[],isFirstPartEmptyInAnyTD:!1,needsScalingInFullPage:!1};const c=l.getShellHeights?.({row:t,rowIndex:e,cells:h})??[];o&&o._&&console.log("üßø row shell heights",c),l.markOriginalRow?.({row:t,rowIndex:e,cells:h});const g=this.getSplitPointsPerCells(h,c,i,n,a)||{};o&&o._&&console.log("[‚úñÔ∏è] getSplitPointsPerCells result:",g);const d=g.splitPointsPerCell||[],p=g.isFirstPartEmptyInAnyCell,u=g.needsScalingInFullPage,_=l.sliceCell||(({cell:e,index:t,splitPoints:i})=>this.sliceNodeBySplitPoints({index:t,rootNode:e,splitPoints:i})),f=l.beginRow||(({originalRow:t,sliceIndex:i})=>{const n=this._DOM.cloneNodeWrapper(t);return r?.({rowWrapper:n,rowIndex:e,sliceIndex:i,originalRow:t}),{rowWrapper:n}}),m=l.cloneCellFallback||(e=>this._DOM.cloneNodeWrapper(e)),b=l.handleCell||(({context:e,cellClone:t})=>{this._DOM.insertAtEnd(e.rowWrapper,t)}),w=l.finalizeRow||(({context:e})=>e.rowWrapper),S=[];if(d.some((e=>Array.isArray(e)&&e.length))){const e=this.paginationBuildBalancedRowSlices({originalRow:t,originalCells:h,splitPointsPerCell:d,sliceCell:_,beginRow:f,cloneCellFallback:m,handleCell:b,finalizeRow:w});S.push(...e)}else Hi(this)&&console.log("üî¥ There is no Split");return S.length&&this.markSliceCutsInRows(S),o&&o._&&console.log("%c newRows \n","color:magenta; font-weight:bold",S),{newRows:S,isFirstPartEmptyInAnyTD:p,needsScalingInFullPage:u}}function ji({row:e,rowIndex:t,decorateRowSlice:i}){const n=Array.isArray(e),o=this;return{getParentContainer:()=>n?null:e,getOriginalCells:()=>n?[...e]:[...o._DOM.getChildren(e)],getShellHeights:({cells:t})=>n?[]:o.getTableRowShellHeightByTD(e),markOriginalRow:({cells:t})=>{n||o.setFlagSlice(e)},beginRow:({originalRow:e,sliceIndex:r})=>{if(n)return{cells:[]};const s=o._DOM.cloneNodeWrapper(e);return i?.({rowWrapper:s,rowIndex:t,sliceIndex:r,originalRow:e}),{rowWrapper:s}},cloneCellFallback:e=>o._DOM.cloneNodeWrapper(e),handleCell:({context:e,cellClone:t})=>{n?(o.setFlagSlice(t),e.cells.push(t)):o._DOM.insertAtEnd(e.rowWrapper,t)},finalizeRow:({context:e})=>n?e.cells:e.rowWrapper}}function zi({evaluation:e,splitResult:t,splitStartRowIndexes:i,insufficientRemainingWindow:n,extraCapacity:o,fullPageHeight:r,debug:s,handlers:l={}}){const{newRows:a,isFirstPartEmptyInAnyTD:h,needsScalingInFullPage:c}=t||{},{rowIndex:g,row:d,isLastRow:p,tailWindowHeight:u}=e,{onReplaceRow:_,onAbsorbTail:f,onRefreshRows:m,onPlacement:b,onSplitFailure:w}=l;return Array.isArray(a)&&a.length?(_?.({evaluation:e,newRows:a}),p&&f?.({evaluation:e,newRows:a,extraCapacity:o}),m?.({evaluation:e,newRows:a,splitStartRowIndexes:i}),b?.({evaluation:e,newRows:a,insufficientRemainingWindow:n,isFirstPartEmptyInAnyTD:h,needsScalingInFullPage:c,splitStartRowIndexes:i})??e.rowIndex):(Hi(this)&&console.log(`%c The row is not split. (ROW.${g})`,"color:orange",d),w?.({evaluation:e,splitStartRowIndexes:i,availableRowHeight:u,fullPageHeight:r})??e.rowIndex)}function Vi({evaluation:e,splitStartRowIndexes:t,extraCapacity:i,fullPageHeight:n,minPartLines:o,debug:r,decorateRowSlice:s,onBudgetInfo:l,handlers:a={}}){if(!e||!e.row)return e?.rowIndex??0;const{row:h}=e,c=this.getTableRowHeight(h,o),g=this.paginationCalculateRowSplitBudget({tailWindowHeight:e.tailWindowHeight,minMeaningfulRowSpace:c,fullPartHeight:n,debug:r});l?.({evaluation:e,firstPartHeight:g.firstPartHeight,fullPartHeight:n});const d=a.getRowSliceAdapter,p=d?.({evaluation:e,row:h,rowIndex:e.rowIndex,decorateRowSlice:s}),u=this.paginationSplitRow({rowIndex:e.rowIndex,row:h,firstPartHeight:g.firstPartHeight,fullPageHeight:n,debug:r,decorateRowSlice:s,rowAdapter:p});return this.paginationProcessRowSplitResult({evaluation:e,splitResult:u,splitStartRowIndexes:t,insufficientRemainingWindow:g.insufficientRemainingWindow,extraCapacity:i,fullPageHeight:n,debug:r,handlers:a})}function Ui({evaluation:e,table:t,newRows:i,insufficientRemainingWindow:n,isFirstPartEmptyInAnyTD:o,needsScalingInFullPage:r,splitStartRowIndexes:s,pageBottom:l,fullPageHeight:a,debug:h,registerPageStartCallback:c,scaleProblematicSliceCallback:g,applyFullPageScalingCallback:d}){const{rowIndex:p}=e,u=Array.isArray(i)?i[0]:null;if(!u)return c?.({targetIndex:p,reason:"Row split produced empty first slice"}),p-1;const _=this.getTop(u,t),f=this.getBottom(u,t),m=this.evaluateRowSplitPlacement({usedRemainingWindow:!n,isFirstPartEmpty:o,firstSliceTop:_,firstSliceBottom:f,pageBottom:l,epsilon:0});return m.placeOnCurrentPage?(m.remainingWindowSpace>0&&g?.(u,m.remainingWindowSpace),c?.({targetIndex:p+1,reason:"Row split ‚Äî next slice starts new page"})):(d?.({row:u,needsScalingInFullPage:r,fullPageHeight:a}),c?.({targetIndex:p,reason:"Empty first part ‚Äî move row to next page"})),p-1}class qi{constructor({config:e,DOM:t,node:n,selector:o}){this._debug=e.debugMode?{...e.debugConfig.paragraph}:{},this._assert=!!e.consoleAssert,this._DOM=t,this._selector=o,this._node=n,this._minParagraphLeftLines=2,this._minParagraphDanglingLines=2,this._minParagraphBreakableLines=this._minParagraphLeftLines+this._minParagraphDanglingLines||2,Object.assign(this,i)}split(e){return this._splitComplexTextBlockIntoLines(e)}_estimateLineCount(e){return Math.ceil(this._DOM.getElementOffsetHeight(e)/this._node.getLineHeight(e))}_splitComplexTextBlockIntoLines(e){if(this._debug._&&console.group("_splitComplexTextBlockIntoLines",[e]),this._estimateLineCount(e)<this._minParagraphBreakableLines)return this.logGroupEnd("few lines - Not to break it up"),[];if(this._node.isSelectorMatching(e,this._selector.split))return this.logGroupEnd(this._selector.split),this._DOM.getChildren(e);const t=this._node.getPreparedChildren(e),i=t.map((e=>{const t=this._node.getLineHeight(e),i=this._DOM.getElementOffsetHeight(e),n=this._DOM.getElementOffsetLeft(e),o=this._DOM.getElementOffsetTop(e);return{element:e,lines:Math.ceil(i/t),left:n,top:o,height:i,lineHeight:t,text:this._DOM.getInnerHTML(e)}}));this._debug._&&console.log("\nüö∏ nodeChildren",[...t],"\nüö∏ extendedChildrenArray",[...i]);const n=i.flatMap((e=>e.lines>1&&!this._node.isNoBreak(e.element)?this._breakItIntoLines(e.element):e.element));this._debug._&&console.log("\nüö∏üö∏üö∏\n partiallyLinedChildren",[...n]);const o=n.reduce(((e,t,i,n)=>(e||(e=[]),"BR"===this._DOM.getElementTagName(t)?(e.at(-1).push(t),e.push([]),this._debug._&&console.log("br; push:",t),e):!e.length||this._node.isLineChanged(e.at(-1).at(-1),t)?(e.push([t]),this._debug._&&console.log("‚óºÔ∏è start new line:",t),e):0===e.at(-1).length||e.length&&this._node.isLineKept(e.at(-1).at(-1),t)?(this._debug._&&console.log("‚¨Ü add to line:",t),e.at(-1).push(t),e):void this.strictAssert(!0,"groupedPartiallyLinedChildren: An unexpected case of splitting a complex paragraph into lines.","\nOn the element:",t))),[]);if(this._debug._&&console.log("üü°üü°üü° groupedPartiallyLinedChildren \n",o.length,[...o]),o.length<this._minParagraphBreakableLines)return this._debug._&&console.log("groupedPartiallyLinedChildren.length < this._minParagraphBreakableLines",o.length,"<",this._minParagraphBreakableLines),this.logGroupEnd("NOT _splitComplexTextBlockIntoLines"),[];const r=o.slice(0,this._minParagraphLeftLines).flat(),s=o.slice(-this._minParagraphDanglingLines).flat();this._debug._&&console.log("groupedPartiallyLinedChildren",[...o],"\n","minLeftLines =",this._minParagraphLeftLines,"\n",r,"\n","minDanglingLines =",this._minParagraphDanglingLines,"\n",s),o.splice(0,this._minParagraphLeftLines,r),o.splice(-this._minParagraphDanglingLines,this._minParagraphDanglingLines,s);const l=o.map(((e,t)=>{let i;if(0==e.length)i=e[0],i.setAttribute("role","üö´"),this.strictAssert(0==e.length,"The string cannot be empty (_splitComplexTextBlockIntoLines)");else if(1==e.length)i=e[0];else{i=this._node.createTextGroup(),this._DOM.insertBefore(e[0],i),this._DOM.insertAtEnd(i,...e)}return i.dataset.child=t,i}));return this.logGroupEnd("OK _splitComplexTextBlockIntoLines"),this._DOM.setAttribute(e,this._selector.split),l}_breakItIntoLines(e){if(this._debug._&&console.group("_breakItIntoLines",[e]),this._node.isNoBreak(e))return this.logGroupEnd("isNoBreak"),e;if(this._node.isWrappedTextNode(e)){const t=this._breakWrappedTextNodeIntoLines(e);return this.logGroupEnd("TextNode newLines"),t}return this.logGroupEnd("(recursive _breakItIntoLines)"),this._processNestedInlineElements(e)}_processNestedInlineElements(e){this._debug._&&console.group("_processNestedInlineElements",[e]);const t=this._getNestedInlineChildren(e).flatMap((e=>this._estimateLineCount(e)>1?this._breakItIntoLines(e):e)),i=this._findNewLineStarts(t,e),n=i.map(((n,o)=>{const r=t[n],s=t[i[o+1]];return this._node.cloneAndCleanOutsideRange(e,r,s)}));return this._DOM.insertInsteadOf(e,...n),this.logGroupEnd("Nested Inline parts"),n}_getNestedInlineChildren(e){return[...this._DOM.getChildNodes(e)].reduce(((e,t)=>{if(this._node.isSignificantTextNode(t)){const i=this._node.createTextNodeWrapper();return this._DOM.wrap(t,i),e.push(i),e}if(!this._DOM.getElementOffsetParent(t)){const i=this._node.getPreparedChildren(t);return i.length>0&&e.push(...i),e}if(this._DOM.isElementNode(t)){return this._getNestedInlineChildren(t).forEach((t=>e.push(t))),e}}),[])}_makeWordsFromTextNode(e){const t=this._node.splitTextByWordsGreedy(e);this._debug._&&console.log("wordArray",t);const i=t.map(((e,t)=>this._node.createWord(e+"",t)));return this._debug._&&console.log("wrappedWordArray",i),{wordArray:t,wrappedWordArray:i}}_breakWrappedTextNodeIntoLines(e){e.classList.add("üî†_breakItIntoLines"),e.classList.add("üö´_must_be_removed");const{wordArray:t,wrappedWordArray:i}=this._makeWordsFromTextNode(e);this._DOM.setInnerHTML(e,""),this._DOM.insertAtEnd(e,...i);const n=this._findNewLineStarts(i,e),o=n.reduce(((i,o,r)=>{const s=this._node.createTextLine(),l=n[r],a=n[r+1],h=t.slice(l,a).join("")+"";return this._DOM.setInnerHTML(s,h),this._DOM.insertBefore(e,s),i.push(s),i}),[]);return e.remove(),o}_findNewLineStarts(e,t){const i=t.style.lineHeight;t.style.lineHeight=2;const n=e.reduce(((t,i,n)=>{const o=n>0?e[n-1].offsetTop:void 0,r=n>0?e[n-1].offsetHeight:void 0,s=i.offsetTop;return n>0&&o+r<=s&&t.push(n),t}),[0]);return t.style.lineHeight=i,n}}function Ki(e){if(e)return"function"==typeof e.getDebug?e.getDebug():e.debug}function Yi(e,t,i="unknown case"){if(!e||"function"!=typeof e.getSplitBottom||"function"!=typeof e.setSplitBottom)throw new Error("updateSplitBottom: adapter must expose getSplitBottom() and setSplitBottom().");const n=e.getSplitBottom();let o;if("number"==typeof t)o=t;else{if(!(t instanceof HTMLElement))throw new Error("updateSplitBottom: unexpected value type: "+typeof t);if("function"!=typeof e.computeSplitBottomForElement)throw new Error("updateSplitBottom: adapter must implement computeSplitBottomForElement(element).");o=e.computeSplitBottomForElement(t)}e.setSplitBottom(o);const r=function(e){return e?"function"==typeof e.getSplitBottomLog?e.getSplitBottomLog():e.splitBottomLog||null:null}(e);Array.isArray(r)&&r.push(o);const s=Ki(e);s&&s._&&console.log(`%c‚ôªÔ∏è [${function(e){return e?.label||"üë§ [paginator.label] element"}(e)}] update splitBottom (with ${t}) \n ‚Ä¢ ${i}`,"color: green; font-weight: bold","\n",n||"‚Ä¢‚Ä¢‚Ä¢","->",o,r?`\n log: ${r}`:"")}function Zi(e,t,i,n="register page start"){const o=function(e){return e?"function"==typeof e.getRows?e.getRows()||[]:e.rows||[]:[]}(e),r=o.length,s=function(e){return!!e&&("function"==typeof e.shouldAssert?e.shouldAssert():Boolean(e.assert))}(e),l=Ki(e),a=Number.isInteger(t);if(s&&console.assert(a,`registerPageStartAt: index must be an integer, got: ${t}`),!a)return;if(s&&console.assert(r>0,"registerPageStartAt: no rows to register"),0===r)return;if(0===t)return l&&l._&&console.log("%c üìç Row #0 forced to next page (no short first fragment)","color:green; font-weight:bold"),void((o[0]instanceof HTMLElement||"number"==typeof o[0])&&Yi(e,o[0],`${n} (index=0)`));let h=Math.max(1,Math.min(t,r-1));const c=i.at(-1);if(null!=c&&h<=c&&(h=c+1),h>=r)return void(l&&l._&&console.warn(`registerPageStartAt return: computed index (${h}) >= rowsLen (${r})`,"Last split index should not equal rows.length, or the original table will be empty."));i.push(h),l&&l._&&console.log(`%c üìç Row # ${h} registered as page start`,"color:green; font-weight:bold");const g=o[h];(g instanceof HTMLElement||"number"==typeof g)&&Yi(e,g,n)}function Ji(e){return e._node.createSignpost("(table continued)",e._signpostHeight)}function Xi({owner:e=null,currentRows:t=[]}={}){return{owner:e,currentRows:Array.isArray(t)?t:[],parts:[]}}function Qi({entries:e,part:t,startIndex:i=null,endIndex:n=null,type:o="unknown",rows:r=[],meta:s}){if(!e||!t)return null;const l=function(e){if(e)return Array.isArray(e.parts)||(e.parts=[]),e.parts}(e);if(!l)return null;const a={part:t,type:o,startIndex:i,endIndex:n,rows:Array.isArray(r)?[...r]:[]};return s&&"object"==typeof s&&Object.keys(s).length&&(a.meta={...s}),l.push(a),a}class en{constructor({config:e,DOM:t,node:n,selector:o}){this._debug=e.debugMode?{...e.debugConfig.table}:{},this._assert=!!e.consoleAssert,this._DOM=t,this._selector=o,this._node=n,this._splitLabelHeightFromConfig=e.splitLabelHeight,this._initConstants(),Object.assign(this,i),this._resetCurrent()}split(e,t,i,n){this._setCurrent(e,t,i,n);const o=this._splitCurrentTable();return this._resetCurrent(),o}_initConstants(){this._signpostHeight=parseFloat(this._splitLabelHeightFromConfig)||0,this._minPartLines=2}_resetCurrent(){this._currentTable=void 0,this._currentFirstPageBottom=void 0,this._currentFullPageHeight=void 0,this._currentRoot=void 0,this._currentTableEntries=void 0,this._currentTableRecordedParts=void 0,this._currentTableDistributedRows=void 0,this._currentTableFirstPartContentBottom=void 0,this._currentTableFullPartContentHeight=void 0,this._currentTableTfootHeight=void 0,this._currentTableSplitBottom=void 0,this._logSplitBottom_=[],this._currentRowShellCache=void 0,this._currentOverflowHelpers=void 0,this._currentTableHasRowspan=void 0,this._currentTableHasColspan=void 0,this._currentTableInconsistentCells=void 0,this._currentTableHasUnexpectedChildren=void 0}_setCurrent(e,t,i,n){this._currentTable=e,this._currentFirstPageBottom=t,this._currentFullPageHeight=i,this._currentRoot=n,this._currentRowShellCache=new WeakMap,this._currentOverflowHelpers=this._composeOverflowHelpers()}_prepareCurrentTableForSplitting(){this._lockCurrentTableWidths(),this._collectCurrentTableEntries(),this._updateCurrentTableDistributedRows(),this._currentTableRecordedParts=Xi({owner:this._currentTable,currentRows:this._currentTableDistributedRows}),this._currentTableEntries&&(this._currentTableEntries.recordedParts=this._currentTableRecordedParts),this._currentTable.__html2pdfRecordedParts=this._currentTableRecordedParts,this._analyzeCurrentTableStructure(),this._collectCurrentTableMetrics()}_lockCurrentTableWidths(){this._node.lockTableWidths(this._currentTable)}_splitCurrentTable(){this._prepareCurrentTableForSplitting(),this._setCurrentTableFirstSplitBottom(),this._debug._&&console.group("%cüìä _splitCurrentTable()","color:green; background:#eee; padding:3px","\n‚Ä¢",this._currentTableFirstPartContentBottom,"(1st bottom)","\n‚Ä¢",this._currentTableFullPartContentHeight,"(full part height)",{table:this._currentTable,rows:[...this._currentTableDistributedRows],rowCount:this._currentTableDistributedRows.length,entries:this._currentTableEntries,root:this._currentRoot});const e=this._resolveCurrentTableDistributedRowsInPlace();if(this._debug._&&console.log("üìä updated table rows",{rows_new:[...this._currentTableDistributedRows],rowCount_new:this._currentTableDistributedRows.length,splitStartRowIndexes:e}),!e.length)return this.logGroupEnd("[_splitCurrentTable]: there are no splits (!splitStartRowIndexes.length)"),[];let t=this._createTableSlices({splitPoints:e,table:this._currentTable,tableEntries:this._currentTableEntries});return this._node.markSliceCuts([this._currentTable,...t]),this._signpostHeight&&(t=this._extendTableSlices(t)),this._DOM.insertAfter(this._currentTable,...t),this._debug._&&console.log("tableSlices",t),this._debug._&&console.log("[table.split] recordedParts",this._currentTableRecordedParts?.parts),this.logGroupEnd("[_splitCurrentTable]"),[this._currentTable,...t]}_resolveCurrentTableDistributedRowsInPlace(){let e=[];for(let t=0;t<this._currentTableDistributedRows.length;t++)t=this._evaluateAndResolveRow(t,e);return this.strictAssert(e.every((e=>Number.isInteger(e)&&e>0&&e<=this._currentTableDistributedRows.length)),"splitStartRowIndexes contains invalid indexes"),this.strictAssert(e.every(((e,t,i)=>0===t||e>i[t-1])),"splitStartRowIndexes must be strictly ascending and without duplicates"),this.strictAssert(e.at(-1)!==this._currentTableDistributedRows.length,"Last split index should not equal rows.length, or the original table will be empty."),e}_evaluateAndResolveRow(e,t){const i=e,n=this._currentTableDistributedRows.length;this._debug._&&console.groupCollapsed(`üî≤ %c Check the Row # ${i} (from ${n})`,"");const o=this._node.paginationBuildRowEvaluationContext({rows:this._currentTableDistributedRows,rowIndex:e,table:this._currentTable,splitBottom:this._currentTableSplitBottom});if(!o?.row)return console.warn("[table.split] Missing row during evaluation.",{rowIndex:e}),this.logGroupEnd(`Row # ${i} (from ${n}) is checked`),e;if(this._debug._){const e=o.fitsCurrentWindow,t=e?"green":"orange",i=e?"<=":">";console.log(`%cüìê does row fit? %c ${e} %c :: ${o.nextMarker} ${i} ${this._currentTableSplitBottom} %c(Œî=${o.delta})`,"",`font-weight:bold;color:${t};`,"",`color:${t};`)}if(this._debug._&&console.info({row:o.row,rows:[...this._currentTableDistributedRows]}),o.fitsCurrentWindow)return this._debug._&&console.log(`%c ‚úì Row # ${e}: PASS`,"color:green"),this.logGroupEnd(`Row # ${i} (from ${n}) is checked`),e;const r=this._node.calculateFinalPartReclaimedHeight({signpostHeight:this._signpostHeight,tfootHeight:this._currentTableTfootHeight});if(this._node.paginationCanAbsorbLastRow({evaluation:o,extraCapacity:r,splitBottom:this._currentTableSplitBottom,debug:this._debug}))return this._debug._&&console.log("ü´ü last-row-fits-without-bottom-signpost: skip split"),this.logGroupEnd(`Row # ${i} (from ${n}) is checked`),e;const s=this._resolveOverflowingRow({evaluation:o,splitStartRowIndexes:t,extraCapacity:r});return this.logGroupEnd(`Row # ${i} (from ${n}) is checked`),s}_resolveOverflowingRow({evaluation:e,splitStartRowIndexes:t,extraCapacity:i}){return this._node.paginationResolveOverflowingRow({evaluation:e,utils:{rowHasSpan:e=>this._rowHasSpan(e),isSlice:e=>this._node.isSlice(e)},handlers:{handleRowWithRowspan:()=>this._node.paginationResolveRowWithRowspan({evaluation:e,splitStartRowIndexes:t,fullPageHeight:this._currentTableFullPartContentHeight,resolveOverflow:({evaluation:e,splitStartRowIndexes:t,availableRowHeight:i,fullPageHeight:n})=>this._forwardOverflowFallback({rowIndex:e.rowIndex,row:e.row,availableRowHeight:i,fullPageHeight:n,splitStartRowIndexes:t,reasonTail:"Row with ROWSPAN ‚Äî move to next page",reasonFull:"Row with ROWSPAN ‚Äî scaled TDs to full page",branch:"rowspan"}),debug:this._debug,afterResolve:({tailWindowHeight:e,fullPageHeight:t})=>{this._debug._&&e>=t&&console.warn("[table.fallback] ROWSPAN row required full-page scaling to fit.")}}),handleSplittableRow:()=>this._resolveSplittableRow({evaluation:e,splitStartRowIndexes:t,extraCapacity:i}),handleAlreadySlicedRow:()=>this._node.paginationResolveAlreadySlicedRow({evaluation:e,splitStartRowIndexes:t,fullPageHeight:this._currentTableFullPartContentHeight,debug:this._debug,resolveSplitFailure:({evaluation:e,splitStartRowIndexes:t,availableRowHeight:i,fullPageHeight:n})=>this._forwardOverflowFallback({rowIndex:e.rowIndex,row:e.row,availableRowHeight:i,fullPageHeight:n,splitStartRowIndexes:t,reasonTail:"Slice doesn't fit tail ‚Äî move to next page",reasonFull:"Scaled TD content to fit full page",branch:"alreadySliced"})})}})}_resolveSplittableRow({evaluation:e,splitStartRowIndexes:t,extraCapacity:i}){const{rowIndex:n}=e;this._debug._&&console.group(`%c üî≥ Try to split the ROW ${n} %c (from ${this._currentTableDistributedRows.length})`,"color:magenta;","");const o=this._node.paginationResolveSplittableRow({evaluation:e,splitStartRowIndexes:t,extraCapacity:i,fullPageHeight:this._currentTableFullPartContentHeight,minPartLines:this._minPartLines,debug:this._debug,decorateRowSlice:({rowWrapper:e,rowIndex:t,sliceIndex:i})=>{this._DOM.setAttribute(e,`.splitted_row_${t}_part_${i}`)},onBudgetInfo:({evaluation:e,firstPartHeight:t,fullPartHeight:i})=>{this._debug._&&console.info({currRowTop:e.rowTop,"‚Ä¢ splitBottom":this._currentTableSplitBottom,"‚Ä¢ is row sliced?":!1,"remaining page space":e.tailWindowHeight,"first part height":t,"full part height":i})},handlers:{onReplaceRow:({evaluation:e,newRows:t})=>{this._replaceRowInDOM(e.row,t)},onAbsorbTail:({newRows:e,extraCapacity:t})=>{this._node.absorbShortTrailingSliceIfFits({slices:e,extraCapacity:t,ownerLabel:"table",debug:this._debug})},onRefreshRows:({evaluation:e,newRows:t})=>{this._node.paginationRefreshRowsAfterSplit(this._getSplitterAdapter(),{rowIndex:e.rowIndex,rowSlices:t})},onPlacement:({evaluation:e,newRows:i,insufficientRemainingWindow:n,isFirstPartEmptyInAnyTD:o,needsScalingInFullPage:r})=>this._node.paginationHandleRowSlicesPlacement({evaluation:e,table:this._currentTable,newRows:i,insufficientRemainingWindow:n,isFirstPartEmptyInAnyTD:o,needsScalingInFullPage:r,splitStartRowIndexes:t,pageBottom:this._currentTableSplitBottom,fullPageHeight:this._currentTableFullPartContentHeight,debug:this._debug,registerPageStartCallback:({targetIndex:e,reason:i})=>this._registerPageStartAt(e,t,i),scaleProblematicSliceCallback:(e,t)=>{t>0&&(this._debug._&&console.log("‚öñÔ∏è scaleProblematicCellsToHeight"),this._scaleProblematicCellsToHeight(e,t,this._getRowShellHeights(e)))},applyFullPageScalingCallback:({row:e,needsScalingInFullPage:t,fullPageHeight:i})=>{this._node.paginationApplyFullPageScaling({needsScalingInFullPage:t&&Boolean(e),payload:{row:e,targetHeight:i},scaleCallback:({row:e,targetHeight:t})=>(this._debug._&&console.log("‚öñÔ∏è scaleProblematicCellsToHeight"),this._scaleProblematicCellsToHeight(e,t,this._getRowShellHeights(e)))})}}),onSplitFailure:({evaluation:e,splitStartRowIndexes:t,availableRowHeight:i,fullPageHeight:n})=>this._forwardOverflowFallback({rowIndex:e.rowIndex,row:e.row,availableRowHeight:i,fullPageHeight:n,splitStartRowIndexes:t,reasonTail:"Split failed ‚Äî move row to next page",reasonFull:"Scaled TDs to fit full-page",branch:"splitFailure"})}});return this.logGroupEnd(`üî≥ Try to split the ROW ${n} (from ${this._currentTableDistributedRows.length})`),o}_collectCurrentTableEntries(){this._currentTableEntries=this._node.getTableEntries(this._currentTable)}_rowHasSpan(e){const t=[...this._DOM.getChildren(e)];for(const e of t){const t=this._DOM.getElementTagName(e);if("TD"!==t&&"TH"!==t)continue;const i=parseInt(e.getAttribute("rowspan"));if(Number.isFinite(i)&&i>1)return!0}return!1}_collectCurrentTableMetrics(){const e=this._node.getEmptyNodeHeightByProbe(this._currentTable,'<tr style="padding:0;border:0;"><td style="padding:0;border:0;"></td></tr>',!1),t=this._node.getTopForPageStartCandidate(this._currentTable,this._currentRoot),i=(this._node.getTopWithMargin(this._currentTable,this._currentRoot),this._DOM.getElementOffsetHeight(this._currentTableEntries.caption)||0),n=this._DOM.getElementOffsetTop(this._currentTableDistributedRows[0],this._currentTable)-i||0;this._currentTableTfootHeight=this._DOM.getElementOffsetHeight(this._currentTableEntries.tfoot)||0,this._currentTableFirstPartContentBottom=this._currentFirstPageBottom-t-e-this._signpostHeight,this._currentTableFullPartContentHeight=this._currentFullPageHeight-i-n-this._currentTableTfootHeight-e-2*this._signpostHeight}_getDistributedRows(e){return[...e.rows,...e.tfoot?[e.tfoot]:[]]}_updateCurrentTableDistributedRows(){this._currentTableDistributedRows=this._getDistributedRows(this._currentTableEntries)}_analyzeCurrentTableStructure(){this._currentTableEntries;const e=this._currentTableDistributedRows||[],t=this._node.computeRowFlags({rows:e,DOM:this._DOM,cellTagFilter:(e,t)=>"TFOOT"!==this._DOM.getElementTagName(t.parentNode)&&("TD"===e||"TH"===e)});this._currentTableHasRowspan=t.hasRowspan,this._currentTableHasColspan=t.hasColspan,this._currentTableInconsistentCells=t.inconsistentCells,this._debug._&&(t.hasRowspan&&console.warn("[table.guard] ROWSPAN detected ‚Äî slicing not implemented; applying conservative fallback.",{table:this._currentTable}),t.hasColspan&&console.warn("[table.guard] COLSPAN present ‚Äî handled within-row slicing; monitor results.",{table:this._currentTable}),t.inconsistentCells&&console.warn("[table.guard] Inconsistent cell counts across rows ‚Äî results may vary.",{table:this._currentTable}))}_updateCurrentTableEntriesAfterSplit(e,t){this._currentTableEntries.rows.splice(e,1,...t)}_setCurrentTableFirstSplitBottom(){this._node.getTop(this._currentTableDistributedRows[0],this._currentTable)>this._currentTableSplitBottom?(this._updateCurrentTableSplitBottom(this._currentTableFullPartContentHeight,"SPECIAL CASE: start immediately from the full height of the page"),this._debug._&&console.log("The Row 0 goes to the 2nd page")):this._updateCurrentTableSplitBottom(this._currentTableFirstPartContentBottom,"start with a short first part")}_getPaginatorAdapter(){return{label:"table",getSplitBottom:()=>this._currentTableSplitBottom,setSplitBottom:e=>{this._currentTableSplitBottom=e},computeSplitBottomForElement:e=>this._node.getTop(e,this._currentTable)+this._currentTableFullPartContentHeight,getRows:()=>this._currentTableDistributedRows,shouldAssert:()=>this._assert,getDebug:()=>this._debug,getSplitBottomLog:()=>this._logSplitBottom_}}_getSplitterAdapter(){const e=()=>({rows:this._currentTableDistributedRows||[],DOM:this._DOM,cellTagFilter:(e,t)=>{const i=t?.parentNode;return"TFOOT"!==(i?this._DOM.getElementTagName(i):void 0)&&("TD"===e||"TH"===e)}});return{label:"table",rows:{getCurrentRows:()=>this._currentTableDistributedRows||[],replaceRow:({rowIndex:e,rowSlices:t})=>{this._node.applyRowSlicesToEntriesAfterRowSplit(this._currentTableEntries,e,t)},syncEntries:()=>{this._updateCurrentTableDistributedRows(),this._currentTableRecordedParts&&(this._currentTableRecordedParts.currentRows=this._currentTableDistributedRows)},getGuardConfig:e,onRowsChanged:()=>{this._currentTableRecordedParts&&(this._currentTableRecordedParts.currentRows=this._currentTableDistributedRows)}},guards:{getConfig:e,onFlags:({flags:e})=>{e&&(this._currentTableHasRowspan=Boolean(e.hasRowspan),this._currentTableHasColspan=Boolean(e.hasColspan),this._currentTableInconsistentCells=Boolean(e.inconsistentCells))}}}}_updateCurrentTableSplitBottom(e,t="unknown case"){Yi(this._getPaginatorAdapter(),e,t)}_registerPageStartAt(e,t,i="register page start"){Zi(this._getPaginatorAdapter(),e,t,i)}_composeOverflowHelpers(){const e=this._node.scaleCellsToHeight.bind(this._node),t=this._getRowShellHeights.bind(this),i={ownerLabel:"table",registerPageStartCallback:this._registerPageStartAt.bind(this),debugLogger:this._debug&&this._debug._?(e,t)=>console.log(e,t):void 0,scaleProblematicCellsCallback:(i,n,o)=>this._node.scaleRowCellsToHeight({ownerLabel:"table",DOM:this._DOM,row:i,targetHeight:n,cachedShells:o,getRowShellHeightsCallback:t,scaleCellsToHeightCallback:e})};return this._currentOverflowHelpers=i,i}_scaleProblematicCellsToHeight(e,t,i){return(this._currentOverflowHelpers||this._composeOverflowHelpers()).scaleProblematicCellsCallback(e,t,i)}_forwardOverflowFallback({rowIndex:e,row:t,availableRowHeight:i,fullPageHeight:n,splitStartRowIndexes:o,reasonTail:r,reasonFull:s,branch:l}){const a=this._currentOverflowHelpers||this._composeOverflowHelpers(),h={ownerLabel:`table:${l}`,rowIndex:e,row:t,availableRowHeight:i,fullPageHeight:n,splitStartRowIndexes:o,reasonTail:r,reasonFull:s,registerPageStartCallback:a.registerPageStartCallback,scaleProblematicCellsCallback:a.scaleProblematicCellsCallback,debugLogger:a.debugLogger};return this._debug._&&console.log(`%c[table.overflow] branch=${l} rowIndex=${e} tail=${i} full=${n}`,"color:orange; font-weight:bold",{reasonTail:r,reasonFull:s}),"splitFailure"===l?this._node.handleRowSplitFailure(h):this._node.handleRowOverflow(h)}_getRowShellHeights(e){if(!this._currentRowShellCache)return this._node.getTableRowShellHeightByTD(e);if(this._currentRowShellCache.has(e))return this._currentRowShellCache.get(e);const t=this._node.getTableRowShellHeightByTD(e);return this._currentRowShellCache.set(e,t),t}_createTableSlice({startId:e,endId:t,table:i,tableEntries:n}){this._debug._&&console.group(`[CREATE Table Slice] range: [${e}, ${t})`),this.strictAssert(Number.isInteger(e)&&(Number.isInteger(t)||t===1/0),`[createTableSlice] invalid bounds: startId=${e}, endId=${t}`);const o=n&&n.rows?n.rows.length:0;this.strictAssert(o>=0,`createTableSlice: invalid rows length: ${o}`),this.strictAssert(e>0&&t>0&&e<t,`[createTableSlice] out-of-range slice [${e}, ${t}) for rowsLen=${o}`);const r=n.rows.slice(e,t),s=this._node.createSliceWrapper(i),l=this._node.createTable({wrapper:s,colgroup:this._DOM.cloneNode(n.colgroup),caption:this._DOM.cloneNode(n.caption),thead:this._DOM.cloneNode(n.thead),tfoot:t===1/0?this._DOM.cloneNode(n.tfoot):null,tbody:r});return this.logGroupEnd("[CREATE Table Slice]"),l}_createTableSlices({splitPoints:e,table:t,tableEntries:i}){return e.map(((e,n,o)=>this._createTableSlice({startId:e,endId:n===o.length-1?1/0:o[n+1],table:t,tableEntries:i})))}_extendTableSlices(e){return e.reduce(((e,t,i,n)=>{const o=0===i,r=i===n.length-1;return o&&e.push(this._createBottomSignpost()),e.push(this._node.createForcedPageBreak()),e.push(this._createTopSignpost()),e.push(t),!r&&e.push(this._createBottomSignpost()),e}),[])}_createTopSignpost(){return this._node.createSignpost("(table continued)",this._signpostHeight)}_createBottomSignpost(){return this._node.createSignpost("(table continues on the next page)",this._signpostHeight)}_replaceRowInDOM(e,t){this._debug._&&this._DOM.setAttribute(e,".üö´_must_be_removed"),this._DOM.insertInsteadOf(e,...t)}_createAndInsertTableSlice({startId:e,endId:t,table:i,tableEntries:n}){const o=this._normalizeSliceAdapterPayload(function(e,{startId:t,endId:i,table:n,tableEntries:o}){e.strictAssert(Number.isInteger(t)&&Number.isInteger(i),`createAndInsertTableSlice: non-integer bounds: startId=${t}, endId=${i}`);const r=o&&o.rows?o.rows.length:0;e.strictAssert(r>=0,`createAndInsertTableSlice: invalid rows length: ${r}`),e.strictAssert(t>=0&&i>=0&&t<i&&i<=r,`createAndInsertTableSlice: out-of-range slice [${t}, ${i}) for rowsLen=${r}`);const s=o.rows.slice(t,i),l=e._node.createTable({wrapper:e._DOM.cloneNodeWrapper(n),colgroup:e._DOM.cloneNode(o.colgroup),caption:e._DOM.cloneNode(o.caption),thead:e._DOM.cloneNode(o.thead),tbody:s}),a=[];let h=null;if(t){const t=e._node.createForcedPageBreak();a.push(t),h=Ji(e),h&&(e._node.setFlagNoBreak(h),a.push(h)),e._node.markTopCut(l)}e._node.markBottomCut(l),e._node.setFlagNoBreak(l),a.push(l);const c=function(e){return e._node.createSignpost("(table continues on the next page)",e._signpostHeight)}(e);return c&&(e._node.setFlagNoBreak(c),a.push(c)),e._DOM.insertBefore(n,...a),{nodes:a,mainPart:l,signposts:{top:h,bottom:c}}}(this,{startId:e,endId:t,table:i,tableEntries:n}),{startId:e,endId:t,type:"slice"}),r=o.nodes,s=Array.isArray(this._currentTableDistributedRows)?this._currentTableDistributedRows.slice(e,t).map(((t,i)=>({rowIndex:e+i,row:t,cells:Array.from(this._DOM.getChildren(t)||[])}))):[];if(r.length){const i={...o.meta||{},signpostTop:o.signposts?.top??null,signpostBottom:o.signposts?.bottom??null};this._recordTablePart(o.mainPart,{startId:e,endId:t,type:"slice",rows:s,meta:i})}return r}_createAndInsertTableFinalSlice({table:e,startId:t=0}){const i=Array.isArray(this._currentTableDistributedRows)?this._currentTableDistributedRows.length:0,n=this._normalizeSliceAdapterPayload(function(e,{table:t}){e._node.markTopCut(t),e._node.setFlagNoBreak(t);const i=[],n=e._node.createForcedPageBreak();i.push(n);const o=Ji(e);return o&&(e._node.setFlagNoBreak(o),i.push(o)),e._DOM.insertBefore(t,...i),i.push(t),{nodes:i,mainPart:t,signposts:{top:o,bottom:null}}}(this,{table:e}),{startId:t,endId:i,type:"final"}),o=n.mainPart,r=Array.isArray(this._currentTableDistributedRows)?this._currentTableDistributedRows.slice(t).map(((e,i)=>({rowIndex:t+i,row:e,cells:Array.from(this._DOM.getChildren(e)||[])}))):[],s={...n.meta||{},signpostTop:n.signposts?.top??null,signpostBottom:n.signposts?.bottom??null};return this._recordTablePart(o,{startId:t,endId:i,type:"final",rows:r,meta:s}),n.nodes}_normalizeSliceAdapterPayload(e,{startId:t=null,endId:i=null,type:n="slice"}={}){const o=`[table.slice:${n}] rows [${t??"null"}:${i??"null"}]`;this.strictAssert(e,`${o} builder returned no result`);const r=e=>e&&"object"==typeof e&&1===e.nodeType;let s=null;Array.isArray(e)?s={nodes:e}:r(e)?s={nodes:[e],mainPart:e}:"object"==typeof e?s=e:this.strictAssert(!1,`${o} unsupported builder payload: ${e}`);let l=Array.isArray(s.nodes)?[...s.nodes]:[];!l.length&&r(s.mainPart)&&(l=[s.mainPart]),this.strictAssert(l.length>0,`${o} builder produced empty nodes array`);const a=[];l.forEach(((e,t)=>{e?a.push(e):console.warn(`${o} dropped empty node at index ${t}`)})),this.strictAssert(a.length>0,`${o} builder produced only empty nodes`);const h=s.mainPart??a[0];return this.strictAssert(r(h),`${o} missing main part element`),{nodes:a,mainPart:h,signposts:{top:s.signposts?.top??null,bottom:s.signposts?.bottom??null},meta:s.meta}}_recordTablePart(e,t={}){const i=this._currentTableRecordedParts;if(!i||!e)return null;const{startId:n=null,endId:o=null,type:r="unknown",rows:s=[],meta:l}=t||{};return Qi({entries:i,part:e,startIndex:n,endIndex:o,type:r,rows:s,meta:l})}}class tn{constructor({config:e,DOM:t,node:i,selector:n}){this._debug=e.debugMode?{...e.debugConfig.tableLike}:{},this._DOM=t,this._selector=n,this._node=i,this._minLeftLines=2,this._minDanglingLines=2,this._minBreakableLines=this._minLeftLines+this._minDanglingLines,this._minLeftRows=1,this._minDanglingRows=1,this._minBreakableRows=1,this._minPreFirstBlockLines=3,this._minPreLastBlockLines=3,this._minPreBreakableLines=this._minPreFirstBlockLines+this._minPreLastBlockLines,this._minBreakableGridRows=4,this._imageReductionRatio=.8,this._signpostHeight=parseFloat(e.splitLabelHeight)||0}split(e,t,i,n,o){const r=o||this._DOM.getComputedStyle(e);this._debug._&&console.log("root",n);const s=this._node.getPreparedChildren(e),l=this._node.getTop(e,n),a=this._node.getEmptyNodeHeightByProbe(e),h=i-a;let c=s,g=0,d=[],p=t-l-a;const u=r.position;"relative"!=u&&this._DOM.setStyles(e,{position:"relative"});for(let t=0;t<c.length;t++){const i=c[t];this._node.getBottom(i,e)>p&&(t&&d.push(t),t&&(g+=1),p=t?this._node.getTop(i,e)+h:h)}if(this._DOM.setStyles(e,{position:u}),!d.length)return this._debug._&&console.log("splitters.length",d.length),[];d.push(null);const _=d.map(((t,i,n)=>{const o=this._node.createSliceWrapper(e),r=n[i-1]||0,s=t||n[n.length];return this._DOM.insertAtEnd(o,...c.slice(r,s)),o}));return this._node.markSliceCuts(_),this._DOM.replaceNodeContentsWith(e,..._),this._DOM.removeAllClasses(e),this._DOM.removeAllStyles(e),this._DOM.setStyles(e,{display:"contents"}),this._DOM.setAttribute(e,"[slough-node]",""),_}}class nn{constructor({config:e,DOM:t,node:n,selector:o}){this._debug=e.debugMode?{...e.debugConfig.grid}:{},this._assert=!!e.consoleAssert,Object.assign(this,i),this._DOM=t,this._selector=o,this._node=n,this._resetCurrent(),this._minBreakableGridRows=1,this._minGridRowContentLines=2,this._gridCellLineHeightCache=new WeakMap,this._gridComputedStyleCache=new WeakMap,this._signpostHeight=parseFloat(e.splitLabelHeight)||0}split(e,t,i,n,o){this._resetCurrent(),this._debug._&&console.group("%c split Grid Node","background:#00FFFF",e);const r=this._node.getPreparedChildren(e);this._node.lockNodesWidths(r);const s=o||this._getComputedStyleCached(e);if(!r.length)return this._node.setInitStyle(!1,e,s),this._debug._&&console.groupEnd(),[];this._node.setInitStyle(!0,e,s);const l=this._scanGridLayout(e,s);if(!l.safe)return this._debug._&&console.warn("[grid.split] skip unsafe layout",l),this._debug._&&console.warn("[grid.split] Unsupported grid layout detected; keeping original grid intact.",l),this._node.setInitStyle(!1,e,s),this._debug._&&console.groupEnd(),[];const a=[];let h=!1,c=!1;const g=new Set;let d=null,p=null,u=null;r.forEach((t=>{const i=this._getComputedStyleCached(t),n=parseInt(i.gridRowStart,10),o=Number.isFinite(n),r=this._node.getTop(t,e),s=this._node.getBottom(t,e);let l=!1;l=!a.length||(o&&null!=d?n!==d:null!=u?r>=u-.5:null==p||Math.abs(r-p)>.5),l?(a.push([t]),d=o?n:null,p=r,u=s):(a[a.length-1].push(t),o&&null==d&&(d=n),(null==p||r<p)&&(p=r),(null==u||s>u)&&(u=s));const _=i.gridRowEnd||"",f=i.gridColumnEnd||"";h=h||_.includes("span"),c=c||f.includes("span"),o&&g.add(n)}));const _=g.size>0&&Math.max(...g)>a.length;if(_)return this._debug._&&console.warn("[grid.split]","Unsupported implicit row gap detected; keeping grid unsplit.",{hasImplicitRowGaps:_}),this._node.setInitStyle(!1,e,s),this._debug._&&console.groupEnd(),[];if(h||c)return this._debug._&&console.warn("[grid.split]","Grid contains row/column spans; using fallback (move row to next page).",{hasRowSpan:h,hasColumnSpan:c}),this._debug._&&console.groupEnd(),this._fallbackMoveGridToNextPage({gridNode:e,nodeComputedStyle:s});this.log("grid.split","currentRows:",a);const f=this._node.getTop(e,n),m=this._node.getEmptyNodeHeightByProbe(e),b=t-f-m,w=i-m;if(this.log("grid.split",{firstPartHeight:b,fullPagePartHeight:w}),this._currentGridNode=e,this._currentGridRows=a,this._currentGridFullPartHeight=w,this._currentGridSplitLog=[],this._currentGridEntries=Xi({owner:e,currentRows:a}),this._currentGridRecordedParts=this._currentGridEntries,this._currentGridNode.__html2pdfRecordedParts=this._currentGridRecordedParts,this._currentGridShellCache=new WeakMap,a.length<this._minBreakableGridRows&&this._DOM.getElementOffsetHeight(e)<i)return this._node.setInitStyle(!1,e,s),this._resetCurrent(),this.logGroupEnd("%c END [grid.split]: DON'T SPLIT, it isn't breakable and fits in the page"),[];const S=[],M=this._currentGridEntries,P=function({label:e="loop",limit:t,assert:i=!1}={}){const n=Number.isFinite(t)&&t>0?Math.floor(t):1;let o=0;return()=>{if(o+=1,o<=n)return;const t={label:e,iterations:o,limit:n};throw i&&console.assert(!1,`\n\n ‚õî [${e}] ‚ôæÔ∏è loop guard triggered`,t),new Error(`\n ‚õî [${e}] ‚ôæÔ∏è loop guard triggered`)}}({label:"grid.split",limit:Math.max(1,6*(a.length||1)),assert:this._assert});this._updateCurrentGridSplitBottom(b,"start with initial window");for(let t=0;t<a.length;t+=1){P();const i=this._buildGridRowEvaluation({rows:a,rowIndex:t,gridNode:e,splitBottom:this._currentGridSplitBottom});if(!i?.row){this._debug._&&console.warn("[grid.split] Missing row during evaluation; keeping grid unsplit at this row.",{rowIndex:t});continue}if(i.rowBottom<=this._currentGridSplitBottom){this.log("grid.split","Row fits current window",{rowIndex:t,splitBottom:this._currentGridSplitBottom});continue}const n=this._resolveGridOverflowingRow({evaluation:i,splitStartRowIndexes:S});n<t&&(t=Math.max(n,-1))}const C=S.length?S.at(-1):0,y=[...S.map(((t,i,n)=>this._buildGridSplit({startId:n[i-1]||0,endId:t,node:e,entries:M}))).filter(Boolean).map((e=>e.part)),this._createAndInsertGridFinalSlice({node:e,entries:M,startId:C})];return this.log("grid.split",{splitStartRowIndexes:S,splits:y,recordedParts:this._currentGridRecordedParts?.parts}),this._node.setInitStyle(!1,e,s),this._resetCurrent(),this.logGroupEnd("split Grid Node"),y}_fallbackMoveGridToNextPage({gridNode:e,nodeComputedStyle:t}){return this._node.setInitStyle(!1,e,t),this._resetCurrent(),[]}_resetCurrent(){this._currentGridNode=void 0,this._currentGridRows=void 0,this._currentGridEntries=void 0,this._currentGridRecordedParts=void 0,this._currentGridSplitBottom=void 0,this._currentGridFullPartHeight=void 0,this._currentGridSplitLog=void 0,this._currentGridRowFlags=void 0,this._currentGridShellCache=void 0,this._gridCellLineHeightCache=new WeakMap,this._gridComputedStyleCache=new WeakMap}_getGridSplittableHandlers({evaluation:e,splitStartRowIndexes:t}){return{getRowSliceAdapter:({row:t})=>this._createGridRowSliceAdapter({row:t,rowIndex:e.rowIndex}),onReplaceRow:({newRows:t})=>{this._removeOriginalGridRowCells(e.row),this._node.paginationRefreshRowsAfterSplit(this._getSplitterAdapter(),{rowIndex:e.rowIndex,rowSlices:t})},onAbsorbTail:()=>{},onRefreshRows:({newRows:t})=>{this._node.paginationRefreshRowsAfterSplit(this._getSplitterAdapter(),{rowIndex:e.rowIndex,rowSlices:t})},onPlacement:({evaluation:e,newRows:i,insufficientRemainingWindow:n,isFirstPartEmptyInAnyTD:o,needsScalingInFullPage:r})=>this._node.paginationHandleRowSlicesPlacement({evaluation:e,table:this._currentGridNode,newRows:i,insufficientRemainingWindow:n,isFirstPartEmptyInAnyTD:o,needsScalingInFullPage:r,splitStartRowIndexes:t,pageBottom:this._currentGridSplitBottom,fullPageHeight:this._currentGridFullPartHeight,debug:this._debug,registerPageStartCallback:({targetIndex:e,reason:i})=>this._registerPageStartAt(e,t,i),scaleProblematicSliceCallback:(e,t)=>this._scaleGridCellsToHeight(e,t),applyFullPageScalingCallback:({row:e,needsScalingInFullPage:t,fullPageHeight:i})=>{this._node.paginationApplyFullPageScaling({needsScalingInFullPage:t&&Boolean(e),payload:{cells:e,targetHeight:i},scaleCallback:({cells:e,targetHeight:t})=>this._scaleGridCellsToHeight(e,t)})}}),onSplitFailure:({evaluation:e,splitStartRowIndexes:t,availableRowHeight:i,fullPageHeight:n})=>this._forwardGridOverflowFallback({evaluation:e,splitStartRowIndexes:t,availableRowHeight:i,fullPageHeight:n,branch:"splitFailure"})}}_forwardGridOverflowFallback({evaluation:e,splitStartRowIndexes:t,availableRowHeight:i,fullPageHeight:n=this._currentGridFullPartHeight,branch:o,reasonTail:r,reasonFull:s}){const l=this._composeGridOverflowHelpers(),a={ownerLabel:`grid:${o}`,gridNode:this._currentGridNode,evaluation:e,rowIndex:e.rowIndex,row:e.row,availableRowHeight:i,fullPageHeight:n,splitStartRowIndexes:t,reasonTail:r||("splitFailure"===o?"Grid split failed ‚Äî move row to next page":"Grid slice overflow ‚Äî move row to next page"),reasonFull:s||("splitFailure"===o?"Grid split failed ‚Äî scaled cells to full page":"Grid slice overflow ‚Äî scaled cells to full page"),registerPageStartCallback:l.registerPageStartCallback,scaleProblematicCellsCallback:l.scaleProblematicCellsCallback,debugLogger:l.debugLogger};return this._debug._&&console.log("[grid.overflow]",o,a),"splitFailure"===o?this._node.handleRowSplitFailure(a):this._node.handleRowOverflow(a)}_buildGridRowEvaluation({rows:e,rowIndex:t,gridNode:i,splitBottom:n}){if(!Array.isArray(e))return null;const o=e[t];if(!o)return null;const r=Array.isArray(o)?new Array(o.length):null,s=this._getRowTop(o,i,r),l=this._getRowBottom(o,i,r),a=e[t+1],h=a?this._getRowTop(a,i):l,c=h-n;return{rowIndex:t,row:o,rowTop:s,rowBottom:l,nextMarker:h,delta:c,tailWindowHeight:n-s,isLastRow:!a,fitsCurrentWindow:c<=0,cellStyles:r}}_composeGridOverflowHelpers(){const e=this._registerPageStartAt.bind(this);this._scaleGridCellsToHeight.bind(this);return{registerPageStartCallback:e,scaleProblematicCellsCallback:(e,t)=>!!Array.isArray(e)&&this._scaleGridCellsToHeight(e,t),debugLogger:this._debug&&this._debug._?(e,t)=>console.log(e,t):void 0}}_resolveGridOverflowingRow({evaluation:e,splitStartRowIndexes:t}){return this._node.paginationResolveOverflowingRow({evaluation:e,utils:{rowHasSpan:()=>!1,isSlice:e=>this._isGridRowSlice(e)},handlers:{handleRowWithRowspan:()=>(this._debug._&&console.warn("[grid.split] ROWSPAN guard triggered unexpectedly.",{evaluation:e}),this._registerPageStartAt(e.rowIndex,t,"Grid ROWSPAN fallback ‚Äî move row to next page"),e.rowIndex-1),handleSplittableRow:()=>this._resolveGridSplittableRow({evaluation:e,splitStartRowIndexes:t}),handleAlreadySlicedRow:()=>this._forwardGridOverflowFallback({evaluation:e,splitStartRowIndexes:t,branch:"alreadySliced"})}})}_resolveGridSplittableRow({evaluation:e,splitStartRowIndexes:t}){const{rowIndex:i}=e;this._debug._&&console.group("%c[grid.split] Stage5 ‚Äî splittable row","color:#0080ff",{rowIndex:i,row:e.row,tailWindowHeight:e.tailWindowHeight});const n=this._estimateGridRowMeaningfulSpace({row:e.row,cellStyles:e.cellStyles,minContentLines:this._minGridRowContentLines});if(!(n>0))return console.warn("[grid.metrics] Meaningful row space is unavailable; falling back to overflow handler."),this._forwardGridOverflowFallback({evaluation:e,splitStartRowIndexes:t,availableRowHeight:e.tailWindowHeight,fullPageHeight:this._currentGridFullPartHeight,branch:"metricsMissing",reasonTail:"Grid row metrics missing ‚Äî move row to next page",reasonFull:"Grid row metrics missing ‚Äî scaled cells to full page"});const o=this._node.paginationCalculateRowSplitBudget({tailWindowHeight:e.tailWindowHeight,minMeaningfulRowSpace:n,fullPartHeight:this._currentGridFullPartHeight,debug:this._debug}),r=this._node.paginationSplitRow({rowIndex:i,row:e.row,firstPartHeight:o.firstPartHeight,fullPageHeight:this._currentGridFullPartHeight,debug:this._debug,decorateRowSlice:({rowWrapper:e,rowIndex:t,sliceIndex:i})=>{e instanceof HTMLElement&&this._DOM.setAttribute(e,`.grid_row_${t}_part_${i}`)},rowAdapter:this._createGridRowSliceAdapter({row:e.row,rowIndex:i,cellStyles:e.cellStyles})}),s=this._node.paginationProcessRowSplitResult({evaluation:e,splitResult:r,splitStartRowIndexes:t,insufficientRemainingWindow:o.insufficientRemainingWindow,extraCapacity:0,fullPageHeight:this._currentGridFullPartHeight,debug:this._debug,handlers:this._getGridSplittableHandlers({evaluation:e,splitStartRowIndexes:t})});return this.logGroupEnd("[grid.split] Stage5 ‚Äî splittable row"),s}_createGridRowSliceAdapter({row:e,rowIndex:t,cellStyles:i}){if(!Array.isArray(e))return null;const n=this._currentGridNode,o=e[0]||null,r=this;return{getParentContainer:()=>n,getOriginalCells:()=>[...e],getShellHeights:()=>r._getGridShellHeights(e,i),markOriginalRow:({cells:e})=>{e.forEach((e=>r._node.setFlagSlice(e)))},beginRow:()=>({fragment:r._DOM.createDocumentFragment(),cells:[]}),cloneCellFallback:e=>r._DOM.cloneNodeWrapper(e),handleCell:({context:e,cellClone:t})=>{r._node.setFlagSlice(t),e.fragment.append(t),e.cells.push(t)},finalizeRow:({context:e})=>(o&&r._DOM.insertBefore(o,e.fragment),e.cells)}}_removeOriginalGridRowCells(e){Array.isArray(e)&&e.forEach((e=>{e instanceof HTMLElement&&this._DOM.removeNode(e)}))}_isGridRowSlice(e){if(Array.isArray(e)){const t=e.find((e=>e instanceof HTMLElement));return!!t&&this._node.isSlice(t)}return!!e&&this._node.isSlice(e)}_getPaginatorAdapter(){return{label:"grid",getSplitBottom:()=>this._currentGridSplitBottom,setSplitBottom:e=>{this._currentGridSplitBottom=e},computeSplitBottomForElement:e=>e&&this._currentGridNode?this._node.getTop(e,this._currentGridNode)+(this._currentGridFullPartHeight||0):this._currentGridSplitBottom||0,getRows:()=>Array.isArray(this._currentGridRows)?this._currentGridRows.map((e=>{if(!e)return null;if(e instanceof HTMLElement)return e;if(Array.isArray(e)){const t=e.find((e=>e instanceof HTMLElement));if(t)return t;const i=this._getRowTop(e,this._currentGridNode);return Number.isFinite(i)?i:null}const t=this._getRowTop(e,this._currentGridNode);return Number.isFinite(t)?t:null})):[],shouldAssert:()=>this._assert,getDebug:()=>this._debug,getSplitBottomLog:()=>this._currentGridSplitLog}}_getSplitterAdapter(){return{label:"grid",rows:{getCurrentRows:()=>this._currentGridRows||[],replaceRow:({rowIndex:e,rowSlices:t})=>{Array.isArray(this._currentGridRows)&&this._node.replaceCurrentRowsAfterRowSplit({currentRows:this._currentGridRows,index:e,rowSlices:t})},syncEntries:()=>{this._currentGridEntries&&(this._currentGridEntries.currentRows=this._currentGridRows),this._currentGridRecordedParts&&(this._currentGridRecordedParts.currentRows=this._currentGridRows)},getGuardConfig:()=>({rows:this._currentGridRows||[],DOM:this._DOM})},guards:{onFlags:({flags:e})=>{this._currentGridRowFlags=e}}}}_updateCurrentGridSplitBottom(e,t="unknown case"){Yi(this._getPaginatorAdapter(),e,t)}_registerPageStartAt(e,t,i="register page start"){Zi(this._getPaginatorAdapter(),e,t,i)}_scaleGridCellsToHeight(e,t){if(!(Array.isArray(e)&&e.length&&t>0))return!1;const i=this._getGridShellHeights(e),n=this._debug._?e.map((e=>this._DOM.getElementOffsetHeight(e))):null,o=this._node.paginationScaleCellsToHeight({cells:e,targetHeight:t,shells:i});if(this._debug._){const r=e.map((e=>this._DOM.getElementOffsetHeight(e)));console.log("[grid.scaleCells] target:",t,"shells:",i,"before:",n,"after:",r,"scaled:",o)}return o}_buildGridSplit({startId:e,endId:t,node:i,entries:n}){const o=n?.currentRows||this._currentGridRows||[];if(e===t)return this._debug._&&console.warn("[grid.split] _buildGridSplit: skip empty slice request",e,t),this.strictAssert(!1,"[grid.split] _buildGridSplit: empty slice encountered"),null;if(this._debug._){const i=o.slice(e,t);console.log(`=> [grid.split] _buildGridSplit: slice rows [${e}, ${t})`,i)}const r=this._createAndInsertGridSlice({startId:e,endId:t,node:i,entries:n}),s=this._collectGridTelemetryRows(o,e,t);return this._recordGridPart(r,{startId:e,endId:t,type:"slice",rows:s}),{part:r,telemetryRows:s}}_createAndInsertGridSlice({startId:e,endId:t,node:i,entries:n}){return function(e,{startId:t,endId:i,node:n,entries:o,fallbackCurrentRows:r}){const s=e._DOM.cloneNodeWrapper(n);e._node.copyNodeWidth(s,n),e._node.setFlagNoBreak(s),t&&e._node.markTopCut(s),e._node.markBottomCut(s),n.before(s);const l=o?.currentRows||r||[],a=e&&e._DOM&&"function"==typeof e._DOM.isElementNode?e._DOM.isElementNode.bind(e._DOM):null,h=l.slice(t,i).flat().map((e=>{if(!e)return null;if(a&&a(e))return e;if("undefined"!=typeof HTMLElement&&e instanceof HTMLElement)return e;const t=e.element;if(t){if(a&&a(t))return t;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return t}return null})).filter(Boolean);return e._DOM.insertAtEnd(s,...h),s}(this,{startId:e,endId:t,node:i,entries:n})}_createAndInsertGridFinalSlice({node:e,entries:t,startId:i}){const n=function(e,{node:t,entries:i}){return e._node.markTopCut(t),e._node.setFlagNoBreak(t),t}(this,{node:e,entries:t}),o=t?.currentRows||this._currentGridRows||[],r=this._collectGridTelemetryRows(o,i);return this._recordGridPart(n,{startId:i,endId:o.length,type:"final",rows:r}),n}_collectGridTelemetryRows(e,t,i){if(!Array.isArray(e))return[];return e.slice(t,"number"==typeof i?i:void 0).map(((e,i)=>{const n=Array.isArray(e)?[...e]:[e];return{rowIndex:t+i,row:e,cells:n}}))}_recordGridPart(e,t={}){const i=this._currentGridRecordedParts;if(!i||!e)return null;const{startId:n=null,endId:o=null,type:r="unknown",rows:s=[],meta:l}=t||{};return Qi({entries:i,part:e,startIndex:n,endIndex:o,type:r,rows:s,meta:l})}_estimateGridRowMeaningfulSpace({row:e,cellStyles:t=null,minContentLines:i=this._minGridRowContentLines}){if(!Array.isArray(e)||0===e.length)return console.warn("[grid.metrics] Row payload missing while estimating split budget."),null;const n=this._getGridShellHeights(e,t),o=Array.isArray(t)?t:null,r=Math.max(1,i);let s=0;return e.forEach(((e,t)=>{if(!(e instanceof HTMLElement))return void console.warn("[grid.metrics] Unexpected non-element cell in row; ignoring during split budget calculation.",{cell:e,index:t});let i=o?o[t]:null;i||(i=this._getComputedStyleCached(e),o&&(o[t]=i));const l=this._resolveGridCellLineHeight({cell:e,style:i}),a=(n?.[t]||0)+l*r;s=Math.max(s,a)})),s>0?s:(console.warn("[grid.metrics] Failed to measure meaningful row space."),null)}_resolveGridCellLineHeight({cell:e,style:t}){const i=this._gridCellLineHeightCache,n=i?.get(e);if(n>0)return n;t||(console.warn("[grid.metrics] style not passed for _resolveGridCellLineHeight",{cell:e}),t=this._getComputedStyleCached(e));let o=parseFloat(t?.lineHeight);if(o>0)return i?.set(e,o),o;const r=parseFloat(t?.fontSize);if(Number.isFinite(r)&&r>0){const t=1.2*r;return i?.set(e,t),t}if(o=this._node.getLineHeight(e),o>0)return i?.set(e,o),o;return i?.set(e,16),16}_getGridShellHeights(e,t=null){if(this._currentGridShellCache||(this._currentGridShellCache=new WeakMap),this._currentGridShellCache.has(e))return this._currentGridShellCache.get(e);const i=Array.isArray(e)?e:[e].filter(Boolean),n=this._computeGridCellShellHeights(i,t);return this._currentGridShellCache.set(e,n),n}_getComputedStyleCached(e){if(!e)return console.warn("[grid.split] the element was not passed to _getComputedStyleCached"),null;const t=this._gridComputedStyleCache;if(!t)return this._DOM.getComputedStyle(e);const i=t.get(e);if(i)return i;const n=this._DOM.getComputedStyle(e);return t.set(e,n),n}_computeGridCellShellHeights(e,t=null){return Array.isArray(e)&&e.length?e.map(((e,i)=>{if(!e)return 0;let n=null;t?(n=t[i],n||(n=this._getComputedStyleCached(e),t[i]=n)):n=this._getComputedStyleCached(e);const o=parseFloat(n?.paddingTop)||0,r=parseFloat(n?.paddingBottom)||0,s=parseFloat(n?.borderTopWidth)||0,l=parseFloat(n?.borderBottomWidth)||0,a=parseFloat(n?.marginTop)||0,h=parseFloat(n?.marginBottom)||0,c=o+r+s+l,g=Math.max(0,a)+Math.max(0,h),d=this._DOM.getElementOffsetHeight(e)||0;let p=0;if("function"==typeof this._node.getContentHeightByProbe)try{const t=this._node.getContentHeightByProbe(e,n);Number.isFinite(t)&&t>=0&&(p=t)}catch(e){}p>0&&!(p>d)||(p=Math.max(0,d-c));let u=d-p;return Number.isFinite(u)||(u=c),u=Math.max(u,c),Math.max(0,u+g)})):[]}_getRowTop(e,t,i=null){if(Array.isArray(e)){let i=1/0;return e.forEach((e=>{const n=this._node.getTop(e,t);Number.isFinite(n)&&(i=Math.min(i,n))})),i===1/0?0:i}return e&&this._node.getTop(e,t)||0}_getRowBottom(e,t,i=null){if(Array.isArray(e)){let n=-1/0;return e.forEach(((e,o)=>{const r=this._node.getBottom(e,t);let s=null;i?(s=i[o],!s&&e&&(s=this._getComputedStyleCached(e),i[o]=s)):e&&(s=this._getComputedStyleCached(e));const l=r+(s&&parseFloat(s.marginBottom)||0);Number.isFinite(l)&&(n=Math.max(n,l))})),n===-1/0?0:n}if(e){const i=this._node.getBottom(e,t)||0,n=this._getComputedStyleCached(e);return i+(parseFloat(n?.marginBottom)||0)}return 0}_scanGridLayout(e,t){const i=t.gridAutoFlow||"";if(!i.startsWith("row"))return{safe:!1,reason:`grid-auto-flow=${i}`};if(i.includes("dense"))return{safe:!1,reason:"grid-auto-flow dense not supported yet"};if("none"!==(t.gridTemplateAreas||"none"))return{safe:!1,reason:"grid-template-areas present"};const n=t.gridTemplateColumns||"",o=t.gridTemplateRows||"",r=e=>e.includes("subgrid")||e.includes("auto-fit")||e.includes("auto-fill")||e.includes("fit-content");if(r(n)||r(o))return{safe:!1,reason:"complex track sizing (subgrid/auto-fit/fit-content)"};return/\[.*?\]/.test(n)||/\[.*?\]/.test(o)?{safe:!1,reason:"named grid lines detected"}:{safe:!0}}}const on="background:#999;color:#FFF;padding: 0 4px;";class rn{constructor({config:e,DOM:t,node:i,selector:n}){this._debug=e.debugMode?{...e.debugConfig.pre}:{},this._DOM=t,this._selector=n,this._node=i,this._minPreFirstBlockLines=3,this._minPreLastBlockLines=3,this._minPreBreakableLines=this._minPreFirstBlockLines+this._minPreLastBlockLines,this._imageReductionRatio=.8,this._signpostHeight=parseFloat(e.splitLabelHeight)||0}split(e,t,i,n,o){const r=o||this._DOM.getComputedStyle(e),s=["%c_splitPreNode\n","color:white"];this._debug._&&console.group("%c_splitPreNode","background:cyan"),this._debug._&&console.log(...s,"node",e,{pageBottom:t,fullPageHeight:i});const l=e=>isNaN(parseFloat(e))?0:Math.ceil(parseFloat(e)),a=(l(r.marginTop),l(r.marginBottom),l(r.paddingTop)),h=l(r.paddingBottom),c=l(r.borderTopWidth),g=l(r.borderBottomWidth),d=l(r.lineHeight),p=this._node.getTop(e,n),u=a+h+c+g;if(this._DOM.getElementOffsetHeight(e)<u+d*this._minPreBreakableLines)return this._debug._&&console.log("%c END _splitPreNode (small node)",on),[];const _=this._DOM.getChildNodes(e);if(this._debug._&&console.log("_children:",_.length,_),0==_.length)return this._debug._&&console.log("%c END _splitPreNode (not breakable)",on),[];if(_.length>1)return this._debug._&&console.log("%c END _splitPreNode TODO!",on),[];{if(this._DOM.isElementNode(_[0])){const e=_[0];return this._debug._&&console.warn("is Element Node",e),this._debug._&&console.log("%c END _splitPreNode ???????",on),[]}this._node.isWrappedTextNode(_[0])&&this._debug._&&console.warn(`is TEXT Node: ${_[0]}`);const n=_[0].wholeText,o=this._node.splitTextByLinesGreedy(n);if(o.length<this._minPreBreakableLines)return this._debug._&&console.log("%c END _splitPreNode few lines",on),[];const l=o.splice(0,this._minPreFirstBlockLines).join(""),a=o.splice(-this._minPreLastBlockLines).join("");o.unshift(l),o.push(a);const h=o.map((e=>{const t=this._node.createWithFlagNoBreak();return this._DOM.setInnerHTML(t,e),t}));this._debug._&&console.log("linesFromNode",h),this._DOM.replaceNodeContentsWith(e,...h);const d=0,f=d+c,m=d+g;let b=t-p-m-u;
//! For firstPartSpace we need all margins & preWrapperHeight.
//! For firstPartSpaceForSPlitting we only need selected amendments.
const w=i-u-f;this._debug._&&console.log({pageBottom:t,nodeTop:p,preWrapperHeight:u,topCutLineAmend:f,bottomCutLineAmend:m,fullPageHeight:i},{firstPartSpace:b,fullPageSpace:w});let S=0,M=[],P=b;const C=r.position;"relative"!=C&&this._DOM.setStyles(e,{position:"relative"});for(let t=0;t<h.length;t++){const i=h[t],n=this._node.getBottom(i,e);n>P&&(this._debug._&&console.log(`start a new page: currentBottom (${n}) > floater(${P})`,i),t&&M.push(t),t&&(S+=1),P=t?this._node.getTop(i,e)+w:w)}if(this._DOM.setStyles(e,{position:C}),!M.length)return this._debug._&&console.log("%c END _splitPreNode NO SPLIITERS",on),[];this._debug._&&console.log(...s,"splitters",M);const y=M.map(((t,i,n)=>{const o=this._node.createSliceWrapper(e),r=t,s=i===n.length-1?1/0:n[i+1],l=h.slice(r,s);return this._DOM.insertAtEnd(o,...l),o}));return this._node.markSliceCuts([e,...y]),this._debug._&&console.log(...s,"newPreElementsArray",y),this._DOM.insertAfter(e,...y),this._debug._&&console.log("%c END _splitPreNode",on),this._debug._&&console.groupEnd(),[e,...y]}}}class sn{constructor({config:e,DOM:t,selector:T}){this._config=e,this._DOM=t,this._selector=T,this._debug=e.debugMode?{...e.debugConfig.node}:{},this._assert=!!e.consoleAssert,this._markupDebugMode=this._config.markupDebugMode,Object.assign(this,i),Object.assign(this,n),Object.assign(this,o),Object.assign(this,r),Object.assign(this,s),Object.assign(this,l),Object.assign(this,a),Object.assign(this,h),Object.assign(this,c),Object.assign(this,g),Object.assign(this,d),Object.assign(this,p),Object.assign(this,u),Object.assign(this,_),Object.assign(this,f),Object.assign(this,m),Object.assign(this,b),Object.assign(this,w),Object.assign(this,S),Object.assign(this,M),Object.assign(this,P),Object.assign(this,C),Object.assign(this,y),Object.assign(this,O),this._paragraph=new qi({config:this._config,DOM:this._DOM,selector:this._selector,node:this}),this._pre=new rn({config:this._config,DOM:this._DOM,selector:this._selector,node:this}),this._table=new en({config:this._config,DOM:this._DOM,selector:this._selector,node:this}),this._grid=new nn({config:this._config,DOM:this._DOM,selector:this._selector,node:this}),this._tableLike=new tn({config:this._config,DOM:this._DOM,selector:this._selector,node:this})}clearTemplates(e){this._DOM.getAll("template",e).forEach((e=>this._DOM.removeNode(e)))}notSolved(e){this._DOM.getElementTagName(e);return!1}}function ln(e){return e?.length?e?.split(/\s+/).filter(Boolean):[]}const an="#66CC00",hn=`color: ${an};font-weight:bold`,cn=`border:1px solid ${an};background:#EEEEEE;color:${an};`,gn="background:#999;color:#FFF;padding: 0 4px;";class dn{constructor({config:e,DOM:t,node:n,selector:o,layout:r,referenceWidth:s,referenceHeight:l}){Object.assign(this,i),this._debug=e.debugMode?{...e.debugConfig.pages}:{},this._assert=!!e.consoleAssert,this._selector=o,this._node=n,this._noHangingSelectors=ln(e.noHangingSelectors),this._pageBreakBeforeSelectors=ln(e.pageBreakBeforeSelectors),this._pageBreakAfterSelectors=ln(e.pageBreakAfterSelectors),this._forcedPageBreakSelectors=ln(e.forcedPageBreakSelectors),this._noBreakSelectors=ln(e.noBreakSelectors),this._garbageSelectors=ln(e.garbageSelectors),this._DOM=t,this._root=r.root,this._contentFlow=r.contentFlow,this._referenceWidth=s,this._referenceHeight=l,this._minLeftLines=2,this._minDanglingLines=2,this._minBreakableLines=this._minLeftLines+this._minDanglingLines,this._minLeftRows=1,this._minDanglingRows=1,this._minBreakableRows=1,this._minPreFirstBlockLines=3,this._minPreLastBlockLines=3,this._minPreBreakableLines=this._minPreFirstBlockLines+this._minPreLastBlockLines,this._minBreakableGridRows=4,this._imageReductionRatio=.8,this._signpostHeight=parseFloat(e.splitLabelHeight)||0,this._commonLineHeight=this._node.getLineHeight(this._root),this._minimumBreakableHeight=this._commonLineHeight*this._minBreakableLines,this.pages=[]}calculate(){return this._removeGarbageElements(),this._prepareNoHangingElements(),this._prepareForcedPageBreakElements(),this._prepareNoBreakElements(),this._calculate(),this._debug._&&console.log("%c ‚úî Pages.calculate()",cn,this.pages),this.pages}_removeGarbageElements(){if(this._garbageSelectors.length){this._DOM.getAll(this._garbageSelectors,this._contentFlow).forEach((e=>{this._DOM.removeNode(e)}))}}_prepareNoHangingElements(){if(this._noHangingSelectors.length){this._DOM.getAll(this._noHangingSelectors,this._contentFlow).forEach((e=>{this._node.setFlagNoHanging(e);const t=this._node.findLastChildParent(e,this._contentFlow);t&&this._node.setFlagNoHanging(t,"parent")}))}}_prepareNoBreakElements(){if(this._noBreakSelectors.length){this._DOM.getAll(this._noBreakSelectors,this._contentFlow).forEach((e=>this._node.setFlagNoBreak(e)))}}_prepareForcedPageBreakElements(){const e=this._pageBreakBeforeSelectors.length?this._DOM.getAll(this._pageBreakBeforeSelectors,this._contentFlow):[],t=this._pageBreakAfterSelectors.length?this._DOM.getAll(this._pageBreakAfterSelectors,this._contentFlow):[],i=this._DOM.getAll(this._forcedPageBreakSelectors,this._contentFlow);if(e.length){const t=e[0],i=this._node.findFirstChildParent(t,this._contentFlow)||t;this._node.isAfterContentFlowStart(i)&&e.shift()}if(t.length){const e=t.at(-1),i=this._node.findLastChildParent(e,this._contentFlow)||e,n=this._DOM.getRightNeighbor(i);this._node.isContentFlowEnd(n)&&t.pop()}e.length&&e.forEach((e=>{const t=this._node.findBetterForcedPageStarter(e,this._contentFlow);t&&this._DOM.insertBefore(t,this._node.createForcedPageBreak())})),i&&i.forEach((e=>{if(!this._node.isForcedPageBreak(e)){const t=this._node.findBetterForcedPageStarter(e,this._contentFlow);t&&this._DOM.insertBefore(t,this._node.createForcedPageBreak())}})),t.length&&t.forEach((e=>{const t=this._node.findLastChildParent(e,this._contentFlow);t&&(e=t),this._node.isForcedPageBreak(e.nextElementSibling)||this._DOM.insertAfter(e,this._node.createForcedPageBreak())}))}_registerFirstPage(){this._registerPageStart({element:this._DOM.getElement(this._selector.contentFlowStart,this._contentFlow),context:"register First Page"})}_isContentFlowShort(){const e=this._DOM.getElement(this._selector.contentFlowEnd,this._contentFlow),t=this._node.getBottom(e,this._root),i=t<this._referenceHeight;return this._debug._&&i&&console.log(`contentFlow (${t}) fits on the page (${this._referenceHeight})`),i}_resolveForcedPBInsideContentFlow(){this._node.findAllForcedPageBreakInside(this._contentFlow).forEach((e=>this._registerPageStart({element:e,context:"All Forced Page Break Inside _contentFlow"})))}_calculate(){if(this._debug._&&console.groupCollapsed("‚Ä¢‚Ä¢ init data ‚Ä¢‚Ä¢"),this._debug._&&console.log("this._referenceHeight",this._referenceHeight,"\n","this._noHangingSelectors",this._noHangingSelectors,"\n","this._pageBreakBeforeSelectors",this._pageBreakBeforeSelectors,"\n","this._pageBreakAfterSelectors",this._pageBreakAfterSelectors,"\n","this._forcedPageBreakSelectors",this._forcedPageBreakSelectors,"\n","this._noBreakSelectors",this._noBreakSelectors),this._debug._&&console.groupEnd("‚Ä¢‚Ä¢ init data ‚Ä¢‚Ä¢"),this._registerFirstPage(),this._isContentFlowShort())return void this._resolveForcedPBInsideContentFlow();const e=this._node.getPreparedChildren(this._contentFlow);this._debug._&&console.groupCollapsed("%cüö∏ children(contentFlow)",cn),this._debug._&&console.log(e),this._debug._&&console.groupEnd("%cüö∏ children(contentFlow)",cn),this._parseNodes({array:e})}_registerPageStart({element:e,improveResult:t=!1,type:i="current",context:n=""}){if(this._debug._registerPageStart&&console.log("%cüìç","background:yellow;font-weight:bold","\n  improveResult:",t,"\n  passed pageStart:",e,"\n  context:",n),"next"===i&&this._node.isContentFlowEnd(e))return void(this._debug._parseNode&&console.log("üèÅ [registerAsPageStart] reaches the ContentFlowEnd element}. SKIP registering.",e));if(this._node.isPageStartElement(e))return void(this._debug._registerPageStart&&console.warn("üö® [_registerPageStart] pageStart candidate is already PageStartElement, return",e));let o=e;t&&(this._debug._registerPageStart&&console.log("[_registerPageStart] improve result:"),o=this._node.findBetterPageStart(o,this.pages.at(-1)?.pageStart,this._root)),this._DOM.getElementOffsetParent(o)||this._debug._registerPageStart&&console.warn("üö® pageStart has no offsetParent. Check the caller.",o);const r=this._node.getTopForPageStartCandidate(o,this._root),s=r+this._referenceHeight,l=this._DOM.getLeftNeighbor(o);this.pages.push({pageStart:o,pageBottom:s,pageTop:r,prevPageEnd:l}),this._node.markPageStartElement(o,this.pages.length),this._debug._registerPageStart&&console.log(`%cüìçregister page ${this.pages.length}`,"background:yellow;font-weight:bold","\n  improved result:",t,"\n  pageTop:",r,"\n  pageBottom:",s,"\n  pageStart:",o)}_parseNodes({previous:e,next:t,array:i,arrayTopParent:n,arrayBottomParent:o}){this._debug._parseNodes&&console.log("üîµ _parseNodes",{array:i,arrayTopParent:n,arrayBottomParent:o});for(let r=0;r<i.length;r++){const s=i[r],l=0===r,a=r===i.length-1,h=l?n:void 0,c=a&&o?o:void 0;this._parseNode({previousElement:i[r-1]||e,currentElement:s,nextElement:i[r+1]||t,isFirstChild:l,isLastChild:a,arrayTopParent:h,arrayBottomParent:c})}}_parseNode({isFirstChild:e,isLastChild:t,previousElement:i,currentElement:n,nextElement:o,arrayTopParent:r,arrayBottomParent:s}){const l=["%c[_parseNode]\n","color:white;"];if(this._debug._parseNode&&console.group("%c_parseNode",hn,""+(e&&t?"‚òÖ [first+last]":e?"‚òÖ [first]":t?"‚òÖ [last]":"<- regular ->"),"üìÑ",this.pages.length,{currentElement:n}),this._debug._parseNode&&console.log({previousElement:i,currentElement:n,nextElement:o,isFirstChild:e,isLastChild:t,arrayTopParent:r,arrayBottomParent:s}),!o)return this._node.markProcessed(n,"content-flow-end"),this._debug._parseNode&&console.log("%c END _parseNode (!nextElement)",gn),void(this._debug._parseNode&&console.groupEnd());const a=this._node.getBottom(n,this._root),h=s?this._node.getBottom(s,this._root):void 0;let c=h;const g=this._node.getTop(n,this._root);if(void 0!==h&&h-a>=this._referenceHeight){if(c=void 0,this._debug._parseNode&&console.log("ü™Å Tail: We got a tail from the lower shells of the last child. Giving up our ‚Äúlast child‚Äù rule here and will try to insert a page break at the end of some parent. ",{arrayParentBottomEdge:h,currentParentBottomEdge:c,currentElementBottom:a,pageBottom:this.pages.at(-1).pageBottom},{currentElement:n,arrayBottomParent:s}),a<=this.pages.at(-1).pageBottom){this._debug._parseNode&&console.log("ü™Å Tail: currentElementBottom <= this.pages.at(-1).pageBottom");const e=[];let t=n;for(this._debug._parseNode&&console.log("ü™Å Tail: currentElement",n);t&&t!==s;)e.push({element:t,bottom:this._node.getBottom(t,this._root)}),t=t.parentElement;if(t!==s)throw new Error('"bottom" parent not found in the ancestor chain');e.push({element:s,bottom:h}),this._debug._parseNode&&console.log("ü™Å Tail: _parents",e),this._debug._parseNode&&console.log("ü™Å Tail: current PageBottom",this.pages.at(-1).pageBottom);for(let t=0;t<e.length;t++)if(this._debug._parseNode&&console.log("ü™Å Tail: _parents[i].bottom",e[t].bottom,e[t].element),e[t].bottom>this.pages.at(-1).pageBottom){this._debug._parseNode&&console.log("ü™Å Tail: _parents[i].bottom > this.pages.at(-1).pageBottom",e[t].bottom,">",this.pages.at(-1).pageBottom,e[t].element);const i=this._node.createNeutral();if(i.classList.add("service"),this._DOM.insertAtEnd(e[t].element,i),this._registerPageStart({element:i,context:"_isTailLongerThanPage"}),this._debug._parseNode&&console.log("_registerPageStart",i),this._node.markProcessed(i,"node is ForcedPageBreak"),this._debug._parseNode&&console.log(this.pages.at(-1).pageBottom,h),!(h>this.pages.at(-1).pageBottom))return this._debug._parseNode&&console.log("%c END _parseNode (bottom Tail of parents)",gn),void(this._debug._parseNode&&console.groupEnd());this._debug._&&console.log("üßß ‚Ä¢ arrayParentBottomEdge > this.pages.at(-1).pageBottom")}return this._debug._parseNode&&console.log("%c END _parseNode (bottom Tail of parents)",gn),void(this._debug._parseNode&&console.groupEnd())}this._debug._parseNode&&console.log("ü™Å Tail: currentElementBottom > this.pages.at(-1).pageBottom","DOING NOTHING")}
//! currentParentBottomEdge is refreshed right before, so descendants see live parent boundaries.
const d=c??a;if(this._debug._parseNode&&console.log("[_parseNode]",{currentBlockBottom:d,currentParentBottomEdge:c,currentElementBottom:a}),this.pages.at(-1).pageStart===n&&(this._node.isNoBreak(n)||d<=this.pages.at(-1).pageBottom))return this._node.markProcessed(n,"node is already registered and fits in the page"),this._debug._parseNode&&console.log("%c END _parseNode (node is already registered and fits in the next page)",gn),void(this._debug._parseNode&&console.groupEnd());if(g>=this.pages.at(-1).pageBottom&&a-g){const t=e&&Boolean(r)?this._node.getTopForPageStartCandidate(r,this._root):void 0,i=Boolean(t)&&g-t>=this._referenceHeight;if(i)this._debug._parseNode&&console.log("ü™Å beginning Tail",{parentTop:t,currentParentBottomEdge:c,currentElementTop:g,pageBottom:this.pages.at(-1).pageBottom},{currentElement:n,arrayTopParent:r});else{const e=this._DOM.getComputedStyle(n)?.display||"";if(e.includes("inline")||"contents"===e)return this._debug._parseNode&&console.log("üßÖ current in thin wrapper"),this._registerPageStart({element:n,improveResult:!0,context:"üßÖ current in thin wrapper"}),this._debug._parseNode&&console.log("%c END _parseNode (registered new page start)",gn),void(this._debug._parseNode&&console.groupEnd())}this._registerPageStart({element:n,improveResult:!i,context:"currentElementTop >= this.pages.at(-1).pageBottom"})}if(this._node.isForcedPageBreak(n))return this._registerPageStart({element:n,context:"currentElement is ForcedPageBreak"}),this._node.markProcessed(n,"node is ForcedPageBreak"),this._debug._parseNode&&console.log("%c END _parseNode (isForcedPageBreak)",gn),void(this._debug._parseNode&&console.groupEnd());this.strictAssert(this._DOM.getElementOffsetParent(n),"it is expected that the element has an offset parent",n);const p=this._node.getTop(o,this._root);if(this._debug._parseNode&&console.log(...l,"‚Ä¢ pageBottom",this.pages.at(-1).pageBottom,"\n","‚Ä¢ nextElementTop",p),p<=this.pages.at(-1).pageBottom)return this._debug._parseNode&&console.log("nextElementTop <= this.pages.at(-1).pageBottom",p,"<=",this.pages.at(-1).pageBottom),this._node.markProcessed(n,"node fits"),this._node.findAllForcedPageBreakInside(n).forEach((e=>{this._node.markProcessed(e,"node is ForcedPageBreak (inside a node that fits)"),this._registerPageStart({element:e,context:"All Forced Page Break Inside currentElement"})})),this._debug._parseNode&&console.log("%c END _parseNode (node pass)",gn),void(this._debug._parseNode&&console.groupEnd());{if(this._debug._parseNode&&console.log("nextElementTop > this.pages.at(-1).pageBottom",p,">",this.pages.at(-1).pageBottom),d<=this.pages.at(-1).pageBottom)return this._debug._parseNode&&console.log("currentBlockBottom <= this.pages.at(-1).pageBottom",d,"<=",this.pages.at(-1).pageBottom,"\n register nextElement as pageStart"),this._node.isNoHanging(n)?(this._debug._parseNode&&console.log("currentElement fits / last, and _isNoHanging => move it to the next page"),this._node.markProcessed(n,"it fits & last & _isNoHanging => move it to the next page"),this._registerPageStart({element:n,improveResult:!0,context:"currentElement is NoHanging"}),this._debug._parseNode&&console.log("%c END _parseNode (isNoHanging)",gn),void(this._debug._parseNode&&console.groupEnd())):(this._registerPageStart({element:o,type:"next",context:"currentBlockBottom <= PgBtt && nextElementTop > PgBtt"}),this._node.markProcessed(n,"fits, its bottom falls exactly on the cut"),this._node.markProcessed(o,"starts new page, its top is exactly on the cut"),this._debug._parseNode&&console.log("%c END _parseNode (currentElement fits, register the next element)",gn),void(this._debug._parseNode&&console.groupEnd()));const t=this._node.resolveReplacedElement(n,{prefer:"first"});if(t){const i=this._node.isSVG(t),s=i?this._node.createSignpost(t):t,l=this._node.getTop(s,this._root),a=e&&r?this._node.getTop(r,this._root):void 0,g=r||this._DOM.getParentNode(s),d=this._node.estimateInlineImgGapBelow(g);let p=this.pages.at(-1).pageBottom-l-d;p-=h?h-this._node.getBottom(s,this._root):0;let u=this._referenceHeight-d-(void 0!==a?l-a:0);const _=this._DOM.getElementOffsetHeight(s),f=this._DOM.getElementOffsetWidth(s);if(this._debug._parseNode&&console.log("üñºÔ∏èüñºÔ∏èüñºÔ∏èüñºÔ∏èüñºÔ∏èüñºÔ∏è (if mediaElement)",t,{_imageParent:g,arrayTopParent:r,arrayParentBottomEdge:h,availableImageNodeSpace:p,currentParentBottomEdge:c,currentElement:n,currentImage:s,currentImageHeight:_,currentImageWidth:f,isSvgMedia:i,imgGapBelow:d,parentTopForImage:a}),f>this._referenceWidth&&this._debug._parseNode&&console.warn("%c IMAGE is too wide","color: red"),_<p)return this._node.markProcessed(n,"IMG that fits, and next starts on next"),this._registerPageStart({element:o,type:"next",context:"currentImageHeight < availableImageNodeSpace"}),this._debug._parseNode&&console.log("Register next elements; üñºÔ∏èüñºÔ∏èüñºÔ∏è IMG fits:",n),this._debug._parseNode&&console.log("%c END _parseNode üñºÔ∏è IMG fits",gn),void(this._debug._parseNode&&console.groupEnd());const m=p/_;if(m>this._imageReductionRatio)return this._debug._parseNode&&console.log("Register next elements; üñºÔ∏èüñºÔ∏èüñºÔ∏è IMG RESIZE to availableImageNodeSpace:",p,n),this._node.markProcessed(n,`IMG with ratio ${m}, and next starts on next`),this._node.fitElementWithinBoundaries({element:t,height:_,width:f,vspace:p,hspace:this._referenceWidth}),this._registerPageStart({element:o,type:"next",context:"current IMG was RESIZED to availableImageNodeSpace"}),this._debug._parseNode&&console.log("%c END _parseNode üñºÔ∏è IMG scaled",gn),void(this._debug._parseNode&&console.groupEnd());this._node.markProcessed(n,"IMG starts on next");const b=i?s:t;return this._registerPageStart({element:b,improveResult:!0,context:"move IMG it to next page"}),this._debug._parseNode&&console.log("üñºÔ∏è register Page Start",n),_>u&&(this._node.fitElementWithinBoundaries({element:t,height:_,width:f,vspace:u,hspace:this._referenceWidth}),this._node.markProcessed(n,"IMG starts on next and resized"),this._debug._parseNode&&console.log("üñºÔ∏è ..and fit it to full page",n)),this._debug._parseNode&&console.log("%c END",gn),void(this._debug._parseNode&&console.groupEnd())}if(n.style.height){this._debug._parseNode&&console.log("ü•Å currentElement has HEIGHT",n.style.height);const e=this.pages.at(-1).pageBottom-g,t=p-g,i=e/t,r=this._referenceHeight/t;return this._debug._parseNode&&console.log("\nü•Å currentElementTop",g,"\nü•Å pageBottom",this.pages.at(-1).pageBottom,"\nü•Å availableSpace",e,"\nü•Å currentElementContextualHeight",t,"\nü•Å availableSpaceFactor",i,"\nü•Å fullPageFactor",r),this.strictAssert(i<1),i>.8?(this._debug._parseNode&&console.log("ü•Å availableSpaceFactor > 0.8: ",i),this._DOM.setStyles(n,{transform:`scale(${i})`,"transform-origin":"top center"}),this._registerPageStart({element:o,type:"next",context:"IMMEDIATELY scale currentElement to the remaining space; availableSpaceFactor > 0.8; currentElement.style.height"}),this._node.markProcessed(n,"processed as a image, has been scaled down within 20%, the next one starts a new page"),this._node.markProcessed(o,"the previous one was scaled down within 20%, and this one starts a new page."),this._debug._parseNode&&console.log("%c END _parseNode (has height & scale)",gn),void(this._debug._parseNode&&console.groupEnd())):(r<1&&(this._debug._parseNode&&console.log("ü•Å fullPageFactor < 1: ",r),this._node.markProcessed(n,"processed as a image, has been scaled down, and starts new page"),this._DOM.setStyles(n,{transform:`scale(${r})`,"transform-origin":"top center"})),this._debug._parseNode&&console.log("ü•Å _registerPageStart",n),this._registerPageStart({element:n,improveResult:!0,context:'has height & processed "as a image", has been scaled down, and starts new page'}),this._node.markProcessed(n,"processed as a image, starts new page"),this._debug._parseNode&&console.log("%c END _parseNode (has height & put on next page)",gn),void(this._debug._parseNode&&console.groupEnd()))}if(this._debug._parseNode&&console.log("split or not? \n","currentBlockBottom",d),this._debug._parseNode&&console.log("currentParentBottomEdge || currentElementBottom",{currentParentBottomEdge:c,currentElementBottom:a},"currentBlockBottom > this.pages.at(-1).pageBottom",d,">",this.pages.at(-1).pageBottom),this._DOM.getElementOffsetHeight(n)<this._minimumBreakableHeight)return this._registerPageStart({element:n,improveResult:!0,context:"starts new page, #fewLines; nextElementTop > this.pages.at(-1).pageBottom"}),this._node.markProcessed(n,"starts new page, #fewLines"),this._debug._parseNode&&console.log("%c END _parseNode #fewLines",gn),void(this._debug._parseNode&&console.groupEnd());const u=this._node.getSplitChildren(n,this.pages.at(-1).pageBottom,this._referenceHeight,this._root);this._debug._parseNode&&console.log("try to break it and loop the children:",u);if(u.length){const e=r||n,t=s||n,l=this._node.isFullySPlitted(n)||this._node.isSlough(n);this._debug._parseNode&&console.log({isFullySPlittedParent:l,arrayTopParent:r}),this._parseNodes({array:u,previous:i,next:o,arrayTopParent:l?void 0:e,arrayBottomParent:l?void 0:t}),this._node.markProcessed(n,"getSplitChildren and _parseNodes")}else this._debug._parseNode&&console.log(...l,"_registerPageStart (from _parseNode): \n",n),this._registerPageStart({element:n,improveResult:!0,context:"does not fit, has no children, register it (or parents if improved)"}),this._node.markProcessed(n,"doesn't fit, has no children, register it or parents")}this._debug._parseNode&&console.log("%c END _parseNode [‚Ä¢‚Ä¢‚Ä¢]",gn,{currentElement:n}),this._debug._parseNode&&console.groupEnd()}}class pn{constructor({config:e,DOM:t,node:i,selector:n,layout:o}){this._debug=e.debugMode?{...e.debugConfig.paper}:{},this._DOM=t,this._selector=n,this._node=i,this._frontpageTemplate=o.frontpageTemplate,this._headerTemplate=o.headerTemplate,this._footerTemplate=o.footerTemplate,this._pageChromeSelector=n?.pageChrome||".pageChrome",this._pageBodySpacerSelector=n?.pageBodySpacer||".pageBodySpacer",this._pageHeaderSelector=n?.pageHeader||".pageHeader",this._pageFooterSelector=n?.pageFooter||".pageFooter",this._headerContentSelector=n?.headerContent||".headerContent",this._footerContentSelector=n?.footerContent||".footerContent",this._frontpageElementSelector=n?.frontpageElement||".frontpageElement",this._frontpageContentSelector=n?.frontpageContent||".frontpageContent",this._virtualPaperSelector=n?.virtualPaper||".virtualPaper",this._virtualPaperTopMarginSelector=n?.virtualPaperTopMargin||".virtualPaperTopMargin",this._virtualPaperBottomMarginSelector=n?.virtualPaperBottomMargin||".virtualPaperBottomMargin",this._pageNumberRootSelector=n?.pageNumberRoot||void 0,this._pageNumberCurrentSelector=n?.pageNumberCurrent||void 0,this._pageNumberTotalSelector=n?.pageNumberTotal||void 0,this._paperHeight,this._frontpageFactor,this.headerHeight,this.footerHeight,this.bodyHeight,this.bodyWidth,this._calculatePaperParams()}createPageChrome({pageNumber:e,pageCount:t}){const i=this._node.create(this._pageChromeSelector),n=this._composePageElements({pageNumber:e,pageCount:t});return this._DOM.insertAtEnd(i,n),i}_composePageElements({pageNumber:e,pageCount:t}){const i=this._DOM.createDocumentFragment(),n=this._createPageBodySpacer(this.bodyHeight),o=this._createPageHeader(this._headerTemplate),r=this._createPageFooter(this._footerTemplate);return this._DOM.insertAtEnd(i,this.createVirtualTopMargin(),o,n,r,this.createVirtualBottomMargin()),e&&t&&(this._setPageNumber(o,e,t),this._setPageNumber(r,e,t)),i}createFrontpage(){if(!this._frontpageTemplate)return void(this._debug&&console.warn("[paper ‚Ä¢ createFrontpage()] called without a template"));const e=this._node.create(this._frontpageElementSelector);this._DOM.setStyles(e,{height:this.bodyHeight+"px",display:"inline-block",width:"100%","vertical-align":"top"});const t=this._createFrontpageContent(this._frontpageTemplate,this._frontpageFactor);return this._DOM.setStyles(t,{display:"flow-root","transform-origin":"top center",height:"100%"}),this._DOM.insertAtStart(e,t),e}createVirtualTopMargin(){return this._node.create(this._virtualPaperTopMarginSelector)}createVirtualBottomMargin(){return this._node.create(this._virtualPaperBottomMarginSelector)}createVirtualPaper(e){const t=this._node.create(this._virtualPaperSelector);return e&&this._DOM.insertAtEnd(t,this.createVirtualTopMargin(),e,this.createVirtualBottomMargin()),t}_createFrontpageContent(e,t){const i=this._node.create(this._frontpageContentSelector);return e&&this._DOM.setInnerHTML(i,e),t&&this._DOM.setStyles(i,{transform:`scale(${t})`}),i}_createPageBodySpacer(e,t){const i=this._node.create(this._pageBodySpacerSelector);return this._DOM.setStyles(i,{height:e+"px"}),t&&this._DOM.insertAtEnd(i,t),i}_createPageHeader(e){const t=this._node.create(this._pageHeaderSelector);if(e){const i=this._node.create(this._headerContentSelector);this._DOM.setInnerHTML(i,e),this._DOM.insertAtEnd(t,i)}return t}_createPageFooter(e){const t=this._node.create(this._pageFooterSelector);if(e){const i=this._node.create(this._footerContentSelector);this._DOM.setInnerHTML(i,e),this._DOM.insertAtEnd(t,i)}return t}_setPageNumber(e,t,i){const n=this._pageNumberRootSelector?this._DOM.getElement(this._pageNumberRootSelector,e):this._pageNumberRootSelector;if(n){const e=this._DOM.getElement(this._pageNumberCurrentSelector,n),o=this._DOM.getElement(this._pageNumberTotalSelector,n);this._DOM.setInnerHTML(e,t),this._DOM.setInnerHTML(o,i)}}_calculatePaperParams(){const e=this._createPageBodySpacer(),t=this._createPageHeader(this._headerTemplate),i=this._createPageFooter(this._footerTemplate),n=this._node.create(this._virtualPaperSelector);this._DOM.insertAtEnd(n,this.createVirtualTopMargin(),t,e,i,this.createVirtualBottomMargin());const o=this._node.create("#workbench");this._DOM.setStyles(o,{position:"absolute",left:"-3000px"}),this._DOM.insertAtEnd(o,n),this._DOM.insertAtStart(this._DOM.body,o);const r=this._DOM.getElementBCR(n).height,s=this._DOM.getElementOffsetHeight(t)||0,l=this._DOM.getElementOffsetHeight(i)||0,a=this._DOM.getElementOffsetHeight(e),h=this._DOM.getElementOffsetWidth(e),c=this._createFrontpageContent(this._frontpageTemplate);this._DOM.insertAtStart(e,c);const g=this._DOM.getElementOffsetHeight(e),d=g>a?a/g:1;this._DOM.removeNode(o),s>.2*r&&console.warn("It seems that your custom header is too high"),l>.15*r&&console.warn("It seems that your custom footer is too high"),d<1&&console.warn("It seems that your frontpage content is too large. We made it smaller to fit on the page. Check out how it looks! It might make sense to fix this with styles or reduce the text amount."),this._paperHeight=r,this.headerHeight=s,this.footerHeight=l,this.bodyHeight=a,this.bodyWidth=h,this._frontpageFactor=d}}class un{constructor({config:e,DOM:t,selector:n,node:o,pages:r,layout:s,paper:l}){this._config=e,this._debug=e.debugMode?{...e.debugConfig.preview}:{},this._assert=!!e.consoleAssert,Object.assign(this,i),this._DOM=t,this._selector=n,this._node=o,this._virtualPaperGapSelector=n.virtualPaperGap,this._runningSafetySelector=n.runningSafety,this._printPageBreakSelector=n.printPageBreak,this._pageDivider=n.pageDivider,this._virtualPaper=n.virtualPaper,this._virtualPaperTopMargin=n.virtualPaperTopMargin,this._pageBodySpacer=n.pageBodySpacer,this._pages=r,this._root=s.root,this._contentFlow=s.contentFlow,this._paperFlow=s.paperFlow,this._overlayFlow=s.overlayFlow,this._paper=l,this._hasFrontPage=!!s.frontpageTemplate}create(){this._processFrontPage(),this._processPages(),(!0===this._config.mask||"true"===this._config.mask)&&this._addMask(),this._makeRootVisible()}_addMask(){const e=parseInt(this._config.virtualPagesGap),t=parseInt(this._config.paperHeight),i=parseInt(this._config.printTopMargin),n=parseInt(this._config.printBottomMargin),o=parseInt(this._config.headerMargin),r=parseInt(this._config.footerMargin),s=this._paper.headerHeight,l=this._paper.footerHeight,a=this._paper.bodyHeight,h=s?Math.ceil(o/2):0,c=l?Math.ceil(r/2):0,g=s-h,d=l-c,p=a+h+c,u=i+g,_=t+e;this.strictAssert(t===p+g+i+d+n,"Paper size calculation params do not match");const f=function({maskStep:e,maskWindow:t,maskFirstShift:i}){return`\n    -webkit-mask-image: linear-gradient(\n      black 0,\n      black ${t}px,\n      transparent ${t}px,\n      transparent ${e}px\n    );\n            mask-image: linear-gradient(\n              black 0,\n              black ${t}px,\n              transparent ${t}px,\n              transparent ${e}px\n            );\n    -webkit-mask-repeat: no-repeat;\n            mask-repeat: no-repeat;\n    -webkit-mask-size: 100% ${e}px;\n            mask-size: 100% ${e}px;\n    -webkit-mask-position: 100% ${i}px;\n            mask-position: 100% ${i}px;\n    -webkit-mask-repeat: repeat-y;\n            mask-repeat: repeat-y;\n    -webkit-mask-origin: border-box;\n            mask-origin: border-box;\n    `}({maskFirstShift:u,maskStep:_,maskWindow:p}),m=`\n    @media screen {\n      ${this._selector.contentFlow} {\n        ${f}\n      }\n    }\n    @media print {\n      ${this._selector.root}::after {\n        /* Safety placeholder for the bottom margin of the paper.\n          Remove if the margins at the bottom of the page are replaced with padding.\n          Placed under the footer.\n        */\n        --paper-color: ${this._config.paperColor};\n        background: var(--paper-color, white);\n        content: '';\n        position: fixed;\n        pointer-events: none;\n        z-index: 11;\n        inset: 0;\n        top: unset;\n        height: ${n+l}px;\n      }\n    }`;this._node.insertStyle(m,"mask")}_makeRootVisible(){this._DOM.setStyles(this._root,{visibility:"visible"})}_processFrontPage(){if(this._hasFrontPage){const e=this._paper.createFrontpage();this._DOM.insertAtStart(this._contentFlow,e),this._pages.unshift({pageStart:e})}}_processPages(){for(let e=0;e<this._pages.length;e++){const t=this._insertIntoPaperFlow(e),i=this._insertIntoOverlayFlow(e);this._insertIntoContentFlow(e,i,t)}}_insertIntoPaperFlow(e){const t=this._paper.createVirtualPaper(),i=e?this._createVirtualPaperGap():void 0;return this._insertPaper(this._paperFlow,t,i),i}_insertIntoOverlayFlow(e){const t=this._paper.createPageChrome({pageNumber:e+1,pageCount:this._pages.length}),i=e?this._createVirtualPaperGap():void 0;return this._insertPaper(this._overlayFlow,t,i),i}_insertIntoContentFlow(e,t,i){const n=this._pages[e].pageStart;this._preventPageOverflow(e);const o=!(!i||!t),r=this._createPageBreaker(e,o);this._DOM.insertBefore(n,r),o&&this._insertFooterSpacer({target:r,footerHeight:this._paper.footerHeight,pageSeparator:t,paperSeparator:i,pageIndex:e}),this._insertHeaderSpacer(r,this._paper.headerHeight),this._updatePageStartElementAttrValue(n,e)}_preventPageOverflow(e){const t=this._pages[e].pageStart,i=this._pages[e].prevPageEnd;i?(this._node.markPageEndElement(i,e),this._DOM.setStyles(i,{"margin-bottom":["0","important"]})):e>0&&this._debug._&&console.warn(`[preview] There is no page end element before ${e}. Perhaps it's a 'beginningTail'.`),t?this._DOM.setStyles(t,{"margin-top":["0","important"]}):this.strictAssert(0,"[preview] [_preventPageOverflow] current page First Element do not pass! page:",e)}_createPageBreaker(e,t){const i=this._node.create(this._pageDivider);return this._DOM.setAttribute(i,"[page]",`${e+1}`),t&&this._paper.footerHeight&&this._DOM.setStyles(i,{marginTop:this._paper.footerHeight+"px"}),this._paper.headerHeight&&this._DOM.setStyles(i,{paddingBottom:this._paper.headerHeight+"px"}),i}_updatePageStartElementAttrValue(e,t){this._hasFrontPage&&this._node.markPageStartElement(e,`${t+1}`)}_insertPaper(e,t,i){i?this._DOM.insertAtEnd(e,i,t):this._DOM.insertAtEnd(e,t)}_createVirtualPaperGap(){return this._node.create(this._virtualPaperGapSelector)}_createVirtualPaperTopMargin(){return this._paper.createVirtualTopMargin()}_createVirtualPaperBottomMargin(){return this._paper.createVirtualBottomMargin()}_insertFrontpageSpacer(e,t){const i=this._node.create();return this._DOM.setStyles(i,{paddingBottom:t+"px"}),this._DOM.setAttribute(i,".printFrontpageSpacer"),this._DOM.insertAtStart(e,i),i}_insertHeaderSpacer(e,t){const i=this._DOM.createDocumentFragment(),n=this._node.create(this._runningSafetySelector);this._DOM.insertAtEnd(i,this._createVirtualPaperTopMargin(),n),this._DOM.insertAtEnd(e,i)}_insertFooterSpacer({target:e,footerHeight:t,pageSeparator:i,paperSeparator:n,pageIndex:o}){const r=this._DOM.createDocumentFragment(),s=this._createVirtualPaperGap(),l=this._node.create(this._runningSafetySelector);this._DOM.insertAtEnd(r,l,this._createVirtualPaperBottomMargin(),this._node.create(this._printPageBreakSelector),s),this._DOM.insertAtStart(e,r),this._balanceFooter({balancingFooter:l,contentSeparator:s,pageSeparator:i,paperSeparator:n,pageIndex:o})}_balanceFooter({balancingFooter:e,contentSeparator:t,pageSeparator:i,paperSeparator:n,pageIndex:o}){const r=this._node.getTop(i,this._root),s=this._node.getTop(n,this._root),l=this._node.getTop(t,this._root);this.strictAssert(s==r,"balancers in paper layers are misaligned",{pageIndex:o,balancingFooter:e,contentSeparator:t,pageSeparator:i,paperSeparator:n});const a=r-l;this._debug._&&console.log({balancingFooter:e,contentSeparatorTop:l,paperSeparatorTop:s,pageSeparatorTop:r}),this._DOM.setStyles(e,{"margin-bottom":a+"px"}),this.strictAssert(a>=0,`[pages: ${o}-${o+1}] balancer is negative: ${a} < 0`,t)}}class _n{constructor({config:e,DOM:t,selector:i,node:n,layout:o}){this._globalDebugMode=e.debugMode,this._debug=e.debugMode?{...e.debugConfig.toc}:{},this._assert=!!e.consoleAssert,this._DOM=t,this._node=n,this._tocPageNumberSelector=e.tocPageNumberSelector,this._root=o.root,this._contentFlow=o.contentFlow,this._pageDividerSelector=i.pageDivider}render(){this._globalDebugMode&&console.time("Processing TOC"),this._debug._&&console.log(`\nüìë TOC: I am here!\n\ntocPageNumberSelector:\n ‚Ä¢ ${this._tocPageNumberSelector}\n pageDividerSelector:\n ‚Ä¢ ${this._pageDividerSelector}\n      `);const e=this._DOM.getAll(this._tocPageNumberSelector,this._contentFlow);if(this._debug._&&console.log("üìë tocPageNumberBoxes",e.length),!e.length)return void(this._debug._&&console.log("üìë no valid toc"));const t=this._DOM.getAll(this._pageDividerSelector,this._contentFlow).reduce(((e,t,i)=>{const n=this._node.getTop(t,this._root)-1,o=this._DOM.getAttribute(t,"[page]");return e[n]=o,e}),{});this._debug._&&console.log("üìë dataFromPagesMarkers",t);const i=e.reduce(((e,t)=>{const i=this._DOM.getDataId(t),n=this._DOM.getElementById(i),o=this._node.getTop(n,this._root);return e[o]={box:t,id:i,targetTop:o},e}),{});this._debug._&&console.log("üìë dataFromTOC",i);const n={...t,...i};let o=0;this._debug._&&console.groupCollapsed("Processing obj");for(const e in n){const t=n[e];this._debug._&&console.log(`Processing ${e}: ${t}`),"string"==typeof t?o=t:(t.page=o,this._DOM.setInnerHTML(t.box,o))}this._debug._&&console.groupEnd("Processing obj"),this._debug._&&console.log("üìë tocObject",n),this._globalDebugMode&&console.timeEnd("Processing TOC")}}class fn{constructor({config:e,DOM:t,selector:n,node:o,layout:r}){this._config=e,this._selector=n,this._DOM=t,this._node=o,this._layout=r,this._root=r.root,this._assert=!!e.consoleAssert,Object.assign(this,i)}init(){this._config.debugMode&&console.log("üêô i am Validator!");const e=`${this._selector.paperFlow} ${this._selector.virtualPaperGap}`,t=`${this._selector.contentFlow} ${this._selector.virtualPaperGap}`,i=[...this._DOM.getAllElements(e)],n=[...this._DOM.getAllElements(t)],o=i.map((e=>this._node.getTop(e))),r=n.map((e=>this._node.getTop(e,this._root))),s=o.reduce(((e,t,i)=>(t!==r[i]&&e.push(i+1),e)),[]);this.strictAssert(!s.length,"Problems with preview generation on the following pages: ",s)}}const mn="border:1px dashed #cccccc;background:#ffffff;color:#cccccc;";class bn{constructor(e){this._debugMode=e.debugMode,this._preloader,this._preloaderTarget=this._resolveTarget(e)||document.body,this._preloaderBackground=e.preloaderBackground||"white"}create(){this._debugMode&&console.groupCollapsed("%c Preloader ",mn),this._insertStyle(),this._preloader=document.createElement("div"),this._preloader.classList.add("lds-dual-ring"),this._preloaderTarget.append(this._preloader),this._debugMode&&console.groupEnd("%c Preloader ",mn)}remove(){if(!this._preloader)return;let e=1;const t=setInterval((()=>{e<=.1&&(clearInterval(t),this._preloader.remove()),this._preloader.style.opacity=e,e-=.1*e}),50);this._debugMode&&console.log("%c Preloader removed ",mn)}_insertStyle(){const e=document.querySelector("head"),t=document.createElement("style");t.append(document.createTextNode(this._css())),t.setAttribute("data-preloader-style",""),e.append(t)}_css(){return`\n    /* PRELOADER */\n    .lds-dual-ring {\n      position: absolute;\n      z-index: 99999;\n      top: 0; left: 0; bottom: 0; right: 0;\n      background: ${this._preloaderBackground};\n      display: flex;\n      justify-content: center;\n      align-items: center;\n    }\n    /*\n    .lds-dual-ring:after {\n      content: " ";\n      display: block;\n      width: 64px;\n      height: 64px;\n      margin: 8px;\n      border-radius: 50%;\n      border: 6px solid #eee;\n      border-color: #eee transparent #eee transparent;\n      animation: lds-dual-ring 1.2s linear infinite;\n    }\n    @keyframes lds-dual-ring {\n      0% {\n        transform: rotate(0deg);\n      }\n      100% {\n        transform: rotate(360deg);\n      }\n    }\n    */\n  `}_resolveTarget(e){const t=(e.preloaderTarget||"").trim();return t&&document.querySelector(t)}}class wn{constructor(e){this._debugMode=e.debugMode}run(){let e=[...document.querySelectorAll("object")];this._debugMode&&console.log(e);let t=[];return e.forEach((e=>{const i=new Promise((t=>{e.addEventListener("load",(i=>{this._debugMode&&console.log("‚è∞ EVENT: object load",e.clientHeight,e.clientWidth,e),t()}))}));t.push(i)})),Promise.all(t)}}const Sn=e=>!0===e||"true"===e;function Mn(e){const t=Array.isArray(e)?[]:{};return Object.entries(e).forEach((([e,i])=>{t[e]=!i||"object"!=typeof i||Mn(i)})),t}const Pn={DOM:{_:!1},layout:{_:!1},pages:{_:!1,_parseNode:!1,_parseNodes:!1,_registerPageStart:!1},paper:{_:!1},preview:{_:!1},toc:{_:!1},node:{_:!1,children:!1,creators:!1,flowFilters:!1,fitters:!1,getters:!1,markers:!1,pageBreaks:!1,positioning:!1,selectors:!1,slicers:!1,splitters:!1,wrappers:!1,pagination:!1},paragraph:{_:!1},grid:{_:!1},pre:{_:!1},table:{_:!1},tableLike:{_:!1},testSignals:{forcedModeLog:!1}};function Cn(e){const t=function(e){let t={debugMode:!1,forcedDebugMode:!1,consoleAssert:!1,markupDebugMode:!1,preloader:!1,preloaderTarget:"",preloaderBackground:"",mask:!0,noHangingSelectors:"",forcedPageBreakSelectors:"",pageBreakBeforeSelectors:"",pageBreakAfterSelectors:"",noBreakSelectors:"",tocPageNumberSelector:"html2pdf-toc-page-number",printLeftMargin:"21mm",printRightMargin:"21mm",printTopMargin:"12mm",printBottomMargin:"12mm",printFontSize:"12pt",paperColor:"white",paperWidth:"210mm",paperHeight:"297mm",headerMargin:"16px",footerMargin:"16px",virtualPagesGap:"16px",splitLabelHeight:"24px"};const i={paperWidth:"210mm",paperHeight:"297mm"},n={paperWidth:"148.5mm",paperHeight:"210mm"};switch((e=function(e){const t={...e};for(const e in t){const i=t[e];if("string"==typeof i){const n=i.toLowerCase();"true"===n||"1"===n?t[e]=!0:"false"!==n&&"0"!==n&&""!==n||(t[e]=!1)}}return t}(e)).printPaperSize){case"A5":case"a5":t={...t,...n};break;default:t={...t,...i}}t={...t,initialRoot:T.init,tocPageNumberSelector:T.tocPageNumber,...e},console.info("[HTML2PDF4DOC] Config:",t);const o={printLeftMargin:t.printLeftMargin,printRightMargin:t.printRightMargin,printTopMargin:t.printTopMargin,printBottomMargin:t.printBottomMargin,printFontSize:t.printFontSize,paperWidth:t.paperWidth,paperHeight:t.paperHeight,headerMargin:t.headerMargin,footerMargin:t.footerMargin,virtualPagesGap:t.virtualPagesGap},r=document.createElement("div");return r.style="\n  position:absolute;\n  z-index:1000;\n  left: 200%;\n  ",document.body.append(r),Object.entries(o).forEach((([e,t])=>{r.style.width=t,o[e]=`${Math.trunc(r.getBoundingClientRect().width)}px`})),r.remove(),t={...t,...o},t.noHangingSelectors=t.noHangingSelectors+" H1 H2 H3 H4 H5 H6",t.forcedPageBreakSelectors=t.forcedPageBreakSelectors+" "+T.printForcedPageBreak,t.debugMode&&console.info("Config with converted units:",t),t}(e);t.forcedDebugMode&&(t.debugMode=!0,t.consoleAssert=!0,t.markupDebugMode=!0);const i=t.forcedDebugMode?Mn(Pn):Pn;return{...t,debugConfig:i}}const yn="color:Gray;border:1px solid;";console.info("[HTML2PDF4DOC] Version:","0.3.0");const On=document.currentScript.dataset,Tn=new class{constructor(e){this.params=function(e={}){const t={...e};return[["printWidth","paperWidth"],["printHeight","paperHeight"]].forEach((([e,i])=>{Object.prototype.hasOwnProperty.call(t,e)&&(console.warn(`[HTML2PDF4DOC] Config option "${e}" is deprecated. Use "${i}" instead.`),Object.prototype.hasOwnProperty.call(t,i)||(t[i]=t[e]),delete t[e])})),t}(e),this.forcedDebugMode=Sn(e.forcedDebugMode),this.debugMode=Sn(e.debugMode)||this.forcedDebugMode,this.preloader=e.preloader,this.selector=T,this.config}async render(){console.time("[HTML2PDF4DOC] Total time"),this.debugMode&&console.log("üèÅ document.readyState",document.readyState),document.addEventListener("readystatechange",(e=>{this.debugMode&&console.log("üèÅ readystatechange",document.readyState)})),this.debugMode&&console.time("‚è±Ô∏è await DOMContentLoaded time"),await new Promise((e=>{window.addEventListener("DOMContentLoaded",(t=>{this.debugMode&&console.log("‚è∞ EVENT: DOMContentLoaded"),e()}))})),this.debugMode&&console.timeEnd("‚è±Ô∏è await DOMContentLoaded time"),this.debugMode&&console.time("‚è±Ô∏è create Preloader time");const e=new bn(this.params);"true"===this.preloader&&e.create(),this.debugMode&&console.timeEnd("‚è±Ô∏è create Preloader time"),this.debugMode&&console.time("‚è±Ô∏è Config time"),this.debugMode&&console.groupCollapsed("%c config ",yn+"color:LightGray"),this.config=Cn(this.params),this.debugMode&&console.groupEnd(),this.debugMode&&console.info("‚öôÔ∏è Current config with debugConfig:",this.config),this.debugMode&&console.timeEnd("‚è±Ô∏è Config time"),this.config.debugConfig.testSignals.forcedModeLog&&console.info("[HTML2PDF4DOC] üõ†Ô∏è Forced debug mode is active."),this.config.consoleAssert&&console.info("[HTML2PDF4DOC] üßß Assertions enabled."),this.debugMode&&console.time("‚è±Ô∏è DOM helpers init time");const t=new F({DOM:window.document,config:this.config});this.debugMode&&console.timeEnd("‚è±Ô∏è DOM helpers init time"),this.debugMode&&console.time("‚è±Ô∏è node helpers init time");const i=new sn({config:this.config,DOM:t,selector:this.selector});this.debugMode&&console.timeEnd("‚è±Ô∏è node helpers init time"),this.debugMode&&console.time("‚è±Ô∏è await window load time"),await new Promise((e=>{window.addEventListener("load",(t=>{this.debugMode&&console.log("‚è∞ EVENT: window load"),e()}))})),this.debugMode&&console.timeEnd("‚è±Ô∏è await window load time"),this.debugMode&&console.time("‚è±Ô∏è Layout time"),this.debugMode&&console.groupCollapsed("%c Layout ",yn);const n=new k({config:this.config,DOM:t,selector:this.selector,node:i});if(n.create(),this.debugMode&&console.groupEnd(),this.debugMode&&console.timeEnd("‚è±Ô∏è Layout time"),!n.success)return void(this.debugMode&&console.error("Failed to create layout.\n\nWe have to interrupt the process of creating PDF preview."));this.debugMode&&console.info("%c calculate Paper params ",yn),this.debugMode&&console.time("‚è±Ô∏è Paper time");const o=new pn({config:this.config,DOM:t,selector:this.selector,node:i,layout:n});if(this.debugMode&&console.timeEnd("‚è±Ô∏è Paper time"),!o||!o.bodyHeight||!o.bodyWidth)return void(this.debugMode&&console.error("Failed to create paper calculations.\n\nWe have to interrupt the process of creating PDF preview."));this.debugMode&&console.time("‚è±Ô∏è Preprocess time"),this.debugMode&&console.groupCollapsed("%c Preprocess ",yn),await new wn(this.config).run(),this.debugMode&&console.groupEnd(),this.debugMode&&console.timeEnd("‚è±Ô∏è Preprocess time"),this.debugMode&&console.time("‚è±Ô∏è Pages time"),this.debugMode&&console.group("%c Pages ",yn);const r=new dn({config:this.config,DOM:t,selector:this.selector,node:i,layout:n,referenceHeight:o.bodyHeight,referenceWidth:o.bodyWidth}).calculate();this.debugMode&&console.groupEnd(),this.debugMode&&console.timeEnd("‚è±Ô∏è Pages time"),this.debugMode&&console.time("‚è±Ô∏è Preview time"),this.debugMode&&console.groupCollapsed("%c Preview ",yn),new un({config:this.config,DOM:t,selector:this.selector,node:i,layout:n,paper:o,pages:r}).create(),this.debugMode&&console.groupEnd(),this.debugMode&&console.timeEnd("‚è±Ô∏è Preview time"),this.debugMode&&console.time("‚è±Ô∏è Toc time"),new _n({config:this.config,DOM:t,selector:this.selector,node:i,layout:n}).render(),this.debugMode&&console.timeEnd("‚è±Ô∏è Toc time"),this.debugMode&&console.time("‚è±Ô∏è Validator time"),new fn({config:this.config,DOM:t,selector:this.selector,node:i,layout:n}).init(),this.debugMode&&console.timeEnd("‚è±Ô∏è Validator time"),t.setAttribute(n.root,"[success]"),t.setAttribute(n.root,"[pages]",r.length),e.remove(),console.info("[HTML2PDF4DOC] Page count:",r.length),console.timeEnd("[HTML2PDF4DOC] Total time")}}(On),En="manual"===On.init;function Dn(){En&&Tn.render()}En&&console.info("HTML2PDF4DOC in manual initialization mode"),!En&&Tn.render(),HTML2PDF4DOC=t})();